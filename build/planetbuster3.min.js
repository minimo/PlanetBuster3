function MersenneTwister(t){0==arguments.length&&(t=(new Date).getTime()),this._mt=new Array(624),this.setSeed(t)}!function(){"use strict"}();var tm=tm||{};tm.global=window||global||this,null!=tm.global.Meteor&&(tm.global.tm=tm),"undefined"!=typeof module&&module.exports&&(module.exports=tm),function(){tm.VERSION="0.5.0",tm.LIB_ROOT=function(){if(window.document)for(var t=document.getElementsByTagName("script"),e=0,i=t.length;i>e;++e);}(),tm.BROWSER=function(){return window.navigator?/chrome/i.test(navigator.userAgent)?"Chrome":/safari/i.test(navigator.userAgent)?"Safari":/firefox/i.test(navigator.userAgent)?"Firefox":/opera/i.test(navigator.userAgent)?"Opera":/getcko/i.test(navigator.userAgent)?"Getcko":/msie/i.test(navigator.userAgent)?"IE":"":void 0}(),tm.VENDER_PREFIX=function(){if(window){var t={Chrome:"webkit",Safari:"webkit",Firefox:"moz",Opera:"o",IE:"ms"};return t[tm.BROWSER]||""}}(),tm.isMobile=function(){if(window.navigator){var t=navigator.userAgent;return t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("Android")>0}}(),tm.isLocal=function(){var t="file:"==location.protocol;return function(){return t}}(),tm.createClass=function(t){t.init=t.init||function(){},t.superClass=t.superClass||null;var e=function(){var t=new e.prototype.creator;return e.prototype.init.apply(t,arguments),t};t.superClass&&(t.init.owner=e,e.prototype=Object.create(t.superClass.prototype),e.prototype.superInit=function(){var t=this.superInit.caller,e=t.owner,i=e.prototype.superClass,n=i.prototype.init;n.apply(this,arguments)},e.prototype.constructor=e),e.prototype.selfClass=e;for(var i in t)e.prototype[i]=t[i];return e.prototype.creator=function(){return this},e.prototype.creator.prototype=e.prototype,e._class=!0,e},tm.classes={};var _calssDefinedCallback={};tm.define=function(t,e){var i=t.lastIndexOf("."),n=t.substring(0,i),s=n?tm.using(n):tm.global,r=n?t.substring(i+1):t;Function.prototype.bind,Array.prototype.unshift;e._path=t,e._className=r;var a=null,o=e.superClass;if(o&&"string"==typeof o){var h=o;if(o=tm.using(o),!o._class)return _calssDefinedCallback[h]||(_calssDefinedCallback[h]=[]),void _calssDefinedCallback[h].push(function(){tm.define(t,e)});e.superClass=o,a=tm.createClass(e)}else a=tm.createClass(e);if(s[r]=tm.classes[t]=a,_calssDefinedCallback[t]){for(var l=_calssDefinedCallback[t],u=0,c=l.length;c>u;++u)l[u]();delete _calssDefinedCallback[t]}return a},tm.namespace=function(t,e){var t=tm.using(t);e.call(t,t)},tm.using=function(t){if(tm.classes[t])return tm.classes[t];for(var e=t.split(/[,.\/ ]|::/),i=tm.global,n=0,s=e.length;s>n;++n){var r=e[n];i=i[r]||(i[r]={})}return tm.classes[t]=i,i},tm.globalize=function(t){return tm.$forIn(function(t,e){"object"==typeof e&&"classes"!==t&&"global"!==t&&"event"!==t&&"dom"!==t&&e.$forIn(function(t,e){window[t]||(window[t]=e)})}),this},tm["import"]=function(t){var e=tm[t];return tm.global.$strict(e),this},tm.setLoop=function(t,e){var i=function(){var i=(new Date).getTime();t();var n=(new Date).getTime()-i,s=e-n;s=s>0?s:0,setTimeout(arguments.callee,s)};setTimeout(i,e)},tm.inform=function(parent){parent=parent||document.body;var eInfo=document.createElement("div");with(eInfo.setAttribute("class","tm-info"),eInfo.addEventListener("mouseover",function(){this.style.opacity=.9},!1),eInfo.addEventListener("mouseout",function(){this.style.opacity=.25},!1),eInfo.style)position="absolute",width="100%",bottom="0px",left="0px",right="0px",margin="0px",padding="10px 0px",zIndex="0",textAlign="center",fontFamily='"Meiryo", "メイリオ", "ヒラギノ角ゴ Pro W3", sans-serif',fontSize="13px",opacity="0.25",backgroundColor="rgb(230,230,255)",background="-webkit-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",background="-moz-linear-gradient(top, hsla(0, 100%, 100%, 0.8) 0%, hsla(0, 100%, 100%, 0.3) 50%, hsla(0, 100%, 100%, 0.1) 51%, hsla(0, 100%, 100%, 0.2) 100%), rgb(190,190,210)",WebkitTransition="1s",MozTransition="1s";eInfo.innerHTML="このプログラムで利用している JavaScript ライブラリ 『tmlib.js』 については<a href='{projectLink}'>こちら</a>.".format({projectLink:"https://github.com/phi1618/tmlib.js"}),parent.appendChild(eInfo)}}(),function(){window&&(window.requestAnimationFrame||(window.requestAnimationFrame=window[tm.VENDER_PREFIX+"RequestAnimationFrame"]||function(t){window.setTimeout(t,1e3/60)}),window.cancelRequestAnimationFrame||(window.cancelRequestAnimationFrame=window[tm.VENDER_PREFIX+"CancelRequestAnimationFrame"]||window.clearTimeout))}(),function(){if(window.document){var t=[];tm.main=function(i){i?t.push(i):e()};var e=function(){for(var e=0,i=t.length;i>e;++e)t[e]();t=[]};window.addEventListener("load",function(){e()},!1)}}(),function(){Object.defineProperty(Object.prototype,"defineVariable",{value:function(t,e){Object.defineProperty(this,t,{value:e,enumerable:!0,writable:!0})}}),Object.defineProperty(Object.prototype,"defineFunction",{value:function(t,e){Object.defineProperty(this,t,{value:e,enumerable:!1,writable:!0})}}),Object.prototype.defineFunction("defineInstanceVariable",function(t,e){Object.defineProperty(this.prototype,t,{value:e,enumerable:!0,writable:!0})}),Object.prototype.defineFunction("defineInstanceMethod",function(t,e){Object.defineProperty(this.prototype,t,{value:e,enumerable:!1,writable:!0})}),Object.defineInstanceMethod("setter",function(t,e){Object.defineProperty(this,t,{set:e,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("getter",function(t,e){Object.defineProperty(this,t,{get:e,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("accessor",function(t,e){Object.defineProperty(this,t,{set:e.set,get:e.get,enumerable:!1,configurable:!0})}),Object.defineInstanceMethod("$forIn",function(t,e){return e=e||this,Object.keys(this).forEach(function(i,n){var s=this[i];t.call(e,i,s,n)},this),this}),Object.defineInstanceMethod("$has",function(t){return this.hasOwnProperty(t)}),Object.defineInstanceMethod("$extend",function(){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)this[e]=t[e]},this),this}),Object.defineInstanceMethod("$safe",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)void 0===this[e]&&(this[e]=t[e])},this),this}),Object.defineInstanceMethod("$strict",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var e in t)console.assert(!this[e],"tm error: {0} is Already".format(e)),this[e]=t[e]},this),this}),Object.defineInstanceMethod("$pick",function(){var t={};return Array.prototype.forEach.call(arguments,function(e){e in this&&(t[e]=this[e])},this),t}),Object.defineInstanceMethod("$omit",function(){var t={};for(var e in this)-1==Array.prototype.indexOf.call(arguments,e)&&(t[e]=this[e]);return t})}(),function(){Array.prototype.accessor("first",{get:function(){return this[0]},set:function(t){this[0]=t}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),Array.defineInstanceMethod("equals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;i>e;++e)if(this[e]!==t[e])return!1;return!0}),Array.defineInstanceMethod("deepEquals",function(t){if(this.length!==t.length)return!1;for(var e=0,i=this.length;i>e;++e){var n=this[e].deepEquals?this[e].deepEquals(t[e]):this[e]===t[e];if(n===!1)return!1}return!0}),Array.defineInstanceMethod("contains",function(t,e){return-1!=this.indexOf(t,e)}),Array.defineInstanceMethod("at",function(t){return t%=this.length,t+=this.length,t%=this.length,this[t]}),Array.defineInstanceMethod("swap",function(t,e){var i=this[t];return this[t]=this[e],this[e]=i,this}),Array.defineInstanceMethod("erase",function(t){var e=this.indexOf(t);return e>=0&&this.splice(e,1),this}),Array.defineInstanceMethod("eraseAll",function(t){for(var e=0,i=this.length;i>e;++e)this[e]==t&&this.splice(e--,1);return this}),Array.defineInstanceMethod("eraseIf",function(t){for(var e=0,i=this.length;i>e;++e)if(t(this[e],e,this)){this.splice(e,1);break}return this}),Array.defineInstanceMethod("eraseIfAll",function(t){for(var e=0,i=this.length;i>e;++e)t(this[e],e,this)&&this.splice(e,1);return this}),Array.defineInstanceMethod("random",function(t,e){return t=t||0,e=e||this.length-1,this[Math.rand(t,e)]}),Array.defineInstanceMethod("pickup",function(t,e){return t=t||0,e=e||this.length-1,this[Math.rand(t,e)]}),Array.defineInstanceMethod("uniq",function(t){return this.filter(function(t,e,i){return i.indexOf(t)===e})}),Array.defineInstanceMethod("flatten",function(t){var e=null;if(t){e=this;for(var i=0;t>i;++i)e=Array.prototype.concat.apply([],e)}else e=this.reduce(function(t,e){return Array.isArray(e)?t.concat(e.flatten()):t.concat(e)},[]);return e}),Array.defineInstanceMethod("clone",function(t){if(1==t){for(var e=Array(this.length),i=0,n=this.length;n>i;++i)e[i]=this[i].clone?this[i].clone(t):this[i];return e}return Array.prototype.slice.apply(this)}),Array.defineInstanceMethod("clear",function(){return this.length=0,this}),Array.defineInstanceMethod("fill",function(t,e,i){e=e||0,i=i||this.length;for(var n=e;i>n;++n)this[n]=t;return this}),Array.defineInstanceMethod("range",function(t,e,i){if(1==arguments.length){this.clear();for(var n=0;t>n;++n)this[n]=n}else if(e>t){i=i||1,this.clear();for(var n=t,s=0;e>n;n+=i,++s)this[s]=n}else{i=i||-1,this.clear();for(var n=t,s=0;n>e;n+=i,++s)this[s]=n}return this}),Array.defineInstanceMethod("shuffle",function(){for(var t=0,e=this.length;e>t;++t){var i=Math.rand(0,e-1);t!=i&&this.swap(t,i)}return this}),Array.defineInstanceMethod("sum",function(){for(var t=0,e=0,i=this.length;i>e;++e)t+=this[e];return t}),Array.defineInstanceMethod("average",function(){for(var t=0,e=this.length,i=0;e>i;++i)t+=this[i];return t/e}),Array.defineInstanceMethod("each",function(){return this.forEach.apply(this,arguments),this}),Array.defineInstanceMethod("toULElement",function(){}),Array.defineInstanceMethod("toOLElement",function(){}),Array.defineFunction("range",function(t,e,i){return Array.prototype.range.apply([],arguments)})}(),function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.defineInstanceMethod("format",function(i){for(var n=this.getFullYear(),s=this.getMonth(),r=this.getDate(),a=this.getDay(),o=this.getHours(),h=this.getMinutes(),l=this.getSeconds(),u=this.getMilliseconds(),c="",m=0,p=i.length;p>m;++m){var d=i.charAt(m),f="";switch(d){case"d":f=r.padding(2,"0");break;case"D":f=e[a].substr(0,3);break;case"j":f=r;break;case"l":f=e[a];break;case"F":f=t[s];break;case"m":f=(s+1).padding(2,"0");break;case"M":f=t[s].substr(0,3);break;case"n":f=s+1;break;case"Y":f=n;break;case"y":f=n.toString().substr(2,2);break;case"G":f=o;break;case"H":f=o.padding(2,"0");break;case"i":f=h.padding(2,"0");break;case"s":f=l.padding(2,"0");break;case"S":f=u.padding(3,"0");break;default:f=d}c+=f}return c})}(),function(){Function.prototype.bind||Function.defineInstanceMethod("bind",function(t){var e=this;return function(){e.apply(t,arguments)}}),Function.prototype.$has("name")||Function.prototype.getter("name",function(){return(""+this).replace(/^\s*function\s*([^\(]*)[\S\s]+$/im,"$1")}),Function.defineInstanceMethod("toArrayFunction",function(){var t=this;return function(){for(var e=[],i=0,n=this.length;n>i;++i)e.push(t.apply(this[i],arguments));return e}})}(),function(){Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.degToRad=function(t){return t*Math.DEG_TO_RAD},Math.radToDeg=function(t){return t*Math.RAD_TO_DEG},Math.defineFunction("clamp",function(t,e,i){return e>t?e:t>i?i:t}),Math.defineFunction("inside",function(t,e,i){return t>=e&&i>=t}),Math.defineFunction("rand",function(t,e){return window.Math.floor(Math.random()*(e-t+1))+t}),Math.defineFunction("randf",function(t,e){return window.Math.random()*(e-t)+t})}(),function(){Number.defineInstanceMethod("round",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.round(i),i/e}),Number.defineInstanceMethod("ceil",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.ceil(i),i/e}),Number.defineInstanceMethod("floor",function(t){t=t||0;var e=Math.pow(10,t),i=this*e;return i=Math.floor(i),i/e}),Number.defineInstanceMethod("toInt",function(){return 0|this}),Number.defineInstanceMethod("toHex",function(){return this.toString(16)}),Number.defineInstanceMethod("toBin",function(){return this.toString(2)}),Number.defineInstanceMethod("toUnsigned",function(){return this>>>0}),Number.defineInstanceMethod("padding",function(t,e){var i=this+"";for(t-=i.length,e=e||"0";t-->0;)i=e+i;return i}),Number.defineInstanceMethod("times",function(t,e){e=e||this;for(var i=0;this>i;++i)t.call(e,i);return this}),Number.defineInstanceMethod("upto",function(t,e,i){i=i||this;for(var n=+this;t>=n;++n)e.call(i,n);return this}),Number.defineInstanceMethod("downto",function(t,e,i){i=i||this;for(var n=+this;n>=t;--n)e.call(i,n);return this}),Number.defineInstanceMethod("step",function(t,e,i,n){n=n||this;for(var s=+this;t>=s;s+=e)i.call(n,s);return this})}(),function(){String.defineInstanceMethod("format",function(t){var e=void 0;if("object"==typeof t)e=function(e,i){return void 0===t[i]?"":t[i]};else{var i=arguments;e=function(t,e){return i[parseInt(e)]}}return this.replace(/\{(\w+)\}/g,e)}),String.defineInstanceMethod("trim",function(){return this.replace(/^\s+|\s+$/g,"")}),String.defineInstanceMethod("capitalize",function(){return this.replace(/\w+/g,function(t){return t.capitalizeFirstLetter()})}),String.defineInstanceMethod("capitalizeFirstLetter",function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()}),String.defineInstanceMethod("toDash",function(){return this.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}),String.defineInstanceMethod("toHash",function(){return this.toCRC32()}),String.defineInstanceMethod("padding",function(t,e){var i=this.toString();for(t-=i.length,e=e||" ";t-->0;)i=e+i;return i}),String.defineInstanceMethod("paddingLeft",function(t,e){var i=this.toString();for(t-=i.length,e=e||" ";t-->0;)i=e+i;return i}),String.defineInstanceMethod("paddingRight",function(t,e){var i=this.toString();for(t-=i.length,e=e||" ";t-->0;)i+=e;return i}),String.defineInstanceMethod("quotemeta",function(t){return this.replace(/([^0-9A-Za-z_])/g,"\\$1")}),String.defineInstanceMethod("repeat",function(t){for(var e=Array(t),i=0;t>i;++i)e[i]=this;return e.join("")}),String.defineInstanceMethod("count",function(t){var e=new RegExp(t,"gm");return this.match(e).length}),String.defineInstanceMethod("toArray",function(){for(var t=[],e=0,i=this.length;i>e;++e)t.push(this[e]);return t});var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");String.defineInstanceMethod("toCRC32",function(){var e=0,i=0,n=0;e=-1^e;for(var s=0,r=this.length;r>s;++s)n=255&(e^this.charCodeAt(s)),i="0x"+t[n],e=e>>>8^i;return(-1^e)>>>0})}(),tm.event=tm.event||{},function(){tm.event.Event=tm.createClass({type:null,init:function(t){this.type=t}})}(),function(){tm.event.TweenEvent=tm.createClass({superClass:tm.event.Event,time:null,now:null,init:function(t,e,i){this.superInit(t),this.time=e,this.now=i}}),tm.event.TweenEvent.CHANGE="change",tm.event.TweenEvent.FINISH="finish",tm.event.TweenEvent.LOOP="loop",tm.event.TweenEvent.RESUME="resume",tm.event.TweenEvent.START="start",tm.event.TweenEvent.STOP="stop"}(),function(){tm.event.MouseEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(t,e,i){this.superInit(t),this.app=e,this.pointing=i}})}(),function(){tm.event.TouchEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(t,e,i){this.superInit(t),this.app=e,this.pointing=i}})}(),function(){tm.event.PointingEvent=tm.createClass({superClass:tm.event.Event,app:null,pointing:null,init:function(t,e,i){this.superInit(t),this.app=e,this.pointing=i}})}(),tm.event=tm.event||{},function(){tm.define("tm.event.EventDispatcher",{init:function(){this._listeners={}},on:function(t,e){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(e),this},off:function(t,e){var i=this._listeners[t],n=i.indexOf(e);return-1!=n&&i.splice(n,1),this},fire:function(t){t.target=this;var e="on"+t.type;this[e]&&this[e](t);var i=this._listeners[t.type];if(i)for(var n=i.clone(),s=0,r=n.length;r>s;++s)n[s].call(this,t);return this},flare:function(t,e){var i=tm.event.Event(t);return e&&i.$extend(e),this.fire(i),this},one:function(t,e){var i=this,n=function(){var s=e.apply(i,arguments);return i.off(t,n),s};return this.on(t,n),this},hasEventListener:function(t){return void 0!==this._listeners[t]||this["on"+t]?!0:!1},clearEventListener:function(t){var e="on"+t;return this[e]&&delete this[e],this._listeners[t]=[],this}});var t=tm.event.EventDispatcher.prototype;t.addEventListener=t.on,t.removeEventListener=t.off,t.dispatchEvent=t.fire,t.trigger=t.fire}(),tm.util=tm.util||{},function(){tm.util.Random={randint:function(t,e){return window.Math.floor(Math.random()*(e-t+1))+t},randfloat:function(t,e){return window.Math.random()*(e-t)+t},randbool:function(){return 1===this.randint(0,1)}}}(),tm.util=tm.util||{},function(){var AJAX_DEFAULT_SETTINGS={type:"GET",async:!0,data:null,contentType:"application/x-www-form-urlencoded",dataType:"text",responseType:"",username:null,password:null,success:function(t){alert("success!!\n"+t)},error:function(t){alert("error!!")},beforeSend:null};tm.util.Ajax={load:function(t){for(var e in AJAX_DEFAULT_SETTINGS)t[e]=t[e]||AJAX_DEFAULT_SETTINGS[e];var i=new XMLHttpRequest,n=tm.util.Ajax.DATA_CONVERTE_TABLE[t.dataType];t.url;if(t.data){var s="";s="string"==typeof t.data?t.data:tm.util.QueryString.stringify(t.data),"GET"==t.type?(t.url+="?"+s,t.data=null):"POST"==t.type&&(t.data=s)}i.onreadystatechange=function(){if(4==i.readyState)if(200===i.status||201===i.status||0===i.status)if("arraybuffer"!==t.responseType){var e=n(i.responseText);t.success(e)}else t.success(this.response);else t.error(i.responseText)},i.open(t.type,t.url,t.async,t.username,t.password),"POST"===t.type&&i.setRequestHeader("Content-Type",t.contentType),t.responseType&&(i.responseType=t.responseType),t.beforeSend&&t.beforeSend(i),t.password&&(i.withCredentials=!0),i.send(t.data)},loadJSONP:function(t,e){var i=tm.global;i.tmlib_js_dummy_func_count=tm.global.tmlib_js_dummy_func||0;var n="tmlib_js_dummy_func"+i.tmlib_js_dummy_func_count++;i[n]=e;var s=document.createElement("script");s.type="text/javascript",s.charset="UTF-8",s.src=t+(t.indexOf("?")<0?"?":"&")+"callback="+n,s.setAttribute("defer",!0),document.getElementsByTagName("head")[0].appendChild(s)}},tm.util.Ajax.DATA_CONVERTE_TABLE={undefined:function(t){return t},text:function(t){return t},xml:function(t){var e=new DOMParser,i=e.parseFromString(t,"text/xml");return i},dom:function(t){var e=document.createElement("div");return e.innerHTML=t,tm.dom.Element(e)},json:function(t){try{return JSON.parse(t)}catch(e){console.dir(e),console.dir(t)}},script:function(data){return eval(data),data},bin:function(t){for(var e=[],i=0,n=t.length;n>i;++i)e[i]=255&t.charCodeAt(i);return e}},tm.util.Ajax.DEFAULT_SETTINGS=AJAX_DEFAULT_SETTINGS}(),tm.util=tm.util||{},function(){tm.define("tm.util.File",{superClass:"tm.event.EventDispatcher",data:null,loaded:!1,init:function(t){this.superInit(),this.loaded=!1,1==arguments.length&&this.load(t)},load:function(t){if("string"==typeof t){var e=t;t={url:e}}var i=this;t.success=function(t){i.setData(t);var e=tm.event.Event("load");i.dispatchEvent(e)},tm.util.Ajax.load(t)},setData:function(t){this.data=t,this.loaded=!0},loadLocalStorage:function(){}})}(),tm.util=tm.util||{},function(){tm.util.Timeline=tm.createClass({target:null,tasks:null,fps:30,init:function(){this.tasks=[],this.time=0},at:function(t,e){return this.tasks.push({time:t,action:e}),this},after:function(t,e){return this.at(this.time+t,e),this},clear:function(){return this.tasks=[],this},removeTime:function(t){},removeAction:function(t){},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime()},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime()},stop:function(){this.isPlaying=!1},rewind:function(){this.time=0},update:function(){if(this.tasks.length>0)for(var t=0,e=this.tasks.length;e>t;++t){var i=this.tasks[t];this.prev<=i.time&&i.time<this.time&&i.action()}},_startTime:function(){this.startTime=(new Date).getTime()},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_updateTime:function(){this.isPlaying&&(this._nextTime(),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_nextTime:function(){this.prev=this.time,this.time=(new Date).getTime()-this.startTime,this.update()}})}(),tm.util=tm.util||{},function(){tm.util.DataManager={data:{}},tm.util.DataManager.save=function(){for(var t in this.data){var e=this.data[t];localStorage[t]=JSON.stringify(e)}},tm.util.DataManager.load=function(t){for(var t in localStorage)this.data[t]=JSON.parse(localStorage[t])},tm.util.DataManager.set=function(t,e){return this.data[t]=e,this},tm.util.DataManager.get=function(t){return this.data[t]}}(),tm.util=tm.util||{},function(){tm.util.QueryString={parse:function(t,e,i){e=e||"&",i=i||"=";for(var n={},s=t.split(e),r=0,a=s.length;a>r;++r){var o=s[r],h=o.indexOf(i);if(h>0){var l=o.substring(0,h),u=o.substring(h+1);n[l]=u}}return n},stringify:function(t,e,i){e=e||"&",i=i||"=";var n=[];for(var s in t){var r=encodeURIComponent(t[s]);n.push(s+i+r)}return n.join(e)}}}(),tm.namespace("tm.util.Type",function(){var t=this,e=Object.prototype.toString;this.defineFunction("isObject",function(t){return t===Object(t)}),this.defineFunction("isArray",function(t){return"[object Array]"==e.call(t)}),this.defineFunction("isArguments",function(t){return"[object Arguments]"==e.call(t)}),this.defineFunction("isFunction",function(t){return"[object Function]"==e.call(t)}),this.defineFunction("isString",function(t){return"[object String]"==e.call(t)}),this.defineFunction("isNumber",function(t){return"[object Number]"==e.call(t)}),this.defineFunction("isDate",function(t){return"[object Date]"==e.call(t)}),this.defineFunction("isRegExp",function(t){return"[object RegExp]"==e.call(t)}),this.defineFunction("isEmpty",function(e){if(!e)return!0;if(t.isArray(e)||t.isString(e)||t.isArguments(e))return 0===e.length;for(var i in e)if(i)return!1;return!0})}),tm.define("tm.util.Flow",{superClass:"tm.event.EventDispatcher",waits:0,counter:0,args:null,init:function(t,e){this.superInit(),t=t||0,e=e||null,this.setup(t,e)},setup:function(t,e){return this.waits=t,this.callback=e,this.counter=0,this.args={},this._check(),this},pass:function(t,e){++this.counter,arguments.length>=2&&(this.args[t]=e),this._check()},isFinish:function(){return this.counter===this.waits},_check:function(){if(this.isFinish()){var t=this.args;this.callback&&(this.callback(t),this.args=null,this.callback=null);var e=tm.event.Event("flowfinish");e.args=t,this.fire(e)}}}),tm.define("tm.util.GridSystem",{width:640,col:12,init:function(t,e){if("object"==typeof arguments[0]){var i=arguments[0];t=i.width,e=i.col}this.width=t,this.col=e,this.unitWidth=this.width/this.col},span:function(t){return t+=this.col,t%=this.col,this.unitWidth*t},center:function(){return this.unitWidth*(this.col/2)}}),tm.geom=tm.geom||{},function(){tm.geom.Vector2=tm.createClass({x:0,y:0,init:function(t,e){this.set(t,e)},clone:function(){return tm.geom.Vector2(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y?!0:!1},equalsNumber:function(t,e){return this.x===t&&this.y===e?!0:!1},equalsArray:function(t){return this.x===t[0]&&this.y===t[1]?!0:!1},set:function(t,e){this.x=t,this.y=e},setNumber:function(t,e){return this.x=t,this.y=e,this},setArray:function(t){return this.x=t[0],this.y=t[1],this},setObject:function(t){return this.x=t.x,this.y=t.y,this},setString:function(t){var e=t.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(e[1]),this.y=parseFloat(e[3]),this},setSmart:function(t,e){var i=arguments[0];if(2===arguments.length)this.x=t,this.y=e;else if(i instanceof Array)this.x=i[0],this.y=i[1];else if(i instanceof Object)this.x=i.x,this.y=i.y;else if("string"==typeof i){var n=i.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(n[1]),this.y=parseFloat(n[3])}return this},setAngle:function(t,e){var i=t*Math.DEG_TO_RAD;return e=e||1,this.x=Math.cos(i)*e,this.y=Math.sin(i)*e,this},setRadian:function(t,e){return e=e||1,this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},setDegree:function(t,e){var i=t*Math.DEG_TO_RAD;return e=e||1,this.x=Math.cos(i)*e,this.y=Math.sin(i)*e,this},setRandom:function(t,e,i){return t=t||0,e=e||360,i=i||1,this.setDegree(Math.randf(t,e),i),this},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mul:function(t){return this.x*=t,this.y*=t,this},div:function(t){return t=t||.01,this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},distanceSquared:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},normalize:function(){var t=this.length();return this.div(t),this},toAngle:function(){return Math.atan2(this.y,this.x)},toStyleString:function(){return"{x:{x}, y:{y}}".format(this)},toString:function(){return"{x:{x}, y:{y}}".format(this)},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this}}),tm.geom.Vector2.min=function(t,e){return tm.geom.Vector2(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y)},tm.geom.Vector2.max=function(t,e){return tm.geom.Vector2(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y)},tm.geom.Vector2.add=function(t,e){return tm.geom.Vector2(t.x+e.x,t.y+e.y)},tm.geom.Vector2.sub=function(t,e){return tm.geom.Vector2(t.x-e.x,t.y-e.y)},tm.geom.Vector2.mul=function(t,e){return tm.geom.Vector2(t.x*e,t.y*e)},tm.geom.Vector2.div=function(t,e){return tm.geom.Vector2(t.x/e,t.y/e)},tm.geom.Vector2.negate=function(t){return tm.geom.Vector2(-t.x,-t.y)},tm.geom.Vector2.dot=function(t,e){return t.x*e.x+t.y*e.y},tm.geom.Vector2.cross=function(t,e){return t.x*e.y-t.y*e.x},tm.geom.Vector2.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},tm.geom.Vector2.distanceSquared=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)},tm.geom.Vector2.manhattanDistance=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},tm.geom.Vector2.reflect=function(t,e){var i=Vector2.dot(t,e),n=Vector2.mul(e,2*i);return tm.geom.Vector2.sub(t,n)},tm.geom.Vector2.lerp=function(t,e,i){return tm.geom.Vector2(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},tm.geom.Vector2.slerp=function(t,e,i){},tm.geom.Vector2.random=function(t,e,i){return t=t||0,e=e||360,i=i||1,tm.geom.Vector2().setDegree(Math.randf(t,e),i)},tm.geom.Vector2.ZERO=tm.geom.Vector2(0,0),tm.geom.Vector2.LEFT=tm.geom.Vector2(-1,0),tm.geom.Vector2.RIGHT=tm.geom.Vector2(1,0),tm.geom.Vector2.UP=tm.geom.Vector2(0,1),tm.geom.Vector2.DOWN=tm.geom.Vector2(0,-1)}(),tm.geom=tm.geom||{},function(){tm.geom.Vector3=tm.createClass({x:0,y:0,z:0,init:function(t,e,i){this.set(t,e,i)},set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setNumber:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setArray:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this},setObject:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},setString:function(t){var e=t.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);return this.x=parseFloat(e[1]),this.y=parseFloat(e[3]),this.z=parseFloat(e[5]),this},setAngle:function(t,e,i){return i=i||1,this.x=i*Math.cos(t)*Math.sin(e),this.y=i*Math.sin(t),this.z=i*Math.cos(t)*Math.cos(e),this},setRadian:function(t,e,i){return this.setAngle(t,e,i)},setDegree:function(t,e,i){return this.setAngle(t*Math.DEG_TO_RAD,e*Math.DEG_TO_RAD,i)},setSmart:function(t,e,i){var n=arguments[0];if(3===arguments.length)this.x=t,this.y=e,this.z=i;else if(n instanceof Array)this.x=n[0],this.y=n[1],this.z=n[2];else if(n instanceof Object)this.x=n.x,this.y=n.y,this.z=n.z;else if("string"==typeof n){var s=n.match(/(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?),\s*(-?\d+(\.{1}\d+)?)/);this.x=parseFloat(s[1]),this.y=parseFloat(s[3]),this.z=parseFloat(s[5])}return this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},mul:function(t){return this.x*=t,this.y*=t,this.z*=t,this},div:function(t){return console.assert(0!=t,"0 division!!"),this.x/=t,this.y/=t,this.z/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){var e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,n=this.x*t.y-this.y*t.x;return this.set(e,i,n),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){var t=this.length();return this.div(t),this},toVector2:function(){},toAngleXY:function(){return Math.atan2(this.y,this.x)},to3D:function(){},equals:function(t,e,i){return this.x===t&&this.y===e&&this.z===i},equalsArray:function(t){return this.equals(t[0],t[1],t[2])},equalsObject:function(t){return this.equals(t.x,t.y,t.z)},equalsSmart:function(){},toStyleString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},toString:function(){return"{x:{x}, y:{y}, z:{z}}".format(this)},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,
this},setZ:function(t){return this.z=t,this}}),tm.geom.Vector3.min=function(t,e){return Vector3(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y,t.z<e.z?t.z:e.z)},tm.geom.Vector3.max=function(t,e){return Vector3(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y,t.z>e.z?t.z:e.z)},tm.geom.Vector3.add=function(t,e){return tm.geom.Vector3(t.x+e.x,t.y+e.y,t.z+e.z)},tm.geom.Vector3.sub=function(t,e){return tm.geom.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)},tm.geom.Vector3.mul=function(t,e){return tm.geom.Vector3(t.x*e,t.y*e,t.z*e)},tm.geom.Vector3.div=function(t,e){return tm.geom.Vector3(t.x/e,t.y/e,t.z/e)},tm.geom.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},tm.geom.Vector3.cross=function(t,e){return tm.geom.Vector3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},tm.geom.Vector3.negate=function(t){return tm.geom.Vector3(-t.x,-t.y,-t.z)},tm.geom.Vector3.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))},tm.geom.Vector3.distanceSquared=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2)},tm.geom.Vector3.manhattanDistance=function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z)},tm.geom.Vector3.reflect=function(t,e){var i=Vector3.dot(t,e),n=Vector3.mul(e,2*i);return Vector3.sub(t,n)},tm.geom.Vector3.lerp=function(t,e,i){return tm.geom.Vector3(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i,t.z+(e.z-t.z)*i)},tm.geom.Vector3.slerp=function(t,e,i){},tm.geom.Vector3.random=function(t,e,i,n,s){return t=t||0,e=e||360,i=i||0,n=n||360,s=s||1,TM.Geom.Vector3().setFromDegree(TM.randomf(t,e),TM.randomf(i,n),s)},tm.geom.Vector3.ZERO=tm.geom.Vector3(0,0,0),tm.geom.Vector3.LEFT=tm.geom.Vector3(-1,0,0),tm.geom.Vector3.RIGHT=tm.geom.Vector3(1,0,0),tm.geom.Vector3.UP=tm.geom.Vector3(0,1,0),tm.geom.Vector3.DOWN=tm.geom.Vector3(0,-1,0),tm.geom.Vector3.FORWARD=tm.geom.Vector3(0,0,-1),tm.geom.Vector3.BACKWARD=tm.geom.Vector3(0,0,1)}(),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Matrix33",{m:null,init:function(){this.m=[],arguments.length>=9?this.set.apply(this,arguments):this.identity()},clone:function(){var t=this.m;return tm.geom.Matrix33(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},set:function(t,e,i,n,s,r,a,o,h){return console.assert(arguments.length>=9,""),this.m00=t,this.m01=e,this.m02=i,this.m10=n,this.m11=s,this.m12=r,this.m20=a,this.m21=o,this.m22=h,this},setArray:function(t){return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},setObject:function(t){return this.set(t.m00,t.m01,t.m02,t.m10,t.m11,t.m12,t.m20,t.m21,t.m22),this},identity:function(){var t=this.m;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},transpose:function(){return this.m.swap(1,3),this.m.swap(2,6),this.m.swap(5,7),this},invert:function(){var t=this.m,e=t[0],i=t[3],n=t[6],s=t[1],r=t[4],a=t[7],o=t[2],h=t[5],l=t[8],u=this.determinant();return this.m00=(r*l-a*h)/u,this.m01=(s*l-a*o)/u*-1,this.m02=(s*h-r*o)/u,this.m10=(i*l-n*h)/u*-1,this.m11=(e*l-n*o)/u,this.m12=(e*h-i*o)/u*-1,this.m20=(i*a-n*r)/u,this.m21=(e*a-n*s)/u*-1,this.m22=(e*r-i*s)/u,this.transpose(),this},determinant:function(){var t=this.m,e=t[0],i=t[3],n=t[6],s=t[1],r=t[4],a=t[7],o=t[2],h=t[5],l=t[8];return e*r*l+s*h*n+i*a*o-n*r*o-i*s*l-a*h*e},zero:function(){return this.set(0,0,0,0,0,0,0,0,0),this},translate:function(t,e){var i=this.m;return i[6]=i[0]*t+i[3]*e+i[6],i[7]=i[1]*t+i[4]*e+i[7],i[8]=i[2]*t+i[5]*e+i[8],this},rotateX:function(t){return this.multiply(tm.geom.Matrix33.rotateX(t))},rotateY:function(t){return this.multiply(tm.geom.Matrix33.rotateY(t))},rotateZ:function(t){var e=(Math.sin(t),Math.cos(t),this.m);e[0],e[1],e[2],e[3],e[4],e[5];return this.multiply(tm.geom.Matrix33.rotateZ(t))},scale:function(t,e){var i=this.m;return i[0]*=t,i[3]*=e,i[1]*=t,i[4]*=e,i[2]*=t,i[5]*=e,this},multiply:function(t){var e=this.m,i=t.m,n=e[0],s=e[3],r=e[6],a=e[1],o=e[4],h=e[7],l=e[2],u=e[5],c=e[8],m=i[0],p=i[3],d=i[6],f=i[1],g=i[4],y=i[7],b=i[2],v=i[5],x=i[8];return e[0]=n*m+s*f+r*b,e[3]=n*p+s*g+r*v,e[6]=n*d+s*y+r*x,e[1]=a*m+o*f+h*b,e[4]=a*p+o*g+h*v,e[7]=a*d+o*y+h*x,e[2]=l*m+u*f+c*b,e[5]=l*p+u*g+c*v,e[8]=l*d+u*y+c*x,this},multiplyVector2:function(t){var e=this.m00*t.x+this.m01*t.y+this.m02,i=this.m10*t.x+this.m11*t.y+this.m12;return tm.geom.Vector2(e,i)},multiplyVector3:function(t){var e=this.m00*t.x+this.m01*t.y+this.m02*t.z,i=this.m10*t.x+this.m11*t.y+this.m12*t.z,n=this.m20*t.x+this.m21*t.y+this.m22*t.z;return tm.geom.Vector3(e,i,n)},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)}}),tm.geom.Matrix33.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(t){this.m[0]=t}}),tm.geom.Matrix33.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(t){this.m[1]=t}}),tm.geom.Matrix33.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(t){this.m[2]=t}}),tm.geom.Matrix33.prototype.accessor("m01",{get:function(){return this.m[3]},set:function(t){this.m[3]=t}}),tm.geom.Matrix33.prototype.accessor("m11",{get:function(){return this.m[4]},set:function(t){this.m[4]=t}}),tm.geom.Matrix33.prototype.accessor("m21",{get:function(){return this.m[5]},set:function(t){this.m[5]=t}}),tm.geom.Matrix33.prototype.accessor("m02",{get:function(){return this.m[6]},set:function(t){this.m[6]=t}}),tm.geom.Matrix33.prototype.accessor("m12",{get:function(){return this.m[7]},set:function(t){this.m[7]=t}}),tm.geom.Matrix33.prototype.accessor("m22",{get:function(){return this.m[8]},set:function(t){this.m[8]=t}}),tm.geom.Matrix33.prototype.accessor("a",{get:function(){return this.m[0]},set:function(t){this.m[0]=t}}),tm.geom.Matrix33.prototype.accessor("b",{get:function(){return this.m[3]},set:function(t){this.m[3]=t}}),tm.geom.Matrix33.prototype.accessor("c",{get:function(){return this.m[1]},set:function(t){this.m[1]=t}}),tm.geom.Matrix33.prototype.accessor("d",{get:function(){return this.m[4]},set:function(t){this.m[4]=t}}),tm.geom.Matrix33.prototype.accessor("tx",{get:function(){return this.m[6]},set:function(t){this.m[6]=t}}),tm.geom.Matrix33.prototype.accessor("ty",{get:function(){return this.m[7]},set:function(t){this.m[7]=t}}),tm.geom.Matrix33.translate=function(t,e){return tm.geom.Matrix33(1,0,t,0,1,e,0,0,1)},tm.geom.Matrix33.rotateX=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix33(1,0,0,0,e,-i,0,i,e)},tm.geom.Matrix33.rotateY=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix33(e,0,i,0,1,0,-i,0,e)},tm.geom.Matrix33.rotateZ=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix33(e,-i,0,i,e,0,0,0,1)},tm.geom.Matrix33.scale=function(t,e){var i=tm.geom.Matrix33();return void 0==e&&(e=t),i.set(t,0,0,0,e,0,0,0,1),i}}(),tm.geom=tm.geom||{},function(){tm.geom.Matrix44=tm.createClass({m:null,init:function(){this.m=[],arguments.length>=16?this.set.apply(this,arguments):this.identity()},set:function(t,e,i,n,s,r,a,o,h,l,u,c,m,p,d,f){return console.assert(arguments.length>=16,""),this.m00=t,this.m01=e,this.m02=i,this.m03=n,this.m10=s,this.m11=r,this.m12=a,this.m13=o,this.m20=h,this.m21=l,this.m22=u,this.m23=c,this.m30=m,this.m31=p,this.m32=d,this.m33=f,this},setArray:function(t){return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setObject:function(t){return this.set(t.m00,t.m01,t.m02,t.m03,t.m10,t.m11,t.m12,t.m13,t.m20,t.m21,t.m22,t.m23,t.m30,t.m31,t.m32,t.m33),this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},transpose:function(){return this.m.swap(1,4),this.m.swap(2,8),this.m.swap(3,12),this.m.swap(6,9),this.m.swap(7,13),this.m.swap(11,14),this},translate:function(t,e,i){return this.multiply(tm.geom.Matrix44.translate(t,e,i))},rotate:function(t){console.error("Unimplemented")},rotateX:function(t){return this.multiply(tm.geom.Matrix44.rotateX(t))},rotateY:function(t){return this.multiply(tm.geom.Matrix44.rotateY(t))},rotateZ:function(t){return this.multiply(tm.geom.Matrix44.rotateZ(t))},scale:function(t,e,i){return this.multiply(tm.geom.Matrix44.scale(t,e,i))},zero:function(){return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this},multiply:function(t){var e=this.m00*t.m00+this.m01*t.m10+this.m02*t.m20+this.m03*t.m30,i=this.m00*t.m01+this.m01*t.m11+this.m02*t.m21+this.m03*t.m31,n=this.m00*t.m02+this.m01*t.m12+this.m02*t.m22+this.m03*t.m32,s=this.m00*t.m03+this.m01*t.m13+this.m02*t.m23+this.m03*t.m33,r=this.m10*t.m00+this.m11*t.m10+this.m12*t.m20+this.m13*t.m30,a=this.m10*t.m01+this.m11*t.m11+this.m12*t.m21+this.m13*t.m31,o=this.m10*t.m02+this.m11*t.m12+this.m12*t.m22+this.m13*t.m32,h=this.m10*t.m03+this.m11*t.m13+this.m12*t.m23+this.m13*t.m33,l=this.m20*t.m00+this.m21*t.m10+this.m22*t.m20+this.m23*t.m30,u=this.m20*t.m01+this.m21*t.m11+this.m22*t.m21+this.m23*t.m31,c=this.m20*t.m02+this.m21*t.m12+this.m22*t.m22+this.m23*t.m32,m=this.m20*t.m03+this.m21*t.m13+this.m22*t.m23+this.m23*t.m33,p=this.m30*t.m00+this.m31*t.m10+this.m32*t.m20+this.m33*t.m30,d=this.m30*t.m01+this.m31*t.m11+this.m32*t.m21+this.m33*t.m31,f=this.m30*t.m02+this.m31*t.m12+this.m32*t.m22+this.m33*t.m32,g=this.m30*t.m03+this.m31*t.m13+this.m32*t.m23+this.m33*t.m33;return this.set(e,i,n,s,r,a,o,h,l,u,c,m,p,d,f,g)},getAxisX:function(){return TM.Geom.Vector3(this.m00,this.m01,this.m02)},getAxisY:function(){return TM.Geom.Vector3(this.m10,this.m11,this.m12)},getAxisZ:function(){return TM.Geom.Vector3(this.m20,this.m21,this.m22)},setAxisX:function(t){this.m00=t.x,this.m01=t.y,this.m02=t.z},setAxisY:function(t){this.m10=t.x,this.m11=t.y,this.m12=t.z},setAxisZ:function(t){this.m20=t.x,this.m21=t.y,this.m22=t.z},toMatrix33:function(){},toArray:function(){return this.m.slice()},toString:function(){return"|{m00}, {m01}, {m02}, {m03}|\n|{m10}, {m11}, {m12}, {m13}|\n|{m20}, {m21}, {m22}, {m23}|\n|{m30}, {m31}, {m32}, {m33}|".format(this)}}),tm.geom.Matrix44.prototype.accessor("m00",{get:function(){return this.m[0]},set:function(t){this.m[0]=t}}),tm.geom.Matrix44.prototype.accessor("m10",{get:function(){return this.m[1]},set:function(t){this.m[1]=t}}),tm.geom.Matrix44.prototype.accessor("m20",{get:function(){return this.m[2]},set:function(t){this.m[2]=t}}),tm.geom.Matrix44.prototype.accessor("m30",{get:function(){return this.m[3]},set:function(t){this.m[3]=t}}),tm.geom.Matrix44.prototype.accessor("m01",{get:function(){return this.m[4]},set:function(t){this.m[4]=t}}),tm.geom.Matrix44.prototype.accessor("m11",{get:function(){return this.m[5]},set:function(t){this.m[5]=t}}),tm.geom.Matrix44.prototype.accessor("m21",{get:function(){return this.m[6]},set:function(t){this.m[6]=t}}),tm.geom.Matrix44.prototype.accessor("m31",{get:function(){return this.m[7]},set:function(t){this.m[7]=t}}),tm.geom.Matrix44.prototype.accessor("m02",{get:function(){return this.m[8]},set:function(t){this.m[8]=t}}),tm.geom.Matrix44.prototype.accessor("m12",{get:function(){return this.m[9]},set:function(t){this.m[9]=t}}),tm.geom.Matrix44.prototype.accessor("m22",{get:function(){return this.m[10]},set:function(t){this.m[10]=t}}),tm.geom.Matrix44.prototype.accessor("m32",{get:function(){return this.m[11]},set:function(t){this.m[11]=t}}),tm.geom.Matrix44.prototype.accessor("m03",{get:function(){return this.m[12]},set:function(t){this.m[12]=t}}),tm.geom.Matrix44.prototype.accessor("m13",{get:function(){return this.m[13]},set:function(t){this.m[13]=t}}),tm.geom.Matrix44.prototype.accessor("m23",{get:function(){return this.m[14]},set:function(t){this.m[14]=t}}),tm.geom.Matrix44.prototype.accessor("m33",{get:function(){return this.m[15]},set:function(t){this.m[15]=t}}),tm.geom.Matrix44.translate=function(t,e,i){return tm.geom.Matrix44(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1)},tm.geom.Matrix44.rotateX=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix44(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1)},tm.geom.Matrix44.rotateY=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix44(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1)},tm.geom.Matrix44.rotateZ=function(t){var e=Math.cos(t),i=Math.sin(t);return tm.geom.Matrix44(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1)},tm.geom.Matrix44.scale=function(t,e,i){var n=tm.geom.Matrix44();return void 0==e&&(e=t),void 0==i&&(i=t),n.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),n},tm.geom.Matrix44.perspective=function(t,e,i,n){var s=1/Math.tan(.5*t*Math.PI/180),r=s/e;return tm.geom.Matrix44(r,0,0,0,0,s,0,0,0,0,n/(n-i),i*n/(i-n),0,0,1,0)},tm.geom.Matrix44.ortho=function(t,e,i,n,s,r){var a=e-t,o=n-i,h=r-s;return tm.geom.Matrix44(2/a,0,0,0,0,2/o,0,0,0,0,-2/h,0,-(t+e)/a,-(n+i)/o,-(r+s)/h,1).transpose()},tm.geom.Matrix44.lookAt=function(t,e,i){var n=tm.geom.Vector3.sub(t,e).normalize(),s=tm.geom.Vector3.cross(i,n).normalize(),r=tm.geom.Vector3.cross(n,s).normalize(),a=tm.geom.Matrix44(s.x,r.x,n.x,0,s.y,r.y,n.y,0,s.z,r.z,n.z,0,0,0,0,1),o=tm.geom.Matrix44(1,0,0,0,0,1,0,0,0,0,1,0,-t.x,-t.y,-t.z,1);return o.multiply(a)}}(),tm.geom=tm.geom||{},function(){tm.geom.Rect=tm.createClass({x:0,y:0,width:0,height:0,init:function(t,e,i,n){this.set(t,e,i,n)},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},move:function(t,e){return this.x=t,this.y=e,this},moveBy:function(t,e){return this.x+=t,this.y+=e,this},resize:function(t,e){return this.width=t,this.height=e,this},resizeBy:function(t,e){return this.width+=t,this.height+=e,this},padding:function(t,e,i,n){switch(arguments.length){case 1:t=e=i=n=arguments[0];break;case 2:t=i=arguments[0],e=n=arguments[1];break;case 3:t=arguments[0],e=n=arguments[1],i=arguments[2]}return this.x+=n,this.y+=t,this.width-=n+e,this.height-=t+i,this},contains:function(t,e){return this.left<=t&&t<=this.right&&this.top<=e&&e<=this.bottom},clone:function(){return tm.geom.Rect(this.x,this.y,this.width,this.height)},toCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,(this.width<this.height?this.width:this.height)/2)},toArray:function(){return[this.x,this.y,this.width,this.height]}}),tm.geom.Rect.prototype.accessor("left",{get:function(){return this.x},set:function(t){this.width-=t-this.x,this.x=t}}),tm.geom.Rect.prototype.accessor("top",{get:function(){return this.y},set:function(t){this.height-=t-this.y,this.y=t}}),tm.geom.Rect.prototype.accessor("right",{get:function(){return this.x+this.width},set:function(t){this.width+=t-this.right}}),tm.geom.Rect.prototype.accessor("bottom",{get:function(){return this.y+this.height},set:function(t){this.height+=t-this.bottom}}),tm.geom.Rect.prototype.accessor("centerX",{get:function(){return this.x+this.width/2},set:function(t){}}),tm.geom.Rect.prototype.accessor("centerY",{get:function(){return this.y+this.height/2},set:function(t){}})}(),tm.geom=tm.geom||{},function(){tm.define("tm.geom.Circle",{x:0,y:0,radius:0,init:function(t,e,i){this.set(t,e,i)},set:function(t,e,i){return this.x=t,this.y=e,this.radius=i,this},move:function(t,e){return this.x=t,this.y=e,this},moveBy:function(t,e){return this.x+=t,this.y+=e,this},resize:function(t){return this.radius=t,this},resizeBy:function(t){return this.radius+=t,this},contains:function(t,e){var i=this.x-t,n=this.y-e,s=i*i+n*n;return s<=this.radius*this.radius},clone:function(){return tm.geom.Circle(this.x,this.y,this.radius)},toRect:function(){return tm.geom.Rect(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},toArray:function(){return[this.x,this.y,this.radius]}}),tm.geom.Circle.prototype.getter("left",function(){return this.x-this.radius}),tm.geom.Circle.prototype.getter("top",function(){return this.y-this.radius}),tm.geom.Circle.prototype.getter("right",function(){return this.x+this.radius}),tm.geom.Circle.prototype.getter("bottom",function(){return this.y+this.radius})}(),tm.collision=tm.collision||{},function(){tm.collision,tm.collision.testCircleCircle=function(t,e){var i=tm.geom.Vector2.distanceSquared(t,e);return i<=Math.pow(t.radius+e.radius,2)},tm.collision.testRectRect=function(t,e){return t.left<e.right&&t.right>e.left&&t.top<e.bottom&&t.bottom>e.top},tm.collision.testCircleRect=function(t,e){var i=tm.geom.Rect(e.left-t.radius,e.top-t.radius,e.width+2*t.radius,e.height+2*t.radius);if(0==i.contains(t.x,t.y))return!1;var n=tm.geom.Rect(e.left-t.radius,e.top,e.width+2*t.radius,e.height);if(n.contains(t.x,t.y))return!0;if(n.set(e.left,e.top-t.radius,e.width,e.height+2*t.radius),n.contains(t.x,t.y))return!0;var s=tm.geom.Circle(t.x,t.y,t.radius);return s.contains(e.left,e.top)?!0:s.contains(e.right,e.top)?!0:s.contains(e.right,e.bottom)?!0:s.contains(e.left,e.bottom)?!0:!1},tm.collision.testRectCircle=function(t,e){return this.testCircleRect(e,t)}}(),tm.dom=tm.dom||{},function(){tm.dom.Element=tm.createClass({element:null,init:function(){this.set.apply(this,arguments)},set:function(t){"string"==typeof t?this.element=document.querySelector(t):void 0!=t?this.element=t:this.element=document},append:function(t){return this.element.appendChild(t.element),this},prepend:function(t){return this.element.insertBefore(t.element,this.element.firstChild),this},after:function(t){return this.element.parentNode.insertBefore(t.element,this.element.nextSibling),this},before:function(t){return this.element.parentNode.insertBefore(t.element,this.element),this},appendTo:function(t){return t.append(this),this},prependTo:function(t){return t.prepend(this),this},clone:function(){return tm.dom.Element(this.element.cloneNode(!0))},remove:function(){return this.element.parentNode.removeChild(this.element),this},create:function(t,e){var i=tm.dom.Element(document.createElement(t));return e||(e="append"),this[e](i),i},query:function(t,e){var i=e?this.element.querySelectorAll(t)[e]:this.element.querySelector(t);return tm.dom.Element(i)},queryAll:function(t){var e=this.element.querySelectorAll(t);return tm.dom.ElementList(e)},fixed:function(t,e,i,n){return this.style.set("position","fixed"),t&&(this.x=t),e&&(this.y=e),i&&(this.width=i),n&&(this.height=n),this},absolute:function(t,e,i,n){return this.style.set("position","absolute"),t&&(this.x=t),e&&(this.y=e),i&&(this.width=i),n&&(this.height=n),this},fullScreen:function(){this.element.webkitRequestFullScreen()},show:function(){this.visible=!0},hide:function(){this.visible=!1},toString:function(){return"tm.dom.element"},getElement:function(){return this.element}}),tm.dom.Element.prototype.accessor("html",{get:function(){return this.element.innerHTML},set:function(t){this.element.innerHTML=t}}),tm.dom.Element.prototype.accessor("value",{get:function(){return this.element.value},set:function(t){this.element.value=t}}),tm.dom.Element.prototype.accessor("x",{get:function(){return Number(this.element.style.left.replace("px",""))},set:function(t){this.element.style.left=t+"px"}}),tm.dom.Element.prototype.accessor("y",{get:function(){return Number(this.element.style.top.replace("px",""))},set:function(t){this.element.style.top=t+"px"}}),tm.dom.Element.prototype.accessor("width",{get:function(){return Number(this.element.style.width.replace("px",""))},set:function(t){this.element.style.width=t+"px"}}),tm.dom.Element.prototype.accessor("height",{get:function(){return Number(this.element.style.height.replace("px",""))},set:function(t){this.element.style.height=t+"px"}}),tm.dom.Element.prototype.accessor("color",{get:function(){return this.element.style.color},set:function(t){this.element.style.color=t}}),tm.dom.Element.prototype.accessor("backgroundColor",{get:function(){return this.element.style.backgroundColor},set:function(t){this.element.style.backgroundColor=t}}),tm.dom.Element.prototype.accessor("visible",{get:function(){return"hidden"!=this.element.style.visibility},set:function(t){this.element.style.visibility=1==t?"visible":"hidden"}}),tm.dom.Element.prototype.accessor("text",{get:function(){return this.element.innerText||this.element.textContent},set:function(t){this.element.innerText?this.element.innerText=t:this.element.textContent=t}}),tm.dom.Element.prototype.getter("classList",function(){return this.element.classList}),tm.dom.Element.prototype.getter("parent",function(){return void 0!=this.element.parentNode?tm.dom.Element(this.element.parentNode):null}),tm.dom.Element.prototype.getter("prev",function(){return void 0!=this.element.previousSibling?tm.dom.Element(this.element.previousSibling):null}),tm.dom.Element.prototype.getter("next",function(){return void 0!=this.element.nextSibling?tm.dom.Element(this.element.nextSibling):null}),tm.dom.Element.prototype.getter("children",function(){return tm.dom.ElementList(this.element.children)})}(),function(){tm.dom.ElementList=tm.createClass({superClass:Array,init:function(t){if("string"==typeof arguments[0]){var e=arguments[0];t=document.querySelectorAll(e)}else if(void 0==t)return;for(var i=0,n=t.length;n>i;++i)this.push(tm.dom.Element(t[i]))},toString:function(){return""}})}(),tm.dom=tm.dom||{},function(){Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0}),Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1}),Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()}}(),function(){KeyboardEvent.prototype.getter("character",function(){return String.fromCharCode(this.keyCode)})}(),function(){MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top})}(),function(){void 0!==window.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top}))}(),function(){tm.dom.Event=tm.createClass({element:null,funcList:null,funcIndex:0,init:function(t){this.element=t,this.domElement=t.element,this.funcList={}},add:function(t,e,i){var n=this.element,s=function(t){var i=e.apply(n,arguments);return i===!1&&(t.preventDefault(),t.returnValue=!1,t.stopPropagation()),i};return this._funcIndex=this._funcIndex||0,i=i||this._funcIndex++,this.funcList[t]=this.funcList[t]||{},this.funcList[t][i]=s,e._id=i,this.domElement.addEventListener(t,s,!1),this},remove:function(t,e){var i="function"==typeof e?e._id:e,n=this.getFunc(t,i);this.domElement.removeEventListener(t,n,!1),delete this.funcList[t][i]},click:function(t,e){return this.add("click",t,e),this},mdlclick:function(t,e){var i=function(e){1==e.button&&t(e)};this.add("click",i,e)},pointstart:function(t,e){this.add(tm.dom.Event.POINT_START,t,e)},pointmove:function(t,e){this.add(tm.dom.Event.POINT_MOVE,t,e)},pointend:function(t,e){this.add(tm.dom.Event.POINT_END,t,e)},hover:function(t,e){return this.add("mouseover",t,e),this},one:function(t,e,i){var n=this,s=this.element,r=function(){var i=e.apply(s,arguments);return n.remove(t,r),i};return this.add(t,r,i),this},toggle:function(t,e){for(var i=this,n=this.element,s=[],r=0;r<e.length;++r){var a=function(r){return function(){var a=e[r].apply(n,arguments);if(a!==!1){var o=(r+1)%e.length;i.one(t,s[o])}}}(r);s.push(a)}return this.one(t,s[0]),this},getFunc:function(t,e){return this.funcList[t][e]}}),tm.dom.Event.POINT_START=tm.isMobile?"touchstart":"mousedown",tm.dom.Event.POINT_MOVE=tm.isMobile?"touchmove":"mousemove",tm.dom.Event.POINT_END=tm.isMobile?"touchend":"mouseup",tm.dom.Element.prototype.getter("event",function(){return this._event||(this._event=tm.dom.Event(this))})}(),tm.dom=tm.dom||{},function(){tm.dom.Attr=tm.createClass({element:null,init:function(t){this.element=t},set:function(t,e){return this.element.setAttribute(t,e),this},add:function(t,e){var i=this.get(t);return e=i?i+" "+e:e,this.element.setAttribute(t,e),this},remove:function(t,e){if(e){var i=this.get(t),n=i?i.replace(e,"").replace("  "," "):"";this.element.setAttribute(t,n.trim())}else this.element.removeAttribute(t);return this},get:function(t){return this.element.getAttribute(t)},contains:function(t,e){var i=this.get(t);return 1==arguments.length?null!=i:2==arguments.length?(" "+i+" ").indexOf(" "+e+" ")>-1:!1},toggle:function(t,e){return this.contains(t,e)?this.remove(t,e):this.add(t,e),this}}),tm.dom.Element.prototype.getter("attr",function(){return this._attr||(this._attr=tm.dom.Attr(this.element))})}(),tm.dom=tm.dom||{},function(){tm.dom.Style=tm.createClass({element:null,init:function(t){this.element=t},set:function(t,e){return this.element.style[t]=e,this},remove:function(t){return this.element.style.removeProperty(t),this},clear:function(t){return this},get:function(t){return this.element.style[t]},getPropValue:function(t){return document.defaultView.getComputedStyle(this.element,"").getPropertyValue(t)}}),tm.dom.Element.prototype.getter("style",function(){return this._style||(this._style=tm.dom.Style(this.element))})}(),tm.dom=tm.dom||{},function(){var t=tm.VENDER_PREFIX,e=t+"Animation",i=t+"AnimationEnd",n=t+"AnimationPlayState",s=t+"AnimationName",r=t+"AnimationDuration",a=t+"AnimationTimingFunction",o=t+"AnimationDelay",h=t+"AnimationIterationCount";tm.dom.Anim=tm.createClass({init:function(t){this.element=t;var e=this;this.element.addEventListener(i,function(){e.stop()},!1)},start:function(){return this.element.style[n]="running",this},stop:function(){return this.element.style[n]="paused",this},setProperty:function(t){if("string"==typeof t)this.element.style[e]=t;else for(var i in t){var n=l[i],s=t[i];n.call(this,s)}return this},setName:function(t){return this.element.style[s]=t,this},setDuration:function(t){return this.element.style[r]=t,this},setTimingFunction:function(t){return this.element.style[a]=t,this},setIterationCount:function(t){return this.element.style[h]=t,this},setDelay:function(t){return this.element.style[o]=t,this},setDirection:function(t){return this.element.style[r]=t,this}});var l={name:tm.dom.Anim.prototype.setName,duration:tm.dom.Anim.prototype.setDuration,timingFunction:tm.dom.Anim.prototype.setTimingFunction,iterationCount:tm.dom.Anim.prototype.setIterationCount,delay:tm.dom.Anim.prototype.setDelay,Name:tm.dom.Anim.prototype.setName,Duration:tm.dom.Anim.prototype.setDuration,TimingFunction:tm.dom.Anim.prototype.setTimingFunction,IterationCount:tm.dom.Anim.prototype.setIterationCount,Delay:tm.dom.Anim.prototype.setDelay};tm.dom.Element.prototype.getter("anim",function(){return this._anim||(this._anim=tm.dom.Anim(this.element))})}(),function(){tm.dom.Trans=tm.createClass({element:null,init:function(t){this.element=t},to:function(t,e){return this.set(t).duration(e||1e3),this},set:function(t){var i=this.element.style,n=[];for(var s in t){var r=e(s);n.push(r.toDash()),i[r]=t[s]+""}return i[tm.dom.Trans.PROPERTY]=n.join(", "),this},duration:function(t){var e=this.element.style;return"number"==typeof t&&(t+="ms"),e[tm.dom.Trans.DURATION]=t,this},easing:function(t){var e=this.element.style;return e[tm.dom.Trans.TIMING_FUNCTION]=func,this},end:function(t){var e=tm.dom.Element(this.element);return e.event.add(tm.dom.Trans.END_EVENT,t),this},reset:function(){var t=this.element.style;return t[tm.dom.Trans.PROPERTY]="none",this},translate:function(t,e,i){return this.to({transform:"translate({0}px,{1}px)".format(t,e)},i),this},translate3d:function(t,e,i,n){return this.to({transform:"translate3d({0}px,{1}px,{2}px)".format(t,e,i)},n),this},rotate:function(t,e){return this.to({transform:"rotate({0}deg)".format(t)},e),this},rotate3d:function(t,e,i,n,s){return this.to({transform:"rotate3d({0},{1},{2},{3}deg)".format(t,e,i,n)},s),this},scale:function(t,e,i){return this.to({transform:"scale({0},{1})".format(t,e)},i),this},transform:function(){},setProp:function(t){var i=this.element.style,n=[];for(var s in t){var r=e(s);n.push(r.toDash()),i[r]=t[s]}return i[tm.dom.Trans.PROPERTY]=n.join(", "),this},setDuration:function(t){var e=this.element.style;return e[tm.dom.Trans.DURATION]=t,this},setTimingFunction:function(t){var e=this.element.style;return e[tm.dom.Trans.TIMING_FUNCTION]=t,this},resetProp:function(){var t=this.element.style;return t[tm.dom.Trans.PROPERTY]="none",this},setEndFunction:function(t){var e=tm.dom.Element(this.element);return e.event.add(tm.dom.Trans.END_EVENT,t),this}}),tm.dom.Trans.PROPERTY=tm.VENDER_PREFIX+"TransitionProperty",tm.dom.Trans.DURATION=tm.VENDER_PREFIX+"TransitionDuration",tm.dom.Trans.TIMING_FUNCTION=tm.VENDER_PREFIX+"TransitionTimingFunction",tm.dom.Trans.DELAY=tm.VENDER_PREFIX+"TransitionDelay",tm.dom.Trans.END_EVENT=function(){return{webkit:"webkitTransitionEnd",moz:"transitionend",o:"oTransitionEnd"}[tm.VENDER_PREFIX]}(),tm.dom.Element.prototype.getter("trans",function(){return this._trans||(this._trans=tm.dom.Trans(this.element))});var t={transform:!0},e=function(e){return t[e]===!0?"-"+tm.VENDER_PREFIX+e.capitalizeFirstLetter():e}}(),function(){tm.define("tm.dom.Data",{element:null,init:function(t){this.element=t},set:function(t,e){var i="data-"+t.toDash();return this.element.setAttribute(i,e),this},get:function(t,e){var i="data-"+t.toDash();return this.element.attributes[i].value}}),tm.dom.Element.prototype.getter("data",function(){return this._data||(this._data=tm.dom.Data(this.element))})}(),function(){tm.asset=tm.asset||{},tm.asset.Manager={assets:{},get:function(t){return this.assets[t]},set:function(t,e){return this.assets[t]=e,this},contains:function(t){return this.assets[t]?!0:!1}}}(),function(){tm.define("tm.asset.Loader",{superClass:"tm.event.EventDispatcher",init:function(){this.superInit(),this.assets={}},contains:function(t){return this.assets[t]?!0:!1},load:function(t){return tm.util.Type.isObject(t)?this._loadByObject(t):this._loadString(arguments[0],arguments[1],arguments[2]),this},get:function(t){return this.assets[t]},set:function(t,e){return this.assets[t]=e,tm.asset.Manager.set(t,e),this},_load:function(t,e,i){e=e||t,i=i||e.split("?")[0].split("#")[0].split(".").last;var n=tm.asset.Loader._funcs[i](e,t);return this.set(t,n),n},_loadString:function(t,e,i){var n={};n[t]={url:e,type:i},this._loadByObject(n)},_loadByObject:function(t){var e=tm.util.Flow(Object.keys(t).length,function(){var t=tm.event.Event("load");this.dispatchEvent(t)}.bind(this)),i=function(t,i){var n=tm.event.Event("progress");n.key=i,n.asset=t,n.progress=(e.counter+1)/e.waits,this.dispatchEvent(n),e.pass()}.bind(this);Object.keys(t).each(function(e){var n=t[e],s=null;s="string"==typeof n?this._load(e,n):this._load(e,n.url||n.src||n.path,n.type),s.loaded?i(s,e):s.on("load",function(){i(s,e)})}.bind(this))}}),tm.asset.Loader._funcs=[],tm.asset.Loader.defineFunction("register",function(t,e){this._funcs[t]=e});var t=function(t){var e=tm.asset.Texture(t);return e},e=function(t){var e=tm.sound.WebAudio(t);return e},i=function(t){var e=tm.asset.MapSheet(t);return e},n=function(t){var e=tm.asset.SpriteSheet(t);return e},s=function(t){var e=tm.util.File();if("string"==typeof t)e.load({url:t,dataType:"json"});else{e.setData(t),e.loaded=!0}return e},r=function(t){var e=tm.asset.Script(t);return e};tm.asset.Loader.register("png",t),tm.asset.Loader.register("gif",t),tm.asset.Loader.register("jpg",t),tm.asset.Loader.register("jpeg",t),tm.asset.Loader.register("wav",e),tm.asset.Loader.register("mp3",e),tm.asset.Loader.register("ogg",e),tm.asset.Loader.register("m4a",e),tm.asset.Loader.register("json",s),tm.asset.Loader.register("tmx",i),tm.asset.Loader.register("tmss",n),tm.asset.Loader.register("js",r)}(),function(){tm.define("tm.asset.Texture",{superClass:"tm.event.EventDispatcher",element:null,loaded:!1,init:function(t){this.superInit(),this.element=new Image,!tm.isLocal()&&!/^data:/.test(t),this.element.src=t;var e=this;this.element.onload=function(){e.loaded=!0;var t=tm.event.Event("load");e.dispatchEvent(t)},this.element.onerror=function(e){console.error("[tmlib] {0}の読み込みに失敗!".format(t));var i=t.split("/").last.replace(".png","").split("?").first.split("#").first,n=e.target;n.src="http://dummyimage.com/128x128/444444/eeeeee&text="+i,n.onerror=null}},getElement:function(){return this.element}}),tm.asset.Texture.prototype.getter("width",function(){return this.element.width}),tm.asset.Texture.prototype.getter("height",function(){return this.element.height})}(),
function(){tm.define("tm.asset.SpriteSheet",{superClass:"tm.event.EventDispatcher",loaded:!1,init:function(t){this.superInit(),this.loaded=!1,"string"==typeof t?this.load(t):(this.parse(t),this.loaded=!0,this.dispatchEvent(tm.event.Event("load")))},load:function(t){tm.util.Ajax.load({url:t,dataType:"json",success:function(t){this.parse(t),this.loaded=!0}.bind(this)})},parse:function(t){if(this.frame=t.frame,"string"==typeof t.image){if(!tm.asset.Manager.contains(t.image)){var e=tm.asset.Loader();e.load(t.image)}this.image=tm.asset.Manager.get(t.image)}else this.image=t.image;if(this.image.loaded===!1)this.image.addEventListener("load",function(){this._calcFrames(t.frame);var e=tm.event.Event("load");this.dispatchEvent(e)}.bind(this),!1);else{this._calcFrames(t.frame);var i=tm.event.Event("load");this.dispatchEvent(i)}this._calcAnim(t.animations)},getFrame:function(t){return this.frames[t]},getAnimation:function(t){return this.animations[t]},_calcFrames:function(t){var e=this.frames=[],i=t.width,n=t.height,s=~~(this.image.width/i),r=~~(this.image.height/n);t.count||(t.count=s*r);for(var a=0,o=t.count;o>a;++a){var h=a%s,l=a/s|0,u={x:h*i,y:l*n,width:i,height:n};e.push(u)}},_calcAnim:function(t){this.animations={};for(var e in t){var i=t[e];i instanceof Array?this.animations[e]={frames:[].range(i[0],i[1]),next:i[2],frequency:i[3]||1}:"number"==typeof i?this.animations[e]={frames:[i],next:null,frequency:1}:this.animations[e]={frames:i.frames,next:i.next,frequency:i.frequency||1}}this.animations["default"]={frames:[].range(0,this.frame.count),next:"default",frequency:1}}})}(),function(){tm.define("tm.asset.MapSheet",{superClass:"tm.event.EventDispatcher",init:function(t){this.superInit(),this.loaded=!1,"string"==typeof t?tm.util.Ajax.load({url:t,success:function(t){var e=this._parse(t);this.$extend(e),this._checkImage()}.bind(this)}):(this.$extend(arguments[0]),this._checkImage())},_parse:function(t){var e=(Array.prototype.forEach,{}),i=new DOMParser,n=i.parseFromString(t,"text/xml"),s=this._attrToJSON(n.getElementsByTagName("map")[0]);return this.$extend(s),e.tilesets=this._parseTilesets(n),e.layers=this._parseLayers(n),e},_parseTilesets:function(t){var e=Array.prototype.forEach,i=this,n=[],s=t.getElementsByTagName("tileset");return e.call(s,function(t){var e={},s=i._propertiesToJson(t);s.src?e.image=s.src:e.image=t.getElementsByTagName("image")[0].getAttribute("source"),n.push(e)}),n},_parseLayers:function(t){var e=Array.prototype.forEach,i=[],n=t.getElementsByTagName("map")[0],s=[];return e.call(n.childNodes,function(t){("layer"==t.tagName||"objectgroup"==t.tagName||"imagelayer"==t.tagName)&&s.push(t)}),s.each(function(t){if("layer"==t.tagName){var n=t.getElementsByTagName("data")[0],s=n.getAttribute("encoding"),r={type:"layer",name:t.getAttribute("name")};"csv"==s?r.data=this._parseCSV(n.textContent):"base64"==s&&(r.data=this._parseBase64(n.textContent));var a=this._attrToJSON(t);r.$extend(a),i.push(r)}else if("objectgroup"==t.tagName){var r={type:"objectgroup",objects:[],name:t.getAttribute("name")};e.call(t.childNodes,function(t){if(3!=t.nodeType){var e=this._attrToJSON(t);e.properties=this._propertiesToJson(t),r.objects.push(e)}}.bind(this)),i.push(r)}else if("imagelayer"==t.tagName){var r={type:"imagelayer",name:t.getAttribute("name"),x:t.getAttribute("x")||0,y:t.getAttribute("y")||0,alpha:t.getAttribute("opacity")||1,visible:void 0===t.getAttribute("visible")||0!=t.getAttribute("visible")},o=t.getElementsByTagName("image")[0];r.image={source:o.getAttribute("source")},i.push(r)}}.bind(this)),i},_parseCSV:function(t){var e=t.split(","),i=[];return e.each(function(t,e){var n=parseInt(t,10)-1;i.push(n)}),i},_parseBase64:function(t){var e=atob(t.trim()),i=[];e=e.split("").map(function(t){return t.charCodeAt(0)});for(var n=0,s=e.length/4;s>n;++n){var r=e[4*n];i[n]=parseInt(r,10)-1}return i},_propertiesToJson:function(t){var e=t.getElementsByTagName("properties")[0],i={};if(void 0===e)return i;for(var n=0;n<e.childNodes.length;n++){var s=e.childNodes[n];"property"===s.tagName&&(i[s.getAttribute("name")]=s.getAttribute("value"))}return i},_attrToJSON:function(t){for(var e={},i=0;i<t.attributes.length;i++){var n=t.attributes[i].value;n=isNaN(parseFloat(n))?n:parseFloat(n),e[t.attributes[i].name]=n}return e},_checkImage:function(){var t=this,e=[];if(this.tilesets.length&&Array.prototype.push.apply(e,this.tilesets.map(function(t){return t.image})),this.layers.each(function(t){"imagelayer"==t.type&&e.push(t.image.source)}),e.length){var i=0,n=e.length,s=function(){if(i++,i==n){this.loaded=!0;var t=tm.event.Event("load");this.dispatchEvent(t)}}.bind(this);e.each(function(e){var r=tm.asset.Manager.get(e);if(r)if(r.loaded){if(++i,i==n){this.loaded=!0;var a=tm.event.Event("load");t.dispatchEvent(a)}}else r.addEventListener("load",s);else{var o=tm.asset.Loader();o.load(e);var h=tm.asset.Manager.get(e);h.addEventListener("load",s)}})}else{this.loaded=!0;var r=tm.event.Event("load");this.dispatchEvent(r)}}})}(),tm.asset=tm.asset||{},function(){tm.define("tm.asset.Font",{superClass:"tm.event.EventDispatcher",init:function(t,e,i){this.superInit();var n=tm.dom.Element("head").create("style");n.text="@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(e,t,i),tm.asset.Font.checkLoaded(e,function(){this.flare("load")}.bind(this))}}),tm.asset.Font.checkLoaded=function(t,e){var i=tm.graphics.Canvas(),n=i.context.font.split(" ")[1];i.context.font="40px "+n;var s="1234567890-^\\qwertyuiop@[asdfghjkl;:]zxcvbnm,./!\"#$%&'()=~|QWERTYUIOP`{ASDFGHJKL+*}ZXCVBNM<>?_１２３４５６７８９０－＾￥ｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ，．あいうかさたなをん時は金なり",r=i.context.measureText(s).width;i.context.font="40px "+t+", "+n;var a=function(){i.context.measureText(s).width!==r?e&&e():setTimeout(a,100)};setTimeout(a,100)},tm.asset.Loader.register("ttf",function(t,e){return tm.asset.Font(t,e,"truetype")}),tm.asset.Loader.register("otf",function(t,e){return tm.asset.Font(t,e,"opentype")}),tm.asset.Loader.register("woff",function(t,e){return tm.asset.Font(t,e,"woff")}),tm.asset.Loader.register("woff2",function(t,e){return tm.asset.Font(t,e,"woff2")})}(),tm.util=tm.util||{},function(){tm.define("tm.asset.Script",{superClass:"tm.event.EventDispatcher",element:null,loaded:!1,init:function(t){this.superInit(),this.loaded=!1,this.element=document.createElement("script"),this.element.type="text/javascript",this.element.src=t,this.element.charset="UTF-8",this.element.setAttribute("defer",!0),document.head.appendChild(this.element);var e=this;this.element.onload=function(){e.loaded=!0,e.fire(tm.event.Event("load"))}},getElement:function(){return this.element}}),tm.asset.Script.load=function(t){var e=tm.asset.Script(t);return e},tm.asset.Script.loadStats=function(t){t=t||"r11";var e=null;return e=-1!=["r6","r7","r8","r9","10"].indexOf(t)?"http://rawgithub.com/mrdoob/stats.js/"+t+"/build/Stats.js":"http://rawgithub.com/mrdoob/stats.js/"+t+"/build/stats.min.js",this.load(e)},tm.asset.Script.loadDatGUI=function(t){t=t||"0.5";var e="http://dat-gui.googlecode.com/git/build/dat.gui.js";return this.load(e)},tm.asset.Script.loadThree=function(t){var e="http://rawgithub.com/mrdoob/three.js/{version}/build/three.js";t=t||"r55";var i=e.format({version:t});return this.load(i)},tm.asset.Script.loadBulletML=function(t){var e="http://rawgithub.com/daishihmr/bulletml.js/{version}/target/bulletml.for.tmlib.js";t=t||"v0.4.2";var i=e.format({version:t});return this.load(i)}}(),tm.input=tm.input||{},function(){tm.input.Keyboard=tm.createClass({element:null,key:null,press:null,down:null,up:null,last:null,init:function(t){this.element=t||document,this.key={},this.press={},this.down={},this.up={},this.last={};var e=this;this.element.addEventListener("keydown",function(t){e.key[t.keyCode]=!0}),this.element.addEventListener("keyup",function(t){e.key[t.keyCode]=!1}),this.element.addEventListener("keypress",function(t){})},run:function(t){var e=this;t=t||30,tm.setLoop(function(){e._update(),e.update&&e.update()},1e3/t)},_update:function(){for(var t in this.key)this.last[t]=this.press[t],this.press[t]=this.key[t],this.down[t]=(this.press[t]^this.last[t])&this.press[t],this.up[t]=(this.press[t]^this.last[t])&this.last[t];return this},getKey:function(t){return"string"==typeof t&&(t=e[t]),1==this.press[t]},getKeyDown:function(t){return"string"==typeof t&&(t=e[t]),1==this.down[t]},getKeyUp:function(t){return"string"==typeof t&&(t=e[t]),1==this.up[t]},getKeyAngle:function(){var e=null,i=this.getKey("left")<<3|this.getKey("up")<<2|this.getKey("right")<<1|this.getKey("down");return 0!=i&&t.hasOwnProperty(i)&&(e=t[i]),e},getKeyDirection:function(){var t=tm.geom.Vector2(0,0);return this.getKey("left")?t.x=-1:this.getKey("right")&&(t.x=1),this.getKey("up")?t.y=-1:this.getKey("down")&&(t.y=1),t.x&&t.y&&t.div(Math.SQRT2),t},setKey:function(t,i){return"string"==typeof t&&(t=e[t]),this.key[t]=i,this},clearKey:function(){return this.key={},this}});var t={1:270,2:0,4:90,8:180,6:45,3:315,12:135,9:225,14:90,13:180,11:270,7:0},e={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,"forward slash":191,"/":191,"grave accent":192,"open bracket":219,"back slash":220,"close bracket":221,"single quote":222,space:32}}(),tm.input=tm.input||{},function(){tm.input.Mouse=tm.createClass({element:null,init:function(t){this.element=t||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0),this._x=0,this._y=0,this.touches=[];var e=this;this.element.addEventListener("mousedown",function(t){e._mousemove(t),e.prevPosition.set(e._x,e._y),e.button|=1<<t.button}),this.element.addEventListener("mouseup",function(t){e.button&=~(1<<t.button)}),this.element.addEventListener("mousemove",function(t){e._mousemove(t)})},run:function(t){var e=this;return t=t||30,tm.setLoop(function(){e.update()},1e3/t),this},update:function(){this.last=this.press,this.press=this.button,this.down=(this.press^this.last)&this.press,this.up=(this.press^this.last)&this.last,this.deltaPosition.x=this._x-this.position.x,this.deltaPosition.y=this._y-this.position.y,this.prevPosition.setObject(this.position),this.position.set(this._x,this._y)},getButton:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.press&e)},getButtonDown:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.down&e)},getButtonUp:function(e){return"string"==typeof e&&(e=t[e]),0!=(this.up&e)},_mousemove:function(t){var e=t.target.getBoundingClientRect();this._x=t.clientX-e.left,this._y=t.clientY-e.top},_mousemoveNormal:function(t){var e=t.target.getBoundingClientRect();this._x=t.clientX-e.left,this._y=t.clientY-e.top},_mousemoveScale:function(t){var e=t.target.getBoundingClientRect();this._x=t.clientX-e.left,this._y=t.clientY-e.top,t.target.style.width&&(this._x*=t.target.width/parseInt(t.target.style.width)),t.target.style.height&&(this._y*=t.target.height/parseInt(t.target.style.height))}}),tm.input.Mouse.BUTTON_LEFT=1,tm.input.Mouse.BUTTON_MIDDLE=2,tm.input.Mouse.BUTTON_RIGHT=4;var t={left:tm.input.Mouse.BUTTON_LEFT,middle:tm.input.Mouse.BUTTON_MIDDLE,right:tm.input.Mouse.BUTTON_RIGHT};tm.input.Mouse.prototype.accessor("x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),tm.input.Mouse.prototype.accessor("y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),tm.input.Mouse.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}}),tm.input.Mouse.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}}),tm.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},tm.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},tm.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),tm.input=tm.input||{},function(){tm.input.Touch=tm.createClass({element:null,touched:!1,init:function(t){this.element=t||window.document,this.position=tm.geom.Vector2(0,0),this.deltaPosition=tm.geom.Vector2(0,0),this.prevPosition=tm.geom.Vector2(0,0),this._x=0,this._y=0,this.touches=[];var e=this;this.element.addEventListener("touchstart",function(t){e.touched=!0,e._touchmove(t),e.position.set(e._x,e._y),e.prevPosition.set(e._x,e._y),e._setTouches(t)}),this.element.addEventListener("touchend",function(t){e.touched=!1,e._setTouches(t)}),this.element.addEventListener("touchmove",function(t){e._touchmove(t),t.stop(),e._setTouches(t)})},run:function(t){var e=this;return t=t||30,tm.setLoop(function(){e.update()},1e3/t),this},update:function(){this.last=this.now,this.now=Number(this.touched),this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._x-this.position.x,this.deltaPosition.y=this._y-this.position.y,this.prevPosition.setObject(this.position),this.position.set(this._x,this._y)},getTouch:function(){return 0!=this.touched},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end},_touchmove:function(t){var e=t.touches[0],i=t.target.getBoundingClientRect();this._x=e.clientX-i.left,this._y=e.clientY-i.top},_touchmoveScale:function(t){var e=t.touches[0],i=t.target.getBoundingClientRect();this._x=e.clientX-i.left,this._y=e.clientY-i.top,t.target.style.width&&(this._x*=t.target.width/parseInt(t.target.style.width)),t.target.style.height&&(this._y*=t.target.height/parseInt(t.target.style.height))},_getAdjustPoint:function(t){var e=this.element,i=e.style,n=e.getBoundingClientRect(),t={x:t.clientX-n.left,y:t.clientY-n.top};return i.width&&(t.x*=e.width/parseInt(i.width)),i.height&&(t.y*=e.height/parseInt(i.height)),t},_setTouches:function(t){var e=t.touches;this.touches.clear();for(var i=0,n=e.length;n>i;++i){var s=this._getAdjustPoint(e[i]);this.touches.push(s)}return this}}),tm.input.Touch.prototype.accessor("x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),tm.input.Touch.prototype.accessor("y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),tm.input.Touch.prototype.accessor("dx",{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}}),tm.input.Touch.prototype.accessor("dy",{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}}),tm.input.Touch.prototype.getPointing=tm.input.Touch.prototype.getTouch,tm.input.Touch.prototype.getPointingStart=tm.input.Touch.prototype.getTouchStart,tm.input.Touch.prototype.getPointingEnd=tm.input.Touch.prototype.getTouchEnd}(),tm.input=tm.input||{},function(){tm.input.Accelerometer=tm.createClass({init:function(t){this.gravity=tm.geom.Vector3(0,0,0),this.acceleration=tm.geom.Vector3(0,0,0),this.rotation=tm.geom.Vector3(0,0,0),this.orientation=tm.geom.Vector3(0,0,0);var e=this;window.addEventListener("devicemotion",function(t){var i=e.acceleration,n=e.gravity,s=e.rotation;t.acceleration&&(i.x=t.acceleration.x,i.y=t.acceleration.y,i.z=t.acceleration.z),t.accelerationIncludingGravity&&(n.x=t.accelerationIncludingGravity.x,n.y=t.accelerationIncludingGravity.y,n.z=t.accelerationIncludingGravity.z),t.rotationRate&&(s.x=s.beta=t.rotationRate.beta,s.y=s.gamma=t.rotationRate.gamma,s.z=s.alpha=t.rotationRate.alpha)}),window.addEventListener("deviceorientation",function(t){var i=e.orientation;i.alpha=t.alpha,i.beta=t.beta,i.gamma=t.gamma})}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Color=tm.createClass({r:255,g:255,b:255,a:1,init:function(t,e,i,n){this.set.apply(this,arguments)},set:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},setFromNumber:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},setFromArray:function(t){return this.set.apply(this,t)},setFromObject:function(t){return this.set(t.r,t.g,t.b,t.a)},setFromString:function(t){var e=tm.graphics.Color.stringToNumber(t);return this.set(e[0],e[1],e[2],e[3])},setSmart:function(){var t=arguments[0];return arguments.length>=3?this.set(arguments.r,arguments.g,arguments.b,arguments.a):t instanceof Array?this.setFromArray(t):t instanceof Object?this.setFromObject(t):"string"==typeof t&&this.setFromString(t),this},toStyleAsHex:function(){return"#{0}{1}{2}".format(this.r.toString(16).padding(2,"0"),this.g.toString(16).padding(2,"0"),this.b.toString(16).padding(2,"0"))},toStyleAsRGB:function(){return"rgb({r},{g},{b})".format({r:~~this.r,g:~~this.g,b:~~this.b})},toStyleAsRGBA:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})},toStyle:function(){return"rgba({r},{g},{b},{a})".format({r:~~this.r,g:~~this.g,b:~~this.b,a:this.a})}});var t={hex111:{reg:/^#(\w{1})(\w{1})(\w{1})$/,exec:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},hex222:{reg:/^#(\w{2})(\w{2})(\w{2})$/,exec:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},rgb:{reg:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3])]}},rgba:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseFloat(t[4])]}},hsl:{reg:/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,exec:function(t){return tm.graphics.Color.HSLtoRGB(t[1],t[2],t[3])}},hsla:{reg:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,exec:function(t){return Color.HSLAtoRGBA(t[1],t[2],t[3],t[4])}}};tm.graphics.Color.COLOR_LIST={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]},tm.graphics.Color.strToNum=tm.graphics.Color.stringToNumber=function(e){var i=null;if("#"===e[0]?i=4==e.length?"hex111":"hex222":"r"===e[0]&&"g"===e[1]&&"b"===e[2]?i="a"==e[3]?"rgba":"rgb":"h"===e[0]&&"s"===e[1]&&"l"===e[2]&&(i="a"==e[3]?"hsla":"hsl"),i){var n=t[i],s=e.match(n.reg);value=n.exec(s)}else Color.COLOR_LIST[e]&&(value=Color.COLOR_LIST[e]);return value},tm.graphics.Color.HSLtoRGB=function(t,e,i){var n,s,r;if(t%=360,t+=360,t%=360,e*=.01,i*=.01,0==e){var i=Math.round(255*i);return[i,i,i]}var a=.5>i?i*(1+e):i+e-i*e,o=2*i-a,h=(t+120)%360;return n=60>h?o+(a-o)*h/60:180>h?a:o,h=t,s=60>h?o+(a-o)*h/60:180>h?a:240>h?o+(a-o)*(240-h)/60:o,h=(t-120+360)%360,r=60>h?o+(a-o)*h/60:180>h?a:240>h?o+(a-o)*(240-h)/60:o,[parseInt(255*n),parseInt(255*s),parseInt(255*r)]},tm.graphics.Color.HSLAtoRGBA=function(t,e,i,n){var s=Color.HSLtoRGB(t,e,i);return s[3]=n,rgb},tm.graphics.Color.createStyleRGB=function(t,e,i){return"rgba("+t+","+e+","+i+")"},tm.graphics.Color.createStyleRGBA=function(t,e,i,n){return"rgba("+t+","+e+","+i+","+n+")"},tm.graphics.Color.createStyleHSL=function(t,e,i){return"hsl("+t+","+e+"%,"+i+"%)"},tm.graphics.Color.createStyleHSLA=function(t,e,i,n){return"hsla("+t+","+e+"%,"+i+"%,"+n+")"}}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas=tm.createClass({element:null,canvas:null,context:null,init:function(t){this.canvas=null,"string"==typeof t?this.canvas=document.querySelector(t):this.canvas=t||document.createElement("canvas"),this.element=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},resize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this},resizeWindow:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},resizeToFitScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.resize(window.innerWidth,window.innerHeight)},fitWindow:function(t){var e=function(){t=void 0===t?!0:t;var e=this.element,i=e.style;i.position="absolute",i.margin="auto",i.left="0px",i.top="0px",i.bottom="0px",i.right="0px";var n=e.width/window.innerWidth,s=e.height/window.innerHeight,r=e.height/e.width;n>s?(i.width=innerWidth.floor()+"px",i.height=(innerWidth*r).floor()+"px"):(i.width=(innerHeight/r).floor()+"px",i.height=innerHeight.floor()+"px")}.bind(this);e(),t&&window.addEventListener("resize",e,!1)},clear:function(t,e,i,n){return t=t||0,e=e||0,i=i||this.width,n=n||this.height,this.context.clearRect(t,e,i,n),this},clearColor:function(t,e,i,n,s){return e=e||0,i=i||0,n=n||this.width,s=s||this.height,this.save(),this.resetTransform(),this.fillStyle=t,this.context.fillRect(e,i,n,s),this.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(t,e){return this.context.moveTo(t,e),this},lineTo:function(t,e){return this.context.lineTo(t,e),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(t,e){return this.strokeRect(t,e,1,1)},line:function(t,e,i,n){return this.moveTo(t,e).lineTo(i,n)},drawLine:function(t,e,i,n){return this.beginPath().line(t,e,i,n).stroke()},drawDashLine:function(t,e,i,n,s){var r=null;"string"==typeof s?r=s:(s=s||61680,r=s.toString(2)),r=r.padding(16,"1");var a=i-t,o=n-e,h=Math.sqrt(a*a+o*o);a/=h,o/=h;for(var l=t,u=e,c=0;h>c;++c)"1"==r[c%16]&&this.drawPoint(l,u),l+=a,u+=o;return this},drawArrow:function(t,e,i,n,s){var r=i-t,a=n-e,o=180*Math.atan2(a,r)/Math.PI;return this.drawLine(t,e,i,n),this.fillPolygon(i,n,s||5,3,o),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var t=1,e=arguments.length/2;e>t;++t)this.lineTo(arguments[2*t],arguments[2*t+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(t,e,i,n){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(t,e,i,n,s){var r=t+s,a=t+i-s,o=e+s,h=e+n-s;return this.context.arc(r,o,s,-Math.PI,.5*-Math.PI,!1),this.context.arc(a,o,s,.5*-Math.PI,0,!1),this.context.arc(a,h,s,0,.5*Math.PI,!1),this.context.arc(r,h,s,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).fill()},strokeRoundRect:function(t,e,i,n,s){return this.beginPath().roundRect(t,e,i,n,s).stroke()},polygon:function(t,e,i,n,s){var r=2*Math.PI/n,a=void 0!=s?s*Math.PI/180:-Math.PI/2;this.moveTo(t+Math.cos(a)*i,e+Math.sin(a)*i);for(var o=1;n>o;++o){var h=r*o+a;this.lineTo(t+Math.cos(h)*i,e+Math.sin(h)*i)}return this.closePath(),this},fillPolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).fill()},strokePolygon:function(t,e,i,n,s){return this.beginPath().polygon(t,e,i,n,s).stroke()},star:function(t,e,i,n,s,r){var a=i*(s||.38),o=r?r*Math.PI/180:-Math.PI/2,h=2*Math.PI/n/2;this.moveTo(t+Math.cos(o)*i,e+Math.sin(o)*i);for(var l=1;2*n>l;++l){var u=h*l+o,c=l%2?a:i;this.lineTo(t+Math.cos(u)*c,e+Math.sin(u)*c)}return this.closePath(),this},fillStar:function(t,e,i,n,s,r){return this.beginPath().star(t,e,i,n,s,r).fill()},strokeStar:function(t,e,i,n,s,r){return this.beginPath().star(t,e,i,n,s,r).stroke()},heart:function(t,e,i,n){var s=.5*i,r=void 0===n?Math.PI/4:Math.degToRad(n),a=Math.cos(r)*s,o=Math.sin(r)*s,h=-s,l=(s*s-a*h)/o,u=l+s,c=s-u/2;return this.moveTo(0+t,l+e+c),this.arc(-s+t,0+e+c,s,Math.PI-r,2*Math.PI),this.arc(s+t,0+e+c,s,Math.PI,r),this.closePath(),this},fillHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).fill()},strokeHeart:function(t,e,i,n){return this.beginPath().heart(t,e,i,n).stroke()},circle:function(t,e,i){return this.context.arc(t,e,i,0,2*Math.PI,!1),this},fillCircle:function(t,e,i){var n=this.context;return n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.fill(),this},strokeCircle:function(t,e,i){return this.beginPath().circle(t,e,i).stroke()},arc:function(t,e,i,n,s,r){return this.context.arc(t,e,i,n,s,r),this},fillArc:function(t,e,i,n,s,r){return this.beginPath().arc(t,e,i,n,s,r).fill()},strokeArc:function(t,e,i,n,s,r){return this.beginPath().arc(t,e,i,n,s,r).stroke()},triangle:function(t,e,i,n,s,r){return this.moveTo(t,e).lineTo(i,n).lineTo(s,r),this.closePath(),this},fillTriangle:function(t,e,i,n,s,r){return this.beginPath().triangle(t,e,i,n,s,r).fill()},strokeTriangle:function(t,e,i,n,s,r){return this.beginPath().triangle(t,e,i,n,s,r).stroke()},fillText:function(t,e,i){return this.context.fillText.apply(this.context,arguments)},strokeText:function(t,e,i){return this.context.strokeText.apply(this.context,arguments)},fillVerticalText:function(t,e,i){this._drawVerticalText("fillText",t,e,i)},strokeVerticalText:function(t,e,i){this._drawVerticalText("strokeText",t,e,i)},_drawVerticalText:function(t,e,i,n){var s=this.context,r=(e.split("\n"),this.context.measureText("あ").width);s.save(),s.textAlign="right",s.textBaseline="top",Array.prototype.forEach.call(e,function(e,a){s[t](e,i,n+r*a)}),s.restore()},_drawLabelArea:function(t,e){var i=this.context,n=e.text,s=this.context.measureText("あ").width,r=n.split("\n"),a=(e.lineSpace||1)*s;if(i.save(),e.mode&&"horizon"!=e.mode){var o=Math.max(e.height/s|0,1),h=e.x+e.width,l=[];r.each(function(t){for(var e=0,i=t.length;i>e;e+=o){var n=t.substr(e,o);l.push(n)}});var u=t+"VerticalText";l.each(function(t,i){this[u](t,h-i*a,e.y+15)}.bind(this))}else{var o=Math.max(e.width/s|0,1),l=[];i.textAlign="left",i.textBaseline="top",r.each(function(t){for(var e=0,i=t.length;i>e;e+=o){var n=t.substr(e,o);l.push(n)}});var u=t+"Text";l.each(function(t,n){i[u](t,e.x,e.y+n*a+4)})}i.restore()},fillLabelArea:function(t){this._drawLabelArea("fill",t)},strokeLabelArea:function(t){this._drawLabelArea("stroke",t)},drawImage:function(t,e,i){this.context.drawImage.apply(this.context,arguments)},drawTexture:function(t,e,i){return arguments[0]=t.element,this.context.drawImage.apply(this.context,arguments),this},drawBitmap:function(t,e,i){return arguments[0]=t.imageData,this.context.putImageData.apply(this.context,arguments),this},drawScale9Image:function(t,e,i){var n=i.x,s=i.width,r=t.width-(n+s),a=e.width-(n+r),o=i.y;return this.drawImage(t,0,0,n,o,e.x,e.y,n,o),this.drawImage(t,n,0,s,o,e.x+n,e.y,a,o),this.drawImage(t,n+s,0,r,o,e.x+n+a,e.y,r,o),this},setTransform:function(t,e,i,n,s,r){return this.context.setTransform(t,e,i,n,s,r),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},setTransformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},transform:function(t,e,i,n,s,r){return this.context.transform(t,e,i,n,s,r),this},save:function(){return this.context.save(),this},restore:function(){return this.context.restore(),this},translate:function(t,e){return this.context.translate(t,e),this},rotate:function(t){return this.context.rotate(t),this},scale:function(t,e){return this.context.scale(t,e),this},saveAsImage:function(t){t=t||tm.graphics.Canvas.MIME_TYPE_PNG;var e=this.canvas.toDataURL(t);window.open(e,"save")},setCompositing:function(t,e){},setFillStyle:function(t){return this.context.fillStyle=t,this},setStrokeStyle:function(t){return this.context.strokeStyle=t,this},setColorStyle:function(t,e){return e=e||t,this.context.strokeStyle=t,this.context.fillStyle=e,this},setText:function(t,e,i){var n=this.context;n.font=t,n.textAlign=e,n.textBaseline=i},setLineStyle:function(width,cap,join,miter){with(this.context)lineWidth=width||1,lineCap=cap||"round",lineJoin=join||"round",miterLimit=miter||10;return this},setShadow:function(t,e,i,n){var s=this.context;return s.shadowColor=t||"black",s.shadowOffsetX=e||0,s.shadowOffsetY=i||0,s.shadowBlur=n||0,this},getElement:function(){return this.element}}),tm.graphics.Canvas.MIME_TYPE_PNG="image/png",tm.graphics.Canvas.MIME_TYPE_JPG="image/jpeg",tm.graphics.Canvas.MIME_TYPE_SVG="image/svg+xml",tm.graphics.Canvas.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}}),tm.graphics.Canvas.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}),tm.graphics.Canvas.prototype.accessor("fillStyle",{get:function(){return this.context.fillStyle},set:function(t){this.context.fillStyle=t}}),tm.graphics.Canvas.prototype.accessor("strokeStyle",{get:function(){return this.context.strokeStyle},set:function(t){this.context.strokeStyle=t}}),tm.graphics.Canvas.prototype.accessor("globalAlpha",{get:function(){return this.context.globalAlpha},set:function(t){this.context.globalAlpha=t}}),tm.graphics.Canvas.prototype.accessor("globalCompositeOperation",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}}),tm.graphics.Canvas.prototype.accessor("shadowBlur",{get:function(){return this.context.shadowBlur},set:function(t){this.context.shadowBlur=t}}),tm.graphics.Canvas.prototype.accessor("shadowColor",{get:function(){return this.context.shadowColor},set:function(t){this.context.shadowColor=t}}),tm.graphics.Canvas.prototype.accessor("shadowOffsetX",{get:function(){return this.context.shadowOffsetX},set:function(t){this.context.shadowOffsetX=t}}),tm.graphics.Canvas.prototype.accessor("shadowOffsetY",{get:function(){return this.context.shadowOffsetY},set:function(t){this.context.shadowOffsetY=t}}),tm.graphics.Canvas.prototype.accessor("lineCap",{get:function(){return this.context.lineCap},set:function(t){this.context.lineCap=t}}),tm.graphics.Canvas.prototype.accessor("lineJoin",{get:function(){return this.context.lineJoin},set:function(t){this.context.lineJoin=t}}),tm.graphics.Canvas.prototype.accessor("miterLimit",{get:function(){return this.context.miterLimit},set:function(t){this.context.miterLimit=t}}),tm.graphics.Canvas.prototype.accessor("lineWidth",{get:function(){return this.context.lineWidth},set:function(t){this.context.lineWidth=t}}),tm.graphics.Canvas.prototype.accessor("font",{get:function(){return this.context.font},set:function(t){this.context.font=t}}),tm.graphics.Canvas.prototype.accessor("textAlign",{get:function(){return this.context.textAlign},set:function(t){this.context.textAlign=t}}),tm.graphics.Canvas.prototype.accessor("textBaseline",{get:function(){return this.context.textBaseline},set:function(t){this.context.textBaseline=t}}),tm.graphics.Canvas.prototype.getter("centerX",function(){return this.canvas.width/2}),tm.graphics.Canvas.prototype.getter("centerY",function(){return this.canvas.height/2}),tm.graphics.Canvas.prototype.accessor("imageSmoothingEnabled",{get:function(){return this.context.imageSmoothingEnabled},set:function(t){this.context.imageSmoothingEnabled=t,this.context.webkitImageSmoothingEnabled=t,this.context.mozImageSmoothingEnabled=t}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Bitmap=tm.createClass({imageData:null,init:function(i){t||(t=document.createElement("canvas"),e=t.getContext("2d")),this._init.apply(this,arguments),
this.init=this._init},_init:function(t){if(1==arguments.length)this.imageData=t,this.data=t.data;else if(2==arguments.length){var i=arguments[0],n=arguments[1];this.imageData=e.createImageData(i,n),this.data=this.imageData.data}},getPixelIndex:function(t){var e=4*t;return[this.data[e+0],this.data[e+1],this.data[e+2],this.data[e+3]]},getPixelXY:function(t,e){return this.getPixelIndex(this.posToIndex(t,e))},getPixel:function(t,e){return this.getPixelIndex(this.posToIndex(t,e))},getPixelAsNumber:function(t){var e=4*t;return this.data[e+3]<<24|this.data[e+0]<<16|this.data[e+1]<<8|this.data[e+2]},getPixelAsObject:function(t){var e=4*t;return{r:this.data[e+0],g:this.data[e+1],b:this.data[e+2],a:this.data[e+3]}},getPixelAsArray:function(t){var e=4*t;return[this.data[e+0],this.data[e+1],this.data[e+2],this.data[e+3]]},getPixelAverage:function(t,e,i,n){var s=[0,0,0,0],r=t,a=t+i,o=e,h=e+n;0>r&&(r=0),a>this.width&&(a=this.width),0>o&&(o=0),h>this.height&&(h=this.height);for(var l=[],u=this.width,c=o;h>c;++c)for(var m=r;a>m;++m){var p=u*c+m;l.push(this.getPixelIndex(p))}for(var d=d=l.length,c=0;d>c;++c)s[0]+=l[c][0],s[1]+=l[c][1],s[2]+=l[c][2],s[3]+=l[c][3];return s[0]/=d,s[1]/=d,s[2]/=d,s[3]/=d,s},setPixelIndex:function(t,e,i,n){var s=4*t;return this.data[s+0]=e,this.data[s+1]=i,this.data[s+2]=n,this},setPixelXY:function(t,e,i,n,s){return this.setPixelIndex(e*this.imageData.width+t,i,n,s)},setPixel:function(t,e,i,n){return this.setPixelIndex(y*this.imageData.width+x,e,i,n)},setPixel32Index:function(t,e,i,n,s){var r=4*t;return this.data[r+0]=e,this.data[r+1]=i,this.data[r+2]=n,this.data[r+3]=s,this},setPixel32:function(t,e,i,n,s,r){return this.setPixel32Index(e*this.width+t,i,n,s,r)},setPixel32XY:function(t,e,i,n,s,r){return this.setPixel32Index(e*this.width+t,i,n,s,r)},setPixelFromArray:function(t,e){return this.setPixel(t,e[0],e[1],e[2])},setPixel32FromArray:function(t,e){return this.setPixel32(t,e[0],e[1],e[2],e[3])},setPixelFromNumber:function(t,e){return this.setPixel(t,(16711680&e)>>>16,(65280&e)>>>8,(255&e)>>>0)},setPixel32FromNumber:function(t,e){return this.setPixel32(t,(16711680&e)>>>16,(65280&e)>>>8,(255&e)>>>0,(4278190080&e)>>>24)},setPixelFromObject:function(t,e){return this.setPixel(e.r,e.g,e.b)},setPixel32FromObject:function(t,e){return this.setPixel32(e.r,e.g,e.b,e.a)},setPixelFromString:function(t,e){},posToIndex:function(t,e){return e*this.imageData.width+t},filter:function(t){for(var e=0;e<this.height;++e)for(var i=0;i<this.width;++i){var n=this.posToIndex(i,e),s=this.getPixel(i,e);t.calc(s,n,i,e,this)}return this},noise:function(t,e){t=t||0,e=e||255,range=e-t;for(var i=0,n=this.length;n>i;++i){var s=this.getPixelIndex(i);s[0]=Math.random()*range+t,s[1]=Math.random()*range+t,s[2]=Math.random()*range+t,s[3]=255,this.setPixel32Index(i,s[0],s[1],s[2],s[3])}},applyFilter:function(t){}}),tm.graphics.Bitmap.prototype.accessor("width",{get:function(){return this.imageData.width},set:function(t){this.imageData.width=t}}),tm.graphics.Bitmap.prototype.accessor("height",{get:function(){return this.imageData.height},set:function(t){this.imageData.height=t}}),tm.graphics.Bitmap.prototype.getter("length",function(){return this.imageData.width*this.imageData.height}),tm.graphics.Canvas.prototype.getBitmap=function(t,e,i,n){return tm.graphics.Bitmap(this.context.getImageData(t||0,e||0,i||this.width,n||this.height))},tm.graphics.Canvas.prototype.createBitmap=function(t,e){return tm.graphics.Bitmap(this.context.createImageData(t||this.width,e||this.height))},tm.asset.Texture.prototype.getBitmap=function(t,e,i,n){var s=tm.graphics.Canvas();return s.resize(this.width,this.height),s.drawTexture(this,0,0,this.width,this.height),s.getBitmap(t,e,i,n)};var t=null,e=null}(),tm.graphics=tm.graphics||{},function(){tm.graphics.MonochromeFilter=tm.createClass({init:function(){},apply:function(t,e){for(var i=t.length,n=0;i>n;++n){var s=t.getPixelIndex(n),r=.3*s[0]+.59*s[1]+.11*s[2];e.setPixel32Index(n,r,r,r,s[3])}return e}})}(),function(){tm.graphics.ReverseFilter=tm.createClass({init:function(){},apply:function(t,e){for(var i=0,n=t.width*t.height;n>i;++i){var s=t.getPixelIndex(i);s[0]=255-s[0],s[1]=255-s[1],s[2]=255-s[2],e.setPixel32Index(i,s[0],s[1],s[2],255)}return e}})}(),function(){tm.graphics.BlurFilter=tm.createClass({init:function(t,e,i){this.blurX=t||4,this.blurY=e||4,this.quality=i||1},apply:function(t,e){for(var i=Math.floor(this.blurX/2),n=Math.floor(this.blurY/2),s=this.blurX,r=this.blurY,a=t.width,o=t.height,h=t.length,l=function(t,e){for(var o=0;h>o;++o){var l=o%a,u=Math.floor(o/a),c=t.getPixelAverage(l-i,u-n,s,r);e.setPixel32Index(o,c[0],c[1],c[2],255)}},u=t,c=0;c<this.quality;++c)t=u,u=tm.graphics.Bitmap(a,o),l(t,u);return e.imageData=u.imageData,e}})}(),function(){for(var t=[],e=0;255>e;++e){var i=0;i=100>e?60:150>e?150:180>e?180:220,t[e]=i}tm.graphics.ToonFilter=tm.createClass({toonTable:null,init:function(e){this.toonTable=e||t},apply:function(t,e){for(var i=0,n=t.width*t.height;n>i;++i){var s=t.getPixelIndex(i),r=this.toonTable[s[0]],a=this.toonTable[s[1]],o=this.toonTable[s[2]];e.setPixel32Index(i,r,a,o,255)}return e}})}(),function(){tm.graphics.ColorMatrixFilter=tm.createClass({init:function(t){this.colorMatrix=t},apply:function(t,e){for(var i=this.colorMatrix,n=0,s=t.length;s>n;++n){var r=t.getPixelIndex(n),a=r[0]*i[0]+r[1]*i[1]+r[2]*i[2]+r[3]*i[3]+i[4],o=r[0]*i[5]+r[1]*i[6]+r[2]*i[7]+r[3]*i[8]+i[9],h=r[0]*i[10]+r[1]*i[11]+r[2]*i[12]+r[3]*i[13]+i[14],l=r[0]*i[15]+r[1]*i[16]+r[2]*i[17]+r[3]*i[18]+i[19];e.setPixel32Index(n,a,o,h,l)}return e}})}(),tm.graphics=tm.graphics||{},function(){tm.graphics.Canvas.prototype.setGradient=function(t){this.context.fillStyle=t.gradient}}(),function(){tm.graphics.LinearGradient=tm.createClass({init:function(i,n,s,r){t||(t=document.createElement("canvas"),e=t.getContext("2d")),this._init(i,n,s,r),this.init=this._init},_init:function(t,i,n,s){this.gradient=e.createLinearGradient(t,i,n,s)},addColorStop:function(t,e){return this.gradient.addColorStop(t,e),this},addColorStopList:function(t){for(var e=0,i=t.length;i>e;++e){var n=t[e].offset,s=t[e].color;this.addColorStop(n,s)}return this},toStyle:function(){return this.gradient}}),tm.graphics.RadialGradient=tm.createClass({init:function(i,n,s,r,a,o){t||(t=document.createElement("canvas"),e=t.getContext("2d")),this._init(i,n,s,r,a,o),this.init=this._init},_init:function(t,i,n,s,r,a){this.gradient=e.createRadialGradient(t,i,n,s,r,a)},addColorStop:function(t,e){return this.gradient.addColorStop(t,e),this},addColorStopList:function(t){for(var e=0,i=t.length;i>e;++e){var n=t[e].offset,s=t[e].color;this.addColorStop(n,s)}return this},toStyle:function(){return this.gradient}});var t=null,e=null}(),tm.anim=tm.anim||{},function(){tm.anim.Tween=tm.createClass({superClass:tm.event.EventDispatcher,target:null,time:null,prop:null,nowProps:null,now:null,begin:null,finish:null,duration:null,isLooping:null,isPlaying:null,func:Math.linear,fps:30,init:function(t,e,i,n){this.superInit(),this.time=0,this.nowProps={},this.isPlaying=!1,arguments.length>0&&this.to.apply(this,arguments)},to:function(t,e,i,n){var s={};for(var r in e)s[r]=t[r];return this.fromTo(t,s,e,i,n),this},by:function(t,e,i,n){var s={},r={};for(var a in e)s[a]=t[a],r[a]=t[a]+e[a];return this.fromTo(t,s,r,i,n),this},fromTo:function(t,e,i,n,s){this.target=t,this.beginProps=e,this.finishProps=i,this.duration=n,this.changeProps={};for(var r in e)this.changeProps[r]=i[r]-e[r];return this.setTransition(s),this},from:function(t,e,i,n){var s={};for(var r in e)s[r]=t[r];return this.fromTo(t,e,s,i,n),this},setTransition:function(t){return"function"==typeof t?this.func=t:"string"==typeof t?this.func=tm.anim.easing[t]:this.func=tm.anim.easing["default"],this},resume:function(){this.isPlaying=!0,this._resumeTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("resume",this.time,this.nowProps))},start:function(){this.isPlaying=!0,this._startTime(),this._updateTime(),this.dispatchEvent(tm.event.TweenEvent("start",this.time,this.nowProps))},stop:function(){this.isPlaying=!1,this.dispatchEvent(tm.event.TweenEvent("stop",this.time,this.nowProps))},rewind:function(){this.time=0,this.update()},fforward:function(){this.time=this.duration,this.update()},yoyo:function(){var t=this.finishProps;this.finishProps=this.beginProps,this.beginProps=t;for(var e in this.beginProps)this.changeProps[e]=this.finishProps[e]-this.beginProps[e];this.start()},update:function(){for(var t in this.changeProps)this.nowProps[t]=this.func(this.time,this.beginProps[t],this.changeProps[t],this.duration),this.target[t]=this.nowProps[t];this.dispatchEvent(tm.event.TweenEvent("change",this.time,this.nowProps))},_resumeTime:function(){this.startTime=(new Date).getTime()-this.time},_startTime:function(){this.startTime=(new Date).getTime()},_updateTime:function(){this.isPlaying&&(this._setTime((new Date).getTime()-this.startTime),setTimeout(arguments.callee.bind(this),1e3/this.fps))},_setTime:function(t){var e=t;e>this.duration?this.isLooping?(this.rewind(),this.update(),this.dispatchEvent(tm.event.TweenEvent("loop",this.time,this.nowProps))):(this.time=this.duration,this.update(),this.stop(),this.dispatchEvent(tm.event.TweenEvent("finish",this.time,this.nowProps))):(this.time=e,this.update())}})}(),function(){tm.anim.easing={"default":function(t,e,i,n){return i*t/n+e},linear:function(t,e,i,n){return i*t/n+e},swing:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeOutInCubic:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutCubic(2*t,e,i/2,n):tm.anim.easing.easeInCubic(2*t-n,e+i/2,i/2,n)},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeOutInQuart:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutQuart(2*t,e,i/2,n):tm.anim.easing.easeInQuart(2*t-n,e+i/2,i/2,n)},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeOutInQuint:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutQuint(2*t,e,i/2,n):tm.anim.easing.easeInQuint(2*t-n,e+i/2,i/2,n)},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeOutInSine:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutSine(2*t,e,i/2,n):tm.anim.easing.easeInSine(2*t-n,e+i/2,i/2,n)},easeInExpo:function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},easeOutExpo:function(t,e,i,n){return t==n?e+i:1.001*i*(-Math.pow(2,-10*t/n)+1)+e},easeInOutExpo:function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e-5e-4*i:i/2*1.0005*(-Math.pow(2,-10*--t)+2)+e},easeOutInExpo:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutExpo(2*t,e,i/2,n):tm.anim.easing.easeInExpo(2*t-n,e+i/2,i/2,n)},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeOutInCirc:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutCirc(2*t,e,i/2,n):tm.anim.easing.easeInCirc(2*t-n,e+i/2,i/2,n)},easeInElastic:function(t,e,i,n,s,r){var a;return 0==t?e:1==(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),-(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r))+e)},easeOutElastic:function(t,e,i,n,s,r){var a;return 0==t?e:1==(t/=n)?e+i:(r||(r=.3*n),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-a)*(2*Math.PI)/r)+i+e)},easeInOutElastic:function(t,e,i,n,s,r){var a;return 0==t?e:2==(t/=n/2)?e+i:(r||(r=n*(.3*1.5)),!s||s<Math.abs(i)?(s=i,a=r/4):a=r/(2*Math.PI)*Math.asin(i/s),1>t?-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r))+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*(2*Math.PI)/r)*.5+i+e)},easeOutInElastic:function(t,e,i,n,s,r){return n/2>t?tm.anim.easing.easeOutElastic(2*t,e,i/2,n,s,r):tm.anim.easing.easeInElastic(2*t-n,e+i/2,i/2,n,s,r)},easeInBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),i*(t/=n)*t*((s+1)*t-s)+e},easeOutBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},easeInOutBack:function(t,e,i,n,s){return void 0==s&&(s=1.70158),(t/=n/2)<1?i/2*(t*t*(((s*=1.525)+1)*t-s))+e:i/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+e},easeOutInBack:function(t,e,i,n,s){return n/2>t?tm.anim.easing.easeOutBack(2*t,e,i/2,n,s):tm.anim.easing.easeInBack(2*t-n,e+i/2,i/2,n,s)},easeInBounce:function(t,e,i,n){return i-tm.anim.easing.easeOutBounce(n-t,0,i,n)+e},easeOutBounce:function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,i,n){return n/2>t?.5*tm.anim.easing.easeInBounce(2*t,0,i,n)+e:.5*tm.anim.easing.easeOutBounce(2*t-n,0,i,n)+.5*i+e},easeOutInBounce:function(t,e,i,n){return n/2>t?tm.anim.easing.easeOutBounce(2*t,e,i/2,n):tm.anim.easing.easeInBounce(2*t-n,e+i/2,i/2,n)}}}(),function(){tm.define("tm.app.Timer",{frame:0,fps:30,frameTime:1e3/30,init:function(){this.frame=0,this.fps=tm.app.Timer["default"].fps},reset:function(){return this.frame=0,this},update:function(){return this.frame=this.frame+1,this},getFrame:function(){return this.frame},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},checkIntervalEnd:function(t){var e=t/this.fps|0;return this.frame%e==0?!0:!1},checkBetween:function(t,e){1==arguments.length&&(e=Math.max(t,0),t=e-this.frameTime);var i=this.frame/this.fps*1e3;return e>(i>=t)},_update:function(){var t=this.frame/this.fps;this._seconds=0|t,this._milliseconds=1e3*t|0}}),tm.app.Timer.prototype.accessor("frame",{get:function(){return this._frame},set:function(t){this._frame=t,this._update()}}),tm.app.Timer.prototype.accessor("fps",{get:function(){return this._fps},set:function(t){t!==this._fps&&(this.frameTime=1e3/t),this._fps=t,this._update()}}),tm.app.Timer["default"]={fps:30}}(),function(){tm.define("tm.app.Updater",{app:null,init:function(t){this.app=t},update:function(t){this._updateElement(t)},_updateElement:function(t){var e=this.app;if(0!=t.awake){if(t.update&&t.update(e),t.hasEventListener("enterframe")){var i=tm.event.Event("enterframe");i.app=e,t.fire(i)}t.interactive&&t._checkPointing(e);var n=t.children.length;if(n>0)for(var s=t.children.slice(),r=0;n>r;++r)this._updateElement(s[r])}}})}(),tm.app=tm.app||{},function(){tm.app.BaseApp=tm.createClass({superClass:tm.event.EventDispatcher,element:null,mouse:null,touch:null,pointing:null,keyboard:null,accelerometer:null,updater:null,stats:null,timer:null,awake:null,_scenes:null,_sceneIndex:0,init:function(t){this.superInit(),this.element=t,this.timer=tm.app.Timer(),this.mouse=tm.input.Mouse(this.element),this.touch=tm.input.Touch(this.element,0),this.keyboard=tm.input.Keyboard(),this.pointing=tm.isMobile?this.touch:this.mouse,this.element.addEventListener("touchstart",function(){this.pointing=this.touch}.bind(this)),this.element.addEventListener("mousedown",function(){this.pointing=this.mouse}.bind(this)),this.accelerometer=tm.input.Accelerometer(),this.updater=tm.app.Updater(this),this.awake=!0,this._scenes=[tm.app.Scene()],this._sceneIndex=0,this.element.addEventListener("touchstart",function(t){t.stop()}),this.element.addEventListener("touchmove",function(t){t.stop()}),window.addEventListener("focus",function(){this.fire(tm.event.Event("focus")),this.currentScene.dispatchEvent(tm.event.Event("focus"))}.bind(this)),window.addEventListener("blur",function(){this.fire(tm.event.Event("blur")),this.currentScene.dispatchEvent(tm.event.Event("blur"))}.bind(this)),this.element.addEventListener(tm.isMobile?"touchend":"mouseup",this._onclick.bind(this))},run:function(){var t=this;this.startedTime=new Date,this.prevTime=new Date,this.deltaTime=0;var e=function(){var i=(new Date).getTime();t._loop();var n=(new Date).getTime()-i,s=t.timer.frameTime-n;setTimeout(e,s)};return e(),this},_loop:function(){this.update&&this.update(),this._update(),this.draw&&this.draw(),this._draw();var t=new Date;this.deltaTime=t-this.prevTime,this.prevTime=t,this.stats&&this.stats.update()},replaceScene:function(t){var e=null;return this.currentScene&&(e=tm.event.Event("exit"),e.app=this,this.currentScene.dispatchEvent(e),this.currentScene.app=null),e=tm.event.Event("enter"),e.app=this,this.currentScene=t,this.currentScene.app=this,this.currentScene.dispatchEvent(e),this},pushScene:function(t){this.fire(tm.event.Event("push"));var e=tm.event.Event("pause");e.app=this,this.currentScene.dispatchEvent(e),this._scenes.push(t),++this._sceneIndex,this.fire(tm.event.Event("pushed"));var e=tm.event.Event("enter");return e.app=this,t.app=this,t.dispatchEvent(e),this},popScene:function(){this.fire(tm.event.Event("pop"));var t=this._scenes.pop();--this._sceneIndex;var e=tm.event.Event("exit");e.app=this,t.dispatchEvent(e),t.app=null,this.fire(tm.event.Event("poped"));var e=tm.event.Event("resume");return e.app=this,e.prevScene=t,this.currentScene.dispatchEvent(e),t},enableStats:function(){return window.Stats?(this.stats=new Stats,this.stats.domElement.style.position="fixed",this.stats.domElement.style.left="5px",this.stats.domElement.style.top="20px",document.body.appendChild(this.stats.domElement)):console.warn("not defined stats."),this},enableDatGUI:function(){if(window.dat){var t=new dat.GUI;return t}},start:function(){return this.awake=!0,this},stop:function(){return this.awake=!1,this},_update:function(){this.mouse.update(),this.keyboard._update(),this.touch.update(),this.awake&&(this.updater.update(this.currentScene),this.timer.update())},_draw:function(){},getElement:function(){return this.element},_onclick:function(t){var e=function(t){t.children.length>0&&t.children.each(function(t){e(t)}),t._clickFlag&&t.hasEventListener("click")&&t.dispatchEvent(tm.event.Event("click")),t._clickFlag=!1};e(this.currentScene)}}),tm.app.BaseApp.prototype.accessor("currentScene",{get:function(){return this._scenes[this._sceneIndex]},set:function(t){this._scenes[this._sceneIndex]=t}}),tm.app.BaseApp.prototype.accessor("frame",{get:function(){return this.timer.frame},set:function(t){this.timer.frame=t}}),tm.app.BaseApp.prototype.accessor("fps",{get:function(){return this.timer.fps},set:function(t){this.timer.fps=t}})}(),tm.app=tm.app||{},function(){tm.app.Element=tm.createClass({superClass:tm.event.EventDispatcher,parent:null,children:null,init:function(){this.superInit(),this.children=[]},remove:function(){return console.assert(this.parent),this.parent.removeChild(this),this.parent=null,this},addChild:function(t){t.parent&&t.remove(),t.parent=this,this.children.push(t);var e=tm.event.Event("added");return t.dispatchEvent(e),t},addChildTo:function(t){return t.addChild(this),this},addChildren:function(t){for(var e=t.slice(),i=beginIndex,n=e.length;n>i;++i)this.addChild(e[i])},addChildAt:function(t,e){t.parent&&t.remove(),t.parent=this,this.children.splice(e,0,t);var i=tm.event.Event("added");return t.dispatchEvent(i),t},getChildAt:function(t){return this.children.at(t)},getChildIndex:function(t){return this.children.indexOf(t)},removeChild:function(t){var e=this.children.indexOf(t);if(-1!=e){this.children.splice(e,1);var i=tm.event.Event("removed");t.dispatchEvent(i)}},removeChildren:function(t){t=t||0;for(var e=this.children.slice(),i=t,n=e.length;n>i;++i)e[i].remove();this.children=[]},getChildByName:function(t){for(var e=0,i=this.children.length;i>e;++e)if(this.children[e].name==t)return this.children[e];return null},execChildren:function(t,e){e=e&&e.length?e:[e];for(var i=this.children.slice(),n=0,s=i.length;s>n;++n)t.apply(i[n],e)},getParent:function(){return this.parent},getRoot:function(){if(!this.parent)return null;var t=null;for(t=this.parent;null!=t.parent;t=t.parent);return t},fromJSON:function(e){var i=function(e,i){var n=i.init,s=n instanceof Array?n:[n],r=t[i.type]?t[i.type]:i.type,a=tm.using(r);console.assert(0!==Object.keys(a).length,a+" is not defined.");var o=a.apply(null,s);o.fromJSON(i),this[e]=o,o.addChildTo(this)}.bind(this);for(var n in e){var s=e[n];if("children"==n)if(s instanceof Array)for(var r=0,a=s.length;a>r;++r){var o=s[r];i(o.name,o)}else for(var n in s){var o=s[n];i(n,o)}else"type"==n&&(n="__key"),this[n]=s}return this},toJSON:function(){}});var t={Sprite:"tm.display.Sprite",Label:"tm.display.Label",Shape:"tm.display.Shape",CircleShape:"tm.display.CircleShape",TriangleShape:"tm.display.TriangleShape",RectangleShape:"tm.display.RectangleShape",RoundRectangleShape:"tm.display.RoundRectangleShape",TextShape:"tm.display.TextShape",StarShape:"tm.display.StarShape",PolygonShape:"tm.display.PolygonShape",HeartShape:"tm.display.HeartShape",AnimationSprite:"tm.display.AnimationSprite",LabelButton:"tm.ui.LabelButton",IconButton:"tm.ui.IconButton",GlossyButton:"tm.ui.GlossyButton",FlatButton:"tm.ui.FlatButton"}}(),function(){tm.define("tm.app.Object2D",{superClass:"tm.app.Element",position:null,scale:null,rotation:0,awake:!0,_width:64,_height:64,init:function(){this.superInit(),this.position=tm.geom.Vector2(0,0),this.scale=tm.geom.Vector2(1,1),this.pointing=tm.geom.Vector2(0,0),this.origin=tm.geom.Vector2(.5,.5),this._matrix=tm.geom.Matrix33(),this._matrix.identity(),this.boundingType="circle",this.checkHierarchy=!0,this.interactive=!1,this.hitFlags=[],this.downFlags=[],this._clickFlag=!1,this._worldMatrix=tm.geom.Matrix33().identity(),this._worldAlpha=1},getFinalMatrix:function(){var t=tm.geom.Matrix33();return this.parent&&t.multiply(this.parent.getFinalMatrix()),t.translate(this.x,this.y),t.rotateZ(this.rotation*Math.DEG_TO_RAD),t.scale(this.scaleX,this.scaleY),t},isHitPoint:function(t,e){var i=this.globalToLocal(tm.geom.Vector2(t,e));return this.pointing.x=i.x,this.pointing.y=i.y,i.x*i.x+i.y*i.y<this.radius*this.radius?!0:!1},isHitPointCircle:function(t,e){var i=this.x-t,n=this.y-e;return i*i+n*n<this.radius*this.radius?!0:!1},isHitPointRect:function(t,e){var i=this.x-this.width*this.originX,n=this.x+this.width*(1-this.originX),s=this.y-this.height*this.originY,r=this.y+this.height*(1-this.originY);return t>i&&n>t&&e>s&&r>e?!0:!1},isHitPointCircleHierarchy:function(t,e){var i=this.globalToLocal(tm.geom.Vector2(t,e));return this.pointing.x=i.x,this.pointing.y=i.y,i.x*i.x+i.y*i.y<this.radius*this.radius?!0:!1},isHitPointRectHierarchy:function(t,e){var i=this.globalToLocal(tm.geom.Vector2(t,e));this.pointing.x=i.x,this.pointing.y=i.y;var n=-this.width*this.originX,s=+this.width*(1-this.originX),r=-this.height*this.originY,a=+this.height*(1-this.originY);return n<i.x&&i.x<s&&r<i.y&&i.y<a?!0:!1},isHitElement:function(t){this.parent.localToGlobal(this);return(this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)<(this.radius+t.radius)*(this.radius+t.radius)?!0:!1},isHitElementCircle:function(t){return tm.collision.testCircleCircle(this.getBoundingCircle(),t.getBoundingCircle())},isHitElementRect:function(t){return tm.collision.testRectRect(this.getBoundingRect(),t.getBoundingRect())},getBoundingCircle:function(){return tm.geom.Circle(this.centerX,this.centerY,this.radius)},getBoundingRect:function(){return tm.geom.Rect(this.left,this.top,this.width,this.height)},localToGlobal:function(t){return this.getFinalMatrix().multiplyVector2(t)},globalToLocal:function(t){var e=this._worldMatrix.clone();return e.invert(),e.transpose(),e.multiplyVector2(t)},setX:function(t){return this.position.x=t,this},setY:function(t){return this.position.y=t,this},setPosition:function(t,e){return this.position.x=t,this.position.y=e,this},setRotation:function(t){return this.rotation=t,this},setScale:function(t,e){return this.scale.x=t,arguments.length<=1?this.scale.y=t:this.scale.y=e,this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.height=t,this},setSize:function(t,e){return this.width=t,this.height=e,this},wakeUp:function(){return this.awake=!0,this},sleep:function(){return this.awake=!1,this},setInteractive:function(t,e){return this.interactive=t,e&&(this.boundingType=e),this},setBoundingType:function(t){return this.boundingType=t,this},_checkPointing:function(t){console.assert(!1)},_checkMouse:function(t){this.__checkPointing(t,t.pointing,0)},_checkTouch:function(t){this.__checkPointing(t,t.pointing,0)},__checkPointing:function(t,e,i){var n=(this.element,this.hitFlags[i]);this.hitFlags[i]=this.isHitPoint(e.x,e.y),!n&&this.hitFlags[i]&&this._dispatchPointingEvent("mouseover","touchover","pointingover",t,e),n&&!this.hitFlags[i]&&this._dispatchPointingEvent("mouseout","touchout","pointingout",t,e),this.hitFlags[i]&&e.getPointingStart()&&(this._dispatchPointingEvent("mousedown","touchstart","pointingstart",t,e),this.downFlags[i]=!0,this._clickFlag=!0),this.downFlags[i]&&this._dispatchPointingEvent("mousemove","touchmove","pointingmove",t,e),1==this.downFlags[i]&&e.getPointingEnd()&&(this._dispatchPointingEvent("mouseup","touchend","pointingend",t,e),this.downFlags[i]=!1)},_dispatchPointingEvent:function(t,e,i,n,s){this.dispatchEvent(tm.event.MouseEvent(t,n,s)),this.dispatchEvent(tm.event.TouchEvent(e,n,s)),this.dispatchEvent(tm.event.PointingEvent(i,n,s))},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this.rotationCache){this.rotationCache=this.rotation;var t=this.rotation*Math.DEG_TO_RAD;this._sr=Math.sin(t),this._cr=Math.cos(t)}var e=this._matrix.m,i=this.parent._worldMatrix.m,n=this._worldMatrix.m;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y,e[2]=this.position.x,e[5]=this.position.y;var s=e[0],r=e[1],a=e[2],o=e[3],h=e[4],l=e[5],u=i[0],c=i[1],m=i[2],p=i[3],d=i[4],f=i[5];n[0]=u*s+c*o,n[1]=u*r+c*h,n[2]=u*a+c*l+m,n[3]=p*s+d*o,n[4]=p*r+d*h,n[5]=p*a+d*l+f}},_dirtyCalc:function(){this._calcWorldMatrix()}}),tm.app.Object2D.prototype.accessor("x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),tm.app.Object2D.prototype.accessor("y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),tm.app.Object2D.prototype.accessor("originX",{get:function(){return this.origin.x},set:function(t){this.origin.x=t}}),tm.app.Object2D.prototype.accessor("originY",{get:function(){return this.origin.y},set:function(t){this.origin.y=t}}),tm.app.Object2D.prototype.accessor("scaleX",{get:function(){return this.scale.x},set:function(t){this.scale.x=t}}),tm.app.Object2D.prototype.accessor("scaleY",{get:function(){return this.scale.y},set:function(t){this.scale.y=t}}),tm.app.Object2D.prototype.accessor("width",{get:function(){return this._width},set:function(t){this._width=t}}),tm.app.Object2D.prototype.accessor("height",{get:function(){return this._height},set:function(t){this._height=t}}),tm.app.Object2D.prototype.accessor("radius",{get:function(){return void 0!==this._radius?this._radius:(this.width+this.height)/4},set:function(t){this._radius=t}}),tm.app.Object2D.prototype.accessor("top",{get:function(){return this.y-this.height*this.originY},set:function(t){this.y=t+this.height*this.originY}}),tm.app.Object2D.prototype.accessor("right",{get:function(){return this.x+this.width*(1-this.originX)},set:function(t){this.x=t-this.width*(1-this.originX)}}),tm.app.Object2D.prototype.accessor("bottom",{get:function(){return this.y+this.height*(1-this.originY)},set:function(t){this.y=t-this.height*(1-this.originY)}}),tm.app.Object2D.prototype.accessor("left",{get:function(){return this.x-this.width*this.originX},set:function(t){this.x=t+this.width*this.originX}}),tm.app.Object2D.prototype.accessor("centerX",{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(t){}}),tm.app.Object2D.prototype.accessor("centerY",{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(t){}}),tm.app.Object2D.prototype.accessor("boundingType",{get:function(){return this._boundingType},set:function(t){this._boundingType=t,this._setIsHitFunc()}}),tm.app.Object2D.prototype.accessor("checkHierarchy",{get:function(){return this._checkHierarchy},set:function(t){this._checkHierarchy=t,this._setIsHitFunc()}});var t={rect:tm.app.Object2D.prototype.isHitPointRect,circle:tm.app.Object2D.prototype.isHitPointCircle,"true":function(){return!0},"false":function(){return!1}},e={rect:tm.app.Object2D.prototype.isHitPointRectHierarchy,circle:tm.app.Object2D.prototype.isHitPointCircleHierarchy,"true":function(){return!0},"false":function(){return!1}},i={rect:tm.app.Object2D.prototype.isHitElementRect,circle:tm.app.Object2D.prototype.isHitElementCircle,"true":function(){return!0},"false":function(){return!1}};tm.app.Object2D.prototype._setIsHitFunc=function(){var n=this.checkHierarchy?e:t,s=this.boundingType;n[s]?n[s]:n["true"];this.isHitPoint=n[s]?n[s]:n["true"],this.isHitElement=i[s]?i[s]:i["true"]},tm.app.Object2D.prototype._checkPointing=tm.isMobile?tm.app.Object2D.prototype._checkTouch:tm.app.Object2D.prototype._checkMouse}(),function(){tm.define("tm.app.Grid",{superClass:"tm.app.Object2D",cellWidth:64,cellHeight:64,maxPerLine:8,arrangement:"horizontal",init:function(t){this.superInit()},reposition:function(){var t=this.children;"horizontal"==this.arrangement?t.each(function(t,e){var i=e%this.maxPerLine,n=e/this.maxPerLine|0,s=this.cellWidth*i,r=this.cellHeight*n;t.setPosition(s,r)},this):t.each(function(t,e){var i=e/this.maxPerLine|0,n=e%this.maxPerLine,s=this.cellWidth*i,r=this.cellHeight*n;t.setPosition(s,r)},this)}})}(),tm.app=tm.app||{},function(){tm.app.Scene=tm.createClass({superClass:tm.app.Object2D,app:null,nextLabel:"",nextArguments:null,init:function(){this.superInit(),this.boundingType="none",this.setInteractive(!0)},exit:function(t){if(this.app){if("object"!=typeof t){var e={};e.nextLabel=arguments[0],e.nextArguments=arguments[1],t=e}return t.nextLabel&&(this.nextLabel=t.nextLabel),t.nextArguments&&(this.nextArguments=t.nextArguments),this.app.popScene(),this}}})}(),tm.app=tm.app||{},function(){tm.app.Collision=tm.createClass({element:null,collideList:null,init:function(t){this.element=t,this.collideList=[]},update:function(t){for(var e=this.collideList.clone(),i=this.element,n=0,s=e.length;s>n;++n){var r=e[n];if(i.isHitElement(r.element)){if(r.collide===!1){var a=tm.event.Event("collisionenter");a.other=r.element,i.dispatchEvent(a)}var a=tm.event.Event("collisionstay");a.other=r.element,i.dispatchEvent(a),r.collide=!0}else{if(1==r.collide){var a=tm.event.Event("collisionexit");a.other=r.element,i.dispatchEvent(a)}r.collide=!1}}},add:function(t){this.collideList.push({element:t,collide:!1})},remove:function(t){this.collideList.eraseIf(function(e){return e.element==t})}}),tm.app.Element.prototype.getter("collision",function(){return this._collision||(this._collision=tm.app.Collision(this),this.addEventListener("enterframe",function(t){this._collision.update(t.app)})),this._collision})}(),function(){tm.define("tm.app.Tweener",{superClass:"tm.app.Element",init:function(t){this.superInit(),this.setTarget(t||{}),this.loop=!1,this._init()},_init:function(){this._index=0,this._tasks=[],this._func=this._updateTask,this.isPlaying=!0},setTarget:function(t){return this.element=t,this},update:function(t){return void this._func(t)},_updateTask:function(t){if(this.isPlaying){var e=this._tasks[this._index];if(!e)return this.loop===!0?(this._index=0,this._updateTask(t)):void(this.isPlaying=!1);
if(this._index++,"tween"==e.type){var i=(e.data,e.data.type),n=e.data.args;this._tween=tm.anim.Tween(),this._tween[i].apply(this._tween,n),this._func=this._updateTween,this._func(t)}else"wait"==e.type?(this._wait=e.data,this._wait.time=0,this._func=this._updateWait,this._func(t)):"call"==e.type?(e.data.func.apply(e.data.self,e.data.args),this._updateTask(t)):"set"==e.type&&(this.element.$extend(e.data.values),this._updateTask(t))}},_updateTween:function(t){var e=this._tween,i=e.time+1e3/t.fps;e._setTime(i),e.time>=e.duration?(delete this._tween,this._tween=null,this._func=this._updateTask):e.update()},_updateWait:function(t){var e=this._wait;e.time+=1e3/t.fps,e.time>=e.limit&&(delete this._wait,this._wait=null,this._func=this._updateTask)},add:function(t){if(t.target||(t.target=this.element),this._tasks.push({type:"tween",data:t}),0==this.isAnimation){this.isAnimation=!0;var e=tm.event.Event("animationstart");this.element.dispatchEvent(e)}return this},by:function(t,e,i){return this._addTweenTask({props:t,duration:e,fn:i,type:"by"}),this},to:function(t,e,i){return this._addTweenTask({props:t,duration:e,fn:i,type:"to"}),this},from:function(t,e,i){return this._addTweenTask({props:t,duration:e,fn:i,type:"from"}),this},move:function(t,e,i,n){return this.to({x:t,y:e},i,n)},moveBy:function(t,e,i,n){return this.by({x:t,y:e},i,n)},rotate:function(t,e,i){return this.to({rotation:t},e,i)},scale:function(t,e,i){return this.to({scaleX:t,scaleY:t},e,i)},fade:function(t,e){return this.to({alpha:t},e),this},fadeIn:function(t){return this.fade(1,t),this},fadeOut:function(t){return this.fade(0,t),this},_addTweenTask:function(t){if(t.target=void 0!==t.target?t.target:this.element,t.duration=void 0!==t.duration?t.duration:1e3,this._tasks.push({type:"tween",data:{args:[t.target,t.props,t.duration,t.fn],type:t.type}}),0==this.isAnimation){this.isAnimation=!0;var e=tm.event.Event("animationstart");this.element.dispatchEvent(e)}return this},wait:function(t){return this._tasks.push({type:"wait",data:{limit:t}}),this},call:function(t,e,i){return this._tasks.push({type:"call",data:{func:t,self:e||this,args:i}}),this},set:function(t,e){var i=null;return 2==arguments.length?(i={},i[t]=e):i=t,this._tasks.push({type:"set",data:{values:i}}),this},play:function(){return this.isPlaying=!0,this},pause:function(){return this.isPlaying=!1,this},rewind:function(){return this._func=this._updateTask,this._index=0,this.play(),this},setLoop:function(t){return this.loop=t,this},clear:function(){return this._init(),this}}),tm.app.Element.prototype.getter("tweener",function(){return this._tweener||(this._tweener=tm.app.Tweener(this),this.on("enterframe",function(t){this._tweener.update(t.app)})),this._tweener})}(),tm.namespace("tm.app",function(){tm.define("tm.app.Timeline",{superClass:"tm.app.Element",init:function(t){this.superInit(),this.setTarget(t||{}),this.currentFrame=0,this.currentTime=0,this.prevTime=0,this.duration=0,this.isPlay=!0,this._tweens=[],this._actions=[]},update:function(t){this.isPlay&&(this.prevTime<=this.duration&&(this._updateTween(),this._updateAction()),this.currentFrame++,this.prevTime=this.currentTime,this.currentTime=this.currentFrame/t.fps*1e3|0)},_updateTween:function(){for(var t=this._tweens,e=0,i=t.length;i>e;++e){var n=t[e];if(!(n.delay>this.currentTime)){var s=this.currentTime-n.delay;n._setTime(s),n.time>=n.duration||n.update()}}},_updateAction:function(){for(var t=this._actions,e=0,i=t.length;i>e;++e){var n=t[e];if(this.prevTime<=n.delay&&n.delay<this.currentTime)if("call"==n.type)n.func.call(n.self);else if("set"==n.type){var s=n.props;for(var r in s)this.element[r]=s[r]}}},to:function(t,e,i,n){return console.assert("number"==typeof t,"to の第一引数はdelayに変わりました"),this._addTween({props:e,duration:i,fn:n,delay:t}),this},by:function(t,e,i,n){console.assert("number"==typeof t,"by の第一引数はdelayに変わりました");for(var s in e)e[s]+=this.element[s]||0;return this._addTween({props:e,duration:i,fn:n,delay:t}),this},call:function(t,e,i){return console.assert("number"==typeof t,"call の第一引数はdelayに変わりました"),this._addAction({type:"call",func:e,self:i||this,delay:t}),this},set:function(t,e){return console.assert("number"==typeof t,"set の第一引数はdelayに変わりました"),this._addAction({type:"set",props:e,delay:t}),this},setTarget:function(t){return this.element=t,this},getTarget:function(){return this.element},gotoAndPlay:function(t){this.isPlay=!0,this.currentFrame=t,this._updateTween()},gotoAndStop:function(t){this.currentFrame=t,this.isPlay=!1,this._updateTween()},_addTween:function(t){t.duration=t.duration||1e3,t.duration=this._dirty(t.duration),t.delay=t.delay||0,t.delay=this._dirty(t.delay);var e=tm.anim.Tween();e.to(this.element,t.props,t.duration,t.fn),e.delay=t.delay,this._tweens.push(e),this._updateDuration(e)},_addAction:function(t){t.delay=t.delay||0,t.delay=this._dirty(t.delay),this._actions.push(t),this._updateDuration(t)},_updateDuration:function(t){var e=t.delay+(t.duration?t.duration:0);return this.duration<e&&(this.duration=e),this},_dirty:function(t){return t},load:function(t){for(var e in t.timeline)var i=t.timeline[e];return this},clear:function(){return this.currentFrame=0,this.prevTime=0,this.currentTime=0,this.duration=0,this.isPlay=!0,this._tweens=[],this._actions=[],this}}),tm.app.Element.prototype.getter("timeline",function(){return this._timeline||(this._timeline=tm.app.Timeline(this),this.on("enterframe",function(t){this._timeline.update(t.app)})),this._timeline})}),tm.display=tm.display||{},function(){tm.display.CanvasApp=tm.createClass({superClass:tm.app.BaseApp,init:function(t){t instanceof HTMLCanvasElement?this.element=t:"string"==typeof t?this.element=document.querySelector(t):this.element=document.createElement("canvas"),this.superInit(this.element),this.canvas=tm.graphics.Canvas(this.element),this.renderer=tm.display.CanvasRenderer(this.canvas),this.background="black",this._scenes=[tm.app.Scene()],this._canvasCache=[],this._canvasCacheCache=[],this.on("push",function(){this._draw();var t=this._canvasCacheCache.pop();if(!t){var e=this.canvas.element.cloneNode();t=tm.graphics.Canvas(e)}t.clear(),t.drawTexture(this.canvas,0,0),this._canvasCache.push(t)}),this.on("poped",function(){var t=this._canvasCache.pop();this._draw(),this._canvasCacheCache.push(t)})},resize:function(t,e){return this.width=t,this.height=e,this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this},fitWindow:function(t){return this.canvas.fitWindow(t),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale,this},_draw:function(){this.canvas.clear(),this.canvas.fillStyle="white",this.canvas.strokeStyle="white",this.canvas.context.lineJoin="round",this.canvas.context.lineCap="round",this._canvasCache.last&&this.canvas.drawTexture(this._canvasCache.last,0,0),this.canvas.save(),this.renderer.render(this.currentScene),this.canvas.restore()}}),tm.display.CanvasApp.prototype.accessor("width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}}),tm.display.CanvasApp.prototype.accessor("height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}),tm.display.CanvasApp.prototype.accessor("background",{get:function(){return this._background},set:function(t){this._background=t,this.element.style.background=t}})}(),tm.display=tm.display||{},function(){tm.display.CanvasElement=tm.createClass({superClass:tm.app.Object2D,visible:!0,clipping:!1,fillStyle:"white",strokeStyle:"white",alpha:1,blendMode:"source-over",shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,init:function(){this.superInit()},setAlpha:function(t){return this.alpha=t,this},setShadowColor:function(t){return this.shadowColor=t,this},setShadowBlur:function(t){return this.shadowBlur=t,this},setShadowOffset:function(t,e){return this.shadowOffsetX=t,this.shadowOffsetY=e,this},drawBoundingCircle:function(t){t.save(),t.lineWidth=2,t.strokeCircle(0,0,this.radius),t.restore()},drawBoundingRect:function(t){t.save(),t.lineWidth=2,t.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),t.restore()},drawFillRect:function(t){return t.fillRect(-this.width/2,-this.height/2,this.width,this.height),this},drawStrokeRect:function(t){return t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),this},drawFillArc:function(t){return t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI,!1),t.fill(),t.closePath(),this},drawStrokeArc:function(t){return t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI,!1),t.stroke(),t.closePath(),this},setVisible:function(t){return this.visible=t,this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},setFillStyle:function(t){return this.fillStyle=t,this},setStrokeStyle:function(t){return this.strokeStyle=t,this},setBlendMode:function(t){return this.blendMode=t,this},load:function(t){var e=this;t.layers.forEach(function(t){if("objectgroup"==t.type){var i=tm.display.CanvasElement().addChildTo(e);i.width=t.width,i.height=t.height,t.objects.forEach(function(t){var e=tm.using(t.type);0===Object.keys(e).length&&(e=tm.display[t.type]);var n=null;t.properties.init&&(n=JSON.parse(t.properties.init));var s=e.apply(null,n).addChildTo(i),r=t.properties;for(var a in r)if("init"!=a){var o=r[a];s[a]=o}s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height}),e[t.name]=i}})},_calcAlpha:function(){return this.parent?void(this._worldAlpha=this.parent._worldAlpha*this.alpha):void(this._worldAlpha=this.alpha)},_dirtyCalc:function(){this._calcAlpha(),this._calcWorldMatrix()}})}(),tm.display=tm.display||{},function(){tm.display.Sprite=tm.createClass({superClass:tm.display.CanvasElement,init:function(t,e,i){this.superInit(),console.assert("number"!=typeof t,"Sprite の第一引数はテクスチャもしくはテクスチャ名に変わりました"),this._frameIndex=0,this.srcRect=tm.geom.Rect(0,0,64,64),arguments.length>=1&&(this.setImage(t).fitImage(),void 0!==e&&(this.width=e),void 0!==i&&(this.height=i))},setImage:function(t,e,i){if("string"==typeof t){var n=t;t=tm.asset.Manager.get(n),console.assert(null!=t,"don't find '"+n+"' as image.")}return this._image=t,this.srcRect.x=0,this.srcRect.y=0,this.srcRect.width=t.element.width,this.srcRect.height=t.element.height,void 0!==e&&(this.width=e),void 0!==i&&(this.height=i),this},getImage:function(){return this._image},fitImage:function(){return this.width=this.image.width,this.height=this.image.height,this},setFrameIndex:function(t,e,i){var n=e||this.width,s=i||this.height,r=~~(this.image.width/n),a=~~(this.image.height/s),o=r*a;t%=o;var h=t%r,l=~~(t/r);return this.srcRect.x=h*n,this.srcRect.y=l*s,this.srcRect.width=n,this.srcRect.height=s,this._frameIndex=t,this},_refreshSize:function(){}}),tm.display.Sprite.prototype.accessor("image",{get:function(){return this._image},set:function(t){this.setImage(t)}}),tm.display.Sprite.prototype.accessor("frameIndex",{get:function(){return this._frameIndex},set:function(t){this.setFrameIndex(t)}})}(),tm.display=tm.display||{},function(){tm.display.Shape=tm.createClass({superClass:tm.display.CanvasElement,init:function(t){t=this._dirtyCheckParam.apply(this,arguments);var t={}.$safe(t,{width:64,height:64,bgColor:"transparent",fillStyle:"red",strokeStyle:"white",lineWidth:"2",shadowBlur:0,shadowColor:"red"});this.superInit(),this.canvas=tm.graphics.Canvas(),this.$extend(t),this.render(),this.autoRender=!0},_prerender:function(){var t=this.canvas;return t.resize(this.width,this.height),t.clearColor(this.bgColor),t.save(),t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth,t.shadowBlur=this.shadowBlur,t.shadowColor=this.shadowColor,this},_postrender:function(){var t=this.canvas;return t.restore(),this},render:function(){this._prerender(),this._render(),this._postrender()},_render:function(){},renderText:function(t){var e=this.canvas;t={}.$extend(tm.display.Shape.DEFAULT_SHAPE_PARAM_TEXT,t),e.save(),e.fillStyle=t.fillStyle,e.strokeStyle=t.strokeStyle,e.lineWidth=t.lineWidth,e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.strokeText(t.text,this.width/2,this.height/2),e.fillText(t.text,this.width/2,this.height/2),e.restore()},_dirtyCheckParam:function(t){var t=t;if(arguments.length>=2){var e=arguments[0],i=arguments[1],t=arguments[2]||{};t.width=e,t.height=i,console.warn("tmlib.js warn: arguments of shape init is only param from version 0.4")}return t}}),["width","height","bgColor","strokeStyle","fillStyle","lineWidth","shadowBlur","shadowColor"].each(function(t){var e="_"+t;tm.display.Shape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.CircleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=Math.min(this.width,this.height)/2;t.fillCircle(this.width/2,this.height/2,e),t.strokeCircle(this.width/2,this.height/2,e-Number(t.lineWidth)/2)}})}(),function(){tm.define("tm.display.TriangleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"green"}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.width/2,i=this.height/2,n=Math.min(this.width,this.height)/2,s=1*Number(t.lineWidth);t.fillPolygon(e,i,n,3),t.strokePolygon(e,i,n-s,3)}})}(),function(){tm.define("tm.display.RectangleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"blue"}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.lineWidth,i=e/2;t.fillRect(0,0,this.width,this.height),t.strokeRect(i,i,this.width-e,this.height-e)}})}(),function(){tm.define("tm.display.RoundRectangleShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"blue",cornerRadius:8}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.lineWidth,i=e/2;t.fillRoundRect(i,i,this.width-e,this.height-e,this.cornerRadius),t.strokeRoundRect(i,i,this.width-e,this.height-e,this.cornerRadius)}}),["cornerRadius"].each(function(t){var e="_"+t;tm.display.RoundRectangleShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.StarShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"yellow",sides:5,sideIndent:.38,offsetAngle:-90}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.sides,i=this.sideIndent,n=this.offsetAngle,s=this.width/2,r=this.height/2,a=Math.min(this.width,this.height)/2,o=1.5*Number(t.lineWidth);t.fillStar(s,r,a,e,i,n),t.strokeStar(s,r,a-o,e,i,n)}}),["sides","sideIndent","offsetAngle"].each(function(t){var e="_"+t;tm.display.StarShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.PolygonShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"cyan",sides:5,sideIndent:.38,offsetAngle:-90}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.sides,i=this.offsetAngle,n=this.width/2,s=this.height/2,r=Math.min(this.width,this.height)/2,a=.6*Number(t.lineWidth);t.fillPolygon(n,s,r,e,i),t.strokePolygon(n,s,r-a,e,i)}}),["sides","offsetAngle"].each(function(t){var e="_"+t;tm.display.PolygonShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){tm.define("tm.display.HeartShape",{superClass:tm.display.Shape,init:function(t){t=this._dirtyCheckParam.apply(this,arguments),t={}.$safe(t,{fillStyle:"pink",cornerAngle:45}),this.superInit(t),this.render()},_render:function(){var t=this.canvas,e=this.width/2,i=this.height/2,n=Math.min(this.width,this.height)/2;t.fillHeart(e,i,n,this.cornerAngle),t.strokeHeart(e,i,n-Number(t.lineWidth)/2,this.cornerAngle)}}),["cornerAngle"].each(function(t){var e="_"+t;tm.display.HeartShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),function(){var t=null;tm.define("tm.display.TextShape",{superClass:"tm.display.Shape",init:function(t,e,i){i=this._dirtyCheckParam.apply(this,arguments),i={}.$safe(i,{fillStyle:"black",lineWidth:4,text:"hello, world!",fontSize:64,fontWeight:"",fontFamily:"'HiraKakuProN-W3'"}),this.superInit(i),this.fit(),this.render()},fit:function(){t||(t=tm.graphics.Canvas()),t.font="{fontWeight} {fontSize}px {fontFamily}".format(this);var e=t.context.measureText(this.text).width+10,i=1.5*t.context.measureText("あ").width;this.width=e,this.height=i},_render:function(){var t=this.canvas;t.fillStyle=this.fillStyle,t.strokeStyle=this.strokeStyle,t.font="{fontWeight} {fontSize}px {fontFamily}".format(this),t.textAlign="center",t.textBaseline="middle";var e=(t.context.measureText(this.text).width,this.width/2),i=this.height/2;t.strokeText(this.text,e,i),t.fillText(this.text,e,i)}}),["text","fontWeight","fontSize","fontFamily"].each(function(t){var e="_"+t;tm.display.TextShape.prototype.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this.autoRender===!0&&this.render()}})})}(),tm.display=tm.display||{},function(){var t=document.createElement("canvas"),e=t.getContext("2d");tm.display.Label=tm.createClass({superClass:tm.display.CanvasElement,fill:!0,stroke:!1,debugBox:!1,_cache:null,init:function(t,e){this.superInit(),this.text=t,this._fontSize=e||24,this._fontFamily=tm.display.Label["default"].fontFamily,this._fontWeight="",this._lineHeight=1.2,this._updateFont(),this.align=tm.display.Label["default"].align,this.baseline=tm.display.Label["default"].baseline,this.maxWidth=null},setAlign:function(t){return this.align=t,this},setBaseline:function(t){return this.baseline=t,this},setFontSize:function(t){return this.fontSize=t,this},setFontFamily:function(t){return this.fontFamily=t,this},setFontWeight:function(t){return this.fontWeight=t,this},_updateFont:function(){this.fontStyle="{fontWeight} {fontSize}px {fontFamily}".format(this),this._cache=tm.display.Label._cache[this.fontStyle],this.textSize=this.measure("あ")*this.lineHeight},_updateLines:function(){var t=this._lines=(this._text+"").split("\n");if(this._rowWidth)for(var i=this._rowWidth,n=i/this.measure("あ")|0,s=this._cache||(this._cache=tm.display.Label._cache[this.fontStyle]={}),r=t.length;r--;)for(var a,o,h,l,u=t[r],c=0;;){if(i>(s[u]||(s[u]=e.measureText(u).width)))break;if(a=a||n,o=u.length,a>=o&&(a=o-1),i<(h=s[l=u.substring(0,a)]||(s[l]=e.measureText(l).width)))for(;i<(h-=s[l=u[--a]]||(s[l]=e.measureText(l).width)););else{for(;i>=(h+=s[l=u[a++]]||(s[l]=e.measureText(l).width)););--a}0===a&&(a=1),t.splice(r+c++,1,u.substring(0,a),u=u.substring(a,o))}},measure:function(t,i){if(e.font=this.fontStyle,t=null==t?"":t+"",i){t=t.split("\n");var n=0;return t.forEach(function(t){var i=e.measureText(t).width;i>n&&(n=i)}),n}return e.measureText(t).width},setRowWidth:function(t){return this.rowWidth=t,this},setText:function(t){return this.text=t,this}}),tm.display.Label.prototype.accessor("text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=null!=t?t:"",this._updateLines())}}),tm.display.Label.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateFont()}}),tm.display.Label.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily=t,this._updateFont()}}),tm.display.Label.prototype.accessor("fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._updateFont()}}),tm.display.Label.prototype.accessor("lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight=t,this._updateFont()}}),tm.display.Label.prototype.accessor("rowWidth",{get:function(){return this._rowWidth},set:function(t){this._rowWidth=t,this._updateLines()}}),tm.display.Label["default"]={align:"center",baseline:"middle",fontFamily:"'HiraKakuProN-W3'"},tm.display.Label._cache={}}(),tm.display=tm.display||{},function(){tm.display.AnimationSprite=tm.createClass({superClass:tm.display.CanvasElement,init:function(t,e,i){if(this.superInit(),"string"==typeof t){var t=tm.asset.Manager.get(t);console.assert(t,"not found "+t)}console.assert("object"==typeof t,"AnimationSprite の第一引数はスプライトシートもしくはスプライトシート名に変わりました"),this.ss=t,this.width=e||t.frame.width,this.height=i||t.frame.height,this.currentFrame=0,this.currentFrameIndex=0,this.paused=!0,this.currentAnimation=null,this.addEventListener("enterframe",function(t){this.paused||t.app.frame%this.currentAnimation.frequency!==0||this._updateFrame()})},draw:function(t){var e=this.ss.getFrame(this.currentFrame),i=this.ss.image.element;t.drawImage(i,e.x,e.y,e.width,e.height,-this.width*this.originX,-this.height*this.originY,this.width,this.height)},gotoAndPlay:function(t){return t=void 0!==t?t:"default",this.paused=!1,this.currentAnimation=this.ss.animations[t],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},gotoAndStop:function(t){return t=void 0!==t?t:"default",this.paused=!0,this.currentAnimation=this.ss.animations[t],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},_updateFrame:function(){this.currentFrameIndex+=1,this._normalizeFrame()},_normalizeFrame:function(){var t=this.currentAnimation;if(t)if(this.currentFrameIndex<t.frames.length)this.currentFrame=t.frames[this.currentFrameIndex];else{t.next?this.gotoAndPlay(t.next):(this.currentFrameIndex=t.frames.length-1,this.currentFrame=t.frames[this.currentFrameIndex],this.paused=!0);var e=tm.event.Event("animationend");this.dispatchEvent(e)}}})}(),function(){tm.define("tm.display.MapSprite",{superClass:"tm.display.CanvasElement",init:function(t,e,i){this.superInit(),"string"==typeof t?this.mapSheet=tm.asset.Manager.get(t):this.mapSheet=t,this.chipWidth=e||32,this.chipHeight=i||32,this.originX=this.originY=0,this.width=e*this.mapSheet.width,this.height=e*this.mapSheet.height,this.tileset=[],this.tilesetInfo={},this._build()},_build:function(){var t=this;this.mapSheet.tilesets.each(function(e,i){t._buildTileset(e,i)}),this.mapSheet.layers.each(function(e,i){"objectgroup"==e.type?t._buildObject(e):"imagelayer"==e.type?t._buildImageLayer(e):t._buildLayer(e)})},_buildTileset:function(t,e){var i=this,n=this.mapSheet,s=tm.asset.Manager.get(t.image),r=s.width/n.tilewidth|0,a=s.height/n.tileheight|0,o={begin:i.tileset.length,end:i.tileset.length+r*a};i.tilesetInfo[e]=o,void 0!==t.name&&(i.tilesetInfo[t.name]=o),a.times(function(e){r.times(function(s){var r=tm.geom.Rect(s*n.tilewidth,e*n.tileheight,n.tilewidth,n.tileheight);i.tileset.push({image:t.image,rect:r})})})},_buildLayer:function(t){var e=this,i=this.mapSheet,n=tm.display.Shape({width:this.width,height:this.height}).addChildTo(this),s=1===t.visible||void 0===t.visible,r=void 0===t.opacity?1:t.opacity,a=[];if(n.origin.set(0,0),void 0!==t.tilesets){var o=null;o=Array.isArray(t.tilesets)?t.tilesets:[t.tilesets],o.each(function(t){var i=e.tilesetInfo[t];a=a.concat(e.tileset.slice(i.begin,i.end))})}else a=e.tileset;s&&t.data.each(function(t,s){var o=t;if(-1!=o&&(o=Math.abs(o),void 0!==a[o])){var h=s%i.width,l=s/i.width|0,u=h*e.chipWidth,c=l*e.chipHeight,m=a[o],p=tm.asset.Manager.get(m.image),d=m.rect;n.canvas.globalAlpha=r,n.canvas.drawTexture(p,d.x,d.y,d.width,d.height,u,c,e.chipWidth,e.chipHeight)}}.bind(this))},_buildObject:function(t){var e=this,i=tm.display.CanvasElement().addChildTo(e);i.width=e.width,i.height=e.height,t.objects.forEach(function(t){var e=tm.using(t.type);0===Object.keys(e).length&&(e=tm.display[t.type]);var n=null;t.properties.init&&(n=JSON.parse(t.properties.init));var s=e.apply(null,n).addChildTo(i),r=t.properties;for(var a in r)if("init"!=a){var o=r[a];s[a]=o}s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height,i[t.name]=s}),e[t.name]=i},_buildImageLayer:function(t){var e=tm.display.Sprite(t.image.source).setOrigin(0,0).addChildTo(this);e.x=t.x,e.y=t.y,e.alpha=t.alpha,e.visible=t.visible,this[t.name]=e}})}(),function(){tm.define("tm.display.CanvasRenderer",{canvas:null,init:function(t){this.canvas=t,this._context=this.canvas.context},render:function(t){this.canvas.save(),this.renderObject(t),this.canvas.restore()},renderObject:function(t){if(t.visible!==!1){var i=this._context;if(t._dirtyCalc&&t._dirtyCalc(),this._checkRenderable(t)){t.draw||this._setRenderFunction(t),t.fillStyle&&(i.fillStyle=t.fillStyle),t.strokeStyle&&(i.strokeStyle=t.strokeStyle),i.globalAlpha=t._worldAlpha,i.globalCompositeOperation=t.blendMode,t.shadowBlur?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur):(i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowColor="rgba(0, 0, 0, 0)");var n=t._worldMatrix.m;if(i.setTransform(n[0],n[3],n[1],n[4],n[2],n[5]),t.clipping){if(i.save(),t.clip?t.clip():e.call(t,this.canvas),i.clip(),t.draw(this.canvas),t.children.length>0)for(var s=t.children.slice(),r=0,a=s.length;a>r;++r)this.renderObject(s[r]);i.restore()}else if(t.draw(this.canvas),t.children.length>0)for(var s=t.children.slice(),r=0,a=s.length;a>r;++r)this.renderObject(s[r])}else if(t.children.length>0)for(var s=t.children.slice(),r=0,a=s.length;a>r;++r)this.renderObject(s[r])}},_checkRenderable:function(t){return void 0===t._renderable&&(t._renderable=t instanceof tm.display.CanvasElement),t._renderable},_setRenderFunction:function(e){e instanceof tm.display.Sprite?e.draw=t.sprite:e instanceof tm.display.MapSprite?e.draw=function(){}:e instanceof tm.display.Label?e.draw=t.label:e instanceof tm.display.Shape?e.draw=t.shape:e.draw=function(){}}});var t={sprite:function(t){var e=this.srcRect,i=this._image.element;t.context.drawImage(i,e.x,e.y,e.width,e.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},shape:function(t){this.srcRect;t.drawImage(this.canvas.canvas,0,0,this.canvas.width,this.canvas.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},label:function(t){t.setText(this.fontStyle,this.align,this.baseline),this.lineWidth&&(t.lineWidth=this.lineWidth),this.stroke&&(this.maxWidth?this._lines.each(function(e,i){t.strokeText(e,0,this.textSize*i,this.maxWidth)}.bind(this)):this._lines.each(function(e,i){t.strokeText(e,0,this.textSize*i)}.bind(this))),this.fill&&(this.maxWidth?this._lines.each(function(e,i){t.fillText(e,0,this.textSize*i,this.maxWidth)}.bind(this)):this._lines.each(function(e,i){t.fillText(e,0,this.textSize*i)}.bind(this))),this.debugBox&&t.strokeRect(0,0,this.width,-this.size)}},e=function(t){t.beginPath(),t.rect(-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)}}(),function(){tm.define("tm.display.BoundingRectRenderer",{superClass:"tm.display.CanvasRenderer",init:function(t){this.superInit(t)},_setRenderFunction:function(e){e.draw=t}});var t=function(t){t.save(),t.lineWidth=2,t.strokeRect(-this.width*this.originX,-this.height*this.originY,this.width,this.height),t.restore()}}(),tm.ui=tm.ui||{},function(){tm.ui.Pad=tm.createClass({superClass:tm.display.Shape,isTouching:!1,circle:null,init:function(){this.superInit(120,120);var t=this.canvas;t.fillStyle="#fff",t.fillCircle(60,60,60),t.fillStyle="#eee",this._createCircle(),this.setInteractive(!0),this.alpha=.75},_createCircle:function(){var t=this.circle=tm.display.Shape(80,80);this.addChild(t);var e=t.canvas;e.fillStyle="#222",e.setShadow("black",2,2,2),e.fillCircle(40,40,35)},onpointingstart:function(){this.isTouching=!0},onpointingend:function(){this.isTouching=!1,this.circle.position.set(0,0)},onpointingmove:function(t){if(0!=this.isTouching){var e=t.pointing,i=tm.geom.Vector2(e.x-this.x,e.y-this.y),n=i.length();i.div(n),n>40&&(n=40),this.angle=Math.radToDeg(i.toAngle()),this.circle.position.set(i.x*n,i.y*n),this.distance=n/40,this.direction=i.mul(this.distance)}}})}(),tm.ui=tm.ui||{},function(){tm.define("tm.ui.BaseButton",{superClass:"tm.display.CanvasElement",init:function(t){this.superInit(),t=t||{},this.width=t.width||64,this.height=t.height||64,this.setInteractive(!0),this.boundingType="rect",this.on("pointingend",function(){this.flare("push")})}})}(),function(){tm.define("tm.ui.SpriteButton",{superClass:"tm.ui.BaseButton",init:function(t){this.superInit(),this.sprite=tm.display.Sprite(t).addChildTo(this),this.width=this.sprite.width,this.height=this.sprite.height}})}(),function(){tm.ui.LabelButton=tm.createClass({superClass:tm.display.Label,init:function(t){this.superInit(t),this.alpha=tm.ui.LabelButton.DEFAULT_ALPHA,this.setAlign("center").setBaseline("middle"),this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fadeIn(250)}.bind(this)),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.LabelButton.DEFAULT_ALPHA,250)}.bind(this))}}),tm.ui.LabelButton.DEFAULT_ALPHA=.5}(),function(){tm.ui.IconButton=tm.createClass({superClass:tm.display.Sprite,init:function(){this.superInit.apply(this,arguments),this.setInteractive(!0),this.boundingType="rect",this.on("pointingend",function(){this.flare("push")})}}),tm.ui.IconButton.DEFAULT_ALPHA=.5}(),function(){tm.ui.GlossyButton=tm.createClass({superClass:tm.display.Shape,init:function(t,e,i,n){this.superInit(t,e),n=n||"Button",this.backgroundColor=i||"black",this.alpha=tm.ui.GlossyButton.DEFAULT_ALPHA,this.setInteractive(!0),this.boundingType="rect",this.addEventListener("pointingover",function(){this.tweener.clear(),this.tweener.fade(1,250)}),this.addEventListener("pointingout",function(){this.tweener.clear(),this.tweener.fade(tm.ui.GlossyButton.DEFAULT_ALPHA,250)}),this.label=tm.display.Label(n||"").addChildTo(this),this.label.setAlign("center").setBaseline("middle"),this._refresh()},setBackgroundColor:function(t){return this.backgroundColor=t,this._refresh(),this},_refresh:function(){var t=this.canvas;t.resize(this.width,this.height),t.fillStyle=this.backgroundColor,t.fillRoundRect(2,2,this.width-4,this.height-4,10),t.strokeStyle="rgba(100,100,100,0.75)",t.lineWidth=2,t.strokeRoundRect(2,2,this.width-4,this.height-4,10),t.roundRect(2,2,this.width-4,this.height-4,10),t.clip();var e=tm.graphics.LinearGradient(0,0,0,this.height);e.addColorStop(0,"rgba(255,255,255,0.9)"),e.addColorStop(.5,"rgba(255,255,255,0.5)"),e.addColorStop(.51,"rgba(255,255,255,0.2)"),e.addColorStop(1,"rgba(255,255,255,0.0)"),t.setGradient(e),t.fillRect(2,2,this.width-4,this.height-4,10),this.label.setSize(this.width,this.height)}}),tm.ui.GlossyButton.DEFAULT_ALPHA=.5}(),function(){tm.define("tm.ui.FlatButton",{superClass:"tm.ui.BaseButton",init:function(t){t=(t||{}).$safe(tm.ui.FlatButton.defaults),this.superInit(t),this.shape=tm.display.RoundRectangleShape(t).addChildTo(this),this.label=tm.display.Label(t.text).addChildTo(this),this.label.setFontSize(t.fontSize).setFontFamily(t.fontFamily).setAlign("center").setBaseline("middle")}}),tm.ui.FlatButton.defaults={width:300,height:100,fillStyle:"hsl(180, 60%, 50%)",strokeStyle:"transparent",text:"START",fontSize:50,cornerRadius:8,fontFamily:"'ヒラギノ角ゴ Pro W3', 'Hiragino Kaku Gothic Pro', 'メイリオ', 'Meiryo', 'ＭＳ Ｐゴシック', 'MS PGothic', sans-serif"}}(),function(){tm.define("tm.ui.MenuDialog",{superClass:tm.app.Scene,titleText:null,menu:null,descriptions:null,showExit:!1,title:null,selections:[],description:null,box:null,cursor:null,_selected:0,_opened:!1,_finished:!1,_screenWidth:0,_screenHeight:0,init:function(t){this.superInit(),this._screenWidth=t.screenWidth,this._screenHeight=t.screenHeight,this.titleText=t.title,this.menu=[].concat(t.menu),this._selected=~~t.defaultSelected,this.showExit=!!t.showExit,t.menuDescriptions?this.descriptions=t.menuDescriptions:this.descriptions=[].concat(t.menu),this.showExit&&(this.menu.push("exit"),
this.descriptions.push("前の画面へ戻ります"));var e=Math.max(50*(1+this.menu.length),50)+40;this.box=tm.display.RectangleShape(.8*this._screenWidth,e,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(43,156,255, 0.8)"}).setPosition(.5*this._screenWidth,.5*this._screenHeight),this.box.width=1,this.box.height=1,this.box.setBoundingType("rect"),this.box.tweener.to({width:.8*this._screenWidth,height:e},200,"easeOutExpo").call(this._onOpen.bind(this)),this.box.addChildTo(this),this.description=tm.display.Label("",14).setAlign("center").setBaseline("middle").setPosition(.5*this._screenWidth,this._screenHeight-10).addChildTo(this)},_onOpen:function(){var t=this,e=.5*this._screenHeight-25*this.menu.length;this.title=tm.display.Label(this.titleText,30).setAlign("center").setBaseline("middle").setPosition(.5*this._screenWidth,e).addChildTo(this),this.cursor=this._createCursor(),this.selections=this.menu.map(function(t,i){var n=this;e+=50;var s=tm.ui.LabelButton(t).setPosition(.5*this._screenWidth,e).addChildTo(this);return s.interactive=!0,s.addEventListener("click",function(){if(n._selected===i)n.closeDialog(n._selected);else{n._selected=i;var t=tm.event.Event("menuselect");t.selectValue=n.menu[n._selected],t.selectIndex=i,n.dispatchEvent(t)}}),s.width=.7*this._screenWidth,s}.bind(this)),this.cursor.y=this.selections[this._selected].y,this._opened=!0,this.addEventListener("pointingend",function(e){var i=e.app.pointing;t.box.isHitPoint(i.x,i.y)||t.closeDialog(t._selected)});var i=tm.event.Event("menuopened");this.dispatchEvent(i)},_createCursor:function(){var t=tm.display.RectangleShape(.7*this._screenWidth,30,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(12,79,138,1)"}).addChildTo(this);return t.x=.5*this._screenWidth,t.target=this._selected,t.update=function(){this.target!==this.parent._selected&&(this.target=this.parent._selected,this.tweener.clear(),this.tweener.to({y:this.parent.selections[this.parent._selected].y},200,"easeOutExpo"))},t},update:function(t){this.description.text=this.descriptions[this._selected]},closeDialog:function(t){this._finished=!0;var e=tm.event.Event("menuselected");e.selectIndex=t,this.dispatchEvent(e),this.tweener.clear().wait(200).call(function(){this.cursor.remove(),this.title.remove(),this.selections.each(function(t){t.remove()}),this.box.tweener.clear(),this.box.tweener.to({width:1,height:1},200,"easeInExpo").call(function(){this.app.popScene();var e=tm.event.Event("menuclosed");e.selectIndex=t,this.dispatchEvent(e)}.bind(this))}.bind(this)),this.cursor.tweener.clear().call(function(){this.visible=!this.visible}.bind(this.cursor)).setLoop(!0)},draw:function(t){t.fillStyle="rgba(0,0,0,0.8)",t.fillRect(0,0,this._screenWidth,this._screenHeight)}})}(),function(){var t={bgColor:"rgba(255, 255, 255, 1.0)",penColor:"rgba(0, 0, 0, 1.0)",lineWidth:16};tm.define("tm.ui.Sketch",{superClass:"tm.display.Shape",init:function(e){e=this._dirtyCheckParam.apply(this,arguments),e.$safe(t),this.superInit(e),this.autoRender=!1,this._setup(e)},_setup:function(t){var e=this;this.boundingType="rect",this.setInteractive(!0);var i=this.canvas.context;i.lineCap="round",i.lineJoin="round",i.miterLimit=10,this.bgColor=t.bgColor,this.penColor=t.penColor,this.lineWidth=t.lineWidth,this.on("pointingstart",function(t){var i=t.app.pointing;e._drawPoint(i.position)}),this.on("pointingmove",function(t){var i=t.app.pointing;e._drawLine(i.prevPosition,i.position),e.points.push({x:i.x-this.left,y:i.y-this.top})}),this.on("pointingend",function(t){e.pointsList.push(e.points),e.points=[]}),this.pointsList=[],this.points=[]},clear:function(){return this.canvas.clear(),this.canvas.clearColor(this.bgColor),this.pointsList=[],this.points=[],this},_drawPoint:function(t){this.canvas.drawPoint(t.x-this.left,t.y-this.top)},_drawLine:function(t,e){this.canvas.drawLine(t.x-this.left,t.y-this.top,e.x-this.left,e.y-this.top)}}),tm.ui.Sketch.prototype.accessor("penColor",{get:function(){return this._penColor},set:function(t){this._penColor=t,this.canvas.strokeStyle=t}}),tm.ui.Sketch.prototype.accessor("bgColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this.clear()}}),tm.ui.Sketch.prototype.accessor("lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.canvas.lineWidth=t}})}(),function(){tm.ui.Gauge=tm.createClass({superClass:tm.display.CanvasElement,animationFlag:!0,animationTime:1e4,init:function(t){this.superInit(),t=t||{},t.$safe({width:300,height:25,color:"hsl(220, 100%, 50%)",bgColor:"#444",borderColor:"white",borderWidth:4}),this.$extend(t),this._reset()},isFull:function(){return this._value===this._maxValue},isEmpty:function(){return 0===this._value},_reset:function(t){this.originX=0,this._realValue=this._value=this._maxValue=100},setValue:function(t){if(t=Math.clamp(t,0,this._maxValue),this._realValue=t,this._value!==t){if(this.fire(tm.event.Event("change")),this.isAnimation()){this.tweener.clear();var e=Math.abs(this._value-t)/100*this.animationTime;this.tweener.clear().to({_value:t},e).call(function(){this.fire(tm.event.Event("changed")),this.isEmpty()?this.fire(tm.event.Event("empty")):this.isFull()&&this.fire(tm.event.Event("full"))}.bind(this))}else this._value=t,this.fire(tm.event.Event("changed")),this.isEmpty()?this.fire(tm.event.Event("empty")):this.isFull()&&this.fire(tm.event.Event("full"));return this}},getValue:function(){return this.value},getRealValue:function(){return this._realValue},setPercent:function(t){return this.setValue(this._maxValue*t*.01)},getPercent:function(){return this._value/this._maxValue*100},getRealPercent:function(){return this._realValue/this._maxValue*100},setRatio:function(t){return this.setValue(this._maxValue*t)},getRatio:function(){return this._value/this._maxValue},getRealRatio:function(){return this._realValue/this._maxValue},isAnimation:function(){return this.animationFlag},draw:function(t){t.save(),t.fillStyle=this.bgColor,t.fillRect(0,0,this.width,this.height),t.fillStyle=this.color,t.fillRect(0,0,this.width*this.getRatio(),this.height),t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.strokeRect(0,0,this.width,this.height),t.restore()}}),tm.ui.Gauge.prototype.accessor("value",{get:function(){return this._value},set:function(t){this.setValue(t)}}),tm.ui.Gauge.prototype.accessor("realValue",{get:function(){return this._realValue},set:function(t){this.setValue(t)}}),tm.ui.Gauge.prototype.accessor("percent",{get:function(){return this.getPercent()},set:function(t){this.setPercent(t)}}),tm.ui.Gauge.prototype.accessor("realPercent",{get:function(){return this.getRealPercent()},set:function(t){this.setRealPercent(t)}}),tm.ui.Gauge.prototype.accessor("ratio",{get:function(){return this.getRatio()},set:function(t){this.setRatio(t)}}),tm.ui.Gauge.prototype.accessor("realRatio",{get:function(){return this.getRealRatio()},set:function(t){this.setRatio(t)}})}(),function(){tm.define("tm.ui.FlatGauge",{superClass:"tm.ui.Gauge",init:function(t){this.superInit(t)},draw:function(t){t.save(),t.save(),t.roundRect(0,0,this.width,this.height,this.height/2),t.clip(),t.fillStyle=this.bgColor,t.fillRect(0,0,this.width,this.height),t.fillStyle=this.color,t.fillRect(0,0,this.width*this.getRatio(),this.height),t.restore(),t.strokeStyle=this.borderColor,t.lineWidth=this.borderWidth,t.strokeRoundRect(0,0,this.width,this.height,this.height/2),t.restore()}})}(),function(){tm.define("tm.ui.GlossyGauge",{superClass:"tm.ui.Gauge",init:function(t){t=t||{},t.borderWidth=t.borderWidth||2,this.superInit(t)},draw:function(t){t.save(),t.roundRect(0,0,this.width,this.height,this.height/2),t.clip(),t.fillStyle=this.bgColor,t.fillRect(0,0,this.width,this.height),t.fillStyle=this.color,t.fillRect(0,0,this.width*this.getRatio(),this.height);var e=tm.graphics.LinearGradient(0,0,0,this.height);e.addColorStop(0,"rgba(255,255,255,0.9)"),e.addColorStop(.5,"rgba(255,255,255,0.5)"),e.addColorStop(.51,"rgba(255,255,255,0.2)"),e.addColorStop(1,"rgba(255,255,255,0.0)"),t.setGradient(e),t.fillRect(0,0,this.width*this.getRatio(),this.height),t.restore(),t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,t.strokeRoundRect(0,0,this.width,this.height,this.height/2)}})}(),function(){tm.define("tm.ui.LabelArea",{superClass:"tm.display.Shape",init:function(t){t=t||{},this.superInit(t.width||150,t.height||60),this.canvas.clearColor("red"),this.$extend({mode:t.mode||"horizon",_fillStyle:t.fillStyle||"#aaa",_bgColor:t.bgColor||"transparent",_fontSize:t.fontSize||24,_fontFamily:t.fontFamily||"'Consolas', 'Monaco', 'ＭＳ ゴシック'",_fontWeight:t.fontWeight||"",lineSpace:t.lineSpace||1}),this._updateFont(),this.setText(t.text||"こんにちは,世界!")},setText:function(t){this._text!==t&&(this._text=t,this._renderText())},_renderText:function(){this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.clearColor(this.bgColor),this.canvas.font=this.fontStyle,this.canvas.fillStyle=this.fillStyle,this.canvas.fillLabelArea({text:this._text,x:0,y:0,width:this.width,height:this.height,mode:this.mode,lineSpace:this.lineSpace})},_updateFont:function(){this.fontStyle="{fontWeight} {fontSize}px {fontFamily}".format(this),this.text&&this._renderText()}}),tm.ui.LabelArea.prototype.accessor("text",{get:function(){return this._text},set:function(t){this.setText(t)}}),tm.ui.LabelArea.prototype.accessor("fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("fillStyle",{get:function(){return this._fillStyle},set:function(t){this._fillStyle=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("bgColor",{get:function(){return this._bgColor},set:function(t){this._bgColor=t,this._updateFont()}}),tm.ui.LabelArea.prototype.accessor("width",{get:function(){return this._width},set:function(t){this._width=t,this.text&&this._renderText()}}),tm.ui.LabelArea.prototype.accessor("height",{get:function(){return this._height},set:function(t){this._height=t,this.text&&this._renderText()}})}(),function(){tm.game=tm.game||{},tm.game.setup=function(t){t.$safe({query:"#world",title:"Title",background:"rgba(250, 250, 250, 1.0)",width:640,height:960,startLabel:"title",fitting:!0,fps:30,assets:window.ASSETS||null}),tm.globalize(),this.expand(t);var e=[{className:"SplashScene",arguments:{width:t.width,height:t.height},label:"splash",nextLabel:"title"},{className:"TitleScene",arguments:{title:t.title,width:t.width,height:t.height},label:"title"},{className:"GameScene",label:"game",nextLabel:"result"},{className:"ResultScene",arguments:{message:t.title,width:t.width,height:t.height},label:"result",nextLabel:"title"},{className:"PauseScene",label:"pause"}];tm.main(function(){var i=tm.app.CanvasApp(t.query);if(i.resize(SCREEN_WIDTH,SCREEN_HEIGHT),t.fitting&&i.fitWindow(),i.background=t.background,i.fps=t.fps,tm.game.app=i,t.assets){var n=tm.game.LoadingScene({assets:t.assets,width:SCREEN_WIDTH,height:SCREEN_HEIGHT});n.onload=function(){i.replaceScene(tm.game.ManagerScene({startLabel:t.startLabel,scenes:e}))},i.replaceScene(n)}else i.replaceScene(tm.game.ManagerScene({startLabel:t.startLabel,scenes:e}));i.run()})},tm.game.expand=function(t){tm.global.$extend({SCREEN_WIDTH:t.width,SCREEN_HEIGHT:t.height,SCREEN_CENTER_X:t.width/2,SCREEN_CENTER_Y:t.height/2,SCREEN_GRID_X:GridSystem(t.width,16),SCREEN_GRID_Y:GridSystem(t.height,16),QUERY:tm.util.QueryString.parse(location.search.substr(1))})}}(),function(){tm.define("tm.game.TitleScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),t={}.$extend(tm.game.TitleScene["default"],t),this.param=t,this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:{width:t.width,height:t.height,fillStyle:t.bgColor,strokeStyle:"transparent"},originX:0,originY:0}}}),t.bgImage&&this.fromJSON({children:{bgImage:{type:"tm.display.Sprite",init:[t.bgImage],originX:0,originY:0}}}),this.fromJSON({children:{titleLabel:{type:"Label",name:"titleLabel",text:t.title,x:this._toGridX(6),y:this._toGridY(3),fillStyle:t.fontColor,fontSize:t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"},messageLabel:{type:"Label",name:"nextLabel",text:t.message||"",x:this._toGridX(6),y:this._toGridY(6),fillStyle:t.fontColor,fontSize:.36*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"},touchLabel:{type:"Label",name:"nextLabel",text:"TOUCH START",x:this._toGridX(6),y:this._toGridY(9),fillStyle:t.fontColor,fontSize:.4*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",align:"center",baseline:"middle"}}}),this.touchLabel.tweener.fadeOut(500).fadeIn(1e3).setLoop(!0),this.autopop=t.autopop},_toGridX:function(t){return this.param.width/12*t},_toGridY:function(t){return this.param.height/12*t},onpointingstart:function(){this.flare("finish"),this.autopop&&this.app.popScene()}}),tm.game.TitleScene["default"]={title:"Time is money",message:"",fontSize:72,fontColor:"#444",width:640,height:960,bgColor:"rgb(240,240,240)",bgImage:null,autopop:!0}}(),function(){tm.define("tm.game.ResultScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),t={}.$extend(tm.game.ResultScene["default"],t),this.param=t;var e=this._getUserData(),i=e.bestScore?e.bestScore:0,n=t.score>i;t.record&&n&&(e.bestScore=t.score,this._record(e)),this.fromJSON({children:{bg:{type:"tm.display.RectangleShape",init:{width:t.width,height:t.height,fillStyle:t.bgColor,strokeStyle:"transparent"},originX:0,originY:0}}}),t.bgImage&&this.fromJSON({children:{bgImage:{type:"tm.display.Sprite",init:[t.bgImage],originX:0,originY:0}}});var s={type:"Label",fillStyle:t.fontColor,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"};this.fromJSON({children:{scoreText:s.$extend({text:"score",x:this._toGridX(4),y:this._toGridY(3),fontSize:.5*t.fontSize}),scoreLabel:{type:"Label",text:t.score,x:this._toGridX(4),y:this._toGridY(4),fillStyle:t.fontColor,fontSize:t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},bestText:{type:"Label",text:"best",x:this._toGridX(8),y:this._toGridY(3),fillStyle:t.fontColor,fontSize:.5*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},bestLabel:{type:"Label",text:i,x:this._toGridX(8),y:this._toGridY(4),fillStyle:t.fontColor,fontSize:t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},newRecordText:{type:"Label",text:"new record!",x:this._toGridX(6),y:this._toGridY(6),fillStyle:t.fontColor,fontSize:.5*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif",visible:!1},messageText:{type:"Label",text:t.message,x:this._toGridX(6),y:this._toGridY(7),fillStyle:t.fontColor,fontSize:.5*t.fontSize,fontFamily:"'Helvetica-Light' 'Meiryo' sans-serif"},shareButton:{type:"FlatButton",init:{text:"Share",width:200,fillStyle:"hsl(240, 100%, 64%)"},x:this._toGridX(4),y:this._toGridY(9)},backButton:{type:"FlatButton",init:{text:"Back",width:200,fillStyle:"hsl(240, 80%, 0%)"},x:this._toGridX(8),y:this._toGridY(9)}}});var r="SCORE: {score}, {message}".format(t),a=tm.social.Twitter.createURL({type:"tweet",text:r,hashtags:t.hashtags,url:t.url});this.shareButton.onclick=function(){window.open(a,"share window","width=400, height=300")},this.backButton.onpointingstart=this._back.bind(this),this.autopop=t.autopop,n&&(this.newRecordText.show(),this.newRecordText.tweener.set({alpha:0}).fadeIn(2e3).setLoop(!0))},_getUserData:function(){var t=location.pathname.toCRC32(),e=localStorage.getItem(t);return e?JSON.parse(e):{}},_record:function(t){var e=location.pathname.toCRC32(),i=JSON.stringify(t);return localStorage.setItem(e,i),this},_toGridX:function(t){return this.param.width/12*t},_toGridY:function(t){return this.param.height/12*t},_back:function(){this.flare("finish"),this.autopop&&this.app.popScene()}}),tm.game.ResultScene["default"]={score:0,message:"this is tmlib.js project.",hashtags:"tmlibjs,game",related:"tmlib.js tmlife javascript",url:"http://phi-jp.github.io/tmlib.js/",width:640,height:960,fontColor:"#444",fontSize:90,bgColor:"rgba(255,255,255, 0.9)",bgImage:null,record:!0,autopop:!0}}(),function(){var t={width:465,height:465,bgColor:"transparent"};tm.define("tm.game.LoadingScene",{superClass:"tm.app.Scene",init:function(e){this.superInit(),this.param=e={}.$extend(t,e),this.fromJSON({children:{stage:{type:"tm.display.CanvasElement"}}}),this.stage.fromJSON({children:{bg:{type:"tm.display.Shape",init:{width:e.width,height:e.height},originX:0,originY:0},piyoLayer:{type:"tm.display.CanvasElement"},label:{type:"tm.display.Label",text:"LOADING",x:e.width/2,y:e.height/2-20,align:"center",baseline:"middle",fontSize:46,shadowBlur:4,shadowColor:"hsl(190, 100%, 50%)"},bar:{type:"tm.ui.Gauge",init:[{width:e.width,height:10,color:"hsl(200, 100%, 80%)",bgColor:"transparent",borderColor:"transparent",borderWidth:0}],x:0,y:0}}});var i=this.stage.bg;i.canvas.clearColor(e.bgColor);var n=this.stage.label;n.tweener.to({alpha:1},1e3).to({alpha:.5},1e3).setLoop(!0);var s=this.stage.bar;s.animationFlag=!1,s.value=0,s.animationFlag=!0,s.animationTime=100,this._createHiyoko(e).addChildTo(this.stage.piyoLayer);var r=this.stage;r.alpha=0,r.tweener.clear().fadeIn(100).call(function(){if(e.assets){var t=tm.asset.Loader();t.onload=function(){r.tweener.clear().wait(200).fadeOut(200).call(function(){e.nextScene&&this.app.replaceScene(e.nextScene());var t=tm.event.Event("load");this.fire(t),1==e.autopop&&this.app.popScene()}.bind(this))}.bind(this),t.onprogress=function(t){s.value=100*t.progress;var e=tm.event.Event("progress");e.progress=t.progress,this.fire(e)}.bind(this),t.load(e.assets)}}.bind(this))},onpointingstart:function(t){var e=t.pointing,i=this._createHiyoko(this.param).addChildTo(this.stage.piyoLayer);i.x=e.x,i.y=e.y},_createHiyoko:function(t){var e=tm.display.Shape({width:84,height:84});e.x=tm.util.Random.randint(0,t.width),e.y=tm.util.Random.randint(0,t.height),e.canvas.setColorStyle("white","yellow").fillCircle(42,42,32),e.canvas.setColorStyle("white","black").fillCircle(27,27,2),e.canvas.setColorStyle("white","brown").fillRect(40,70,4,15).fillTriangle(0,40,11,35,11,45),e.dir=tm.geom.Vector2.random(0,360,4);var i=tm.geom.Rect(0,0,t.width,t.height);return i.padding(42),e.update=function(t){this.position.add(this.dir),this.x<i.left?(this.x=i.left,this.dir.x*=-1):this.x>i.right&&(this.x=i.right,this.dir.x*=-1),this.y<i.top?(this.y=i.top,this.dir.y*=-1):this.y>i.bottom&&(this.y=i.bottom,this.dir.y*=-1),this.dir.x<0?(this.rotation-=7,this.scaleX=1):(this.rotation+=7,this.scaleX=-1)},e}})}(),function(){var t="https://files.gitter.im/phi-jp/tmlib.js/t5F7/splash.png";tm.define("SplashScene",{superClass:"tm.app.Scene",init:function(e){this.superInit(),this.param=e,this.splashImage=tm.asset.Texture(e.path||t),this.splashImage.onload=this._init.bind(this)},_init:function(){var t=this.param.width,e=this.param.height;tm.display.Shape({width:t,height:e,bgColor:"white"}).setOrigin(0,0).addChildTo(this),tm.display.Sprite(this.splashImage,t,e).setOrigin(0,0).setAlpha(0).addChildTo(this).tweener.clear().wait(250).fadeIn(500).wait(1e3).fadeOut(500).wait(250).call(function(){this.app.popScene()}.bind(this))}})}(),function(){tm.define("tm.game.ManagerScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),this.setScenes(t.scenes),this.on("enter",function(){this.gotoScene(t.startLabel||0)}.bind(this)),this.on("resume",this.onnext.bind(this)),this.commonArguments={}},setScenes:function(t){return this.scenes=t,this.sceneIndex=0,this},gotoScene:function(t,e){t="string"==typeof t?this.labelToIndex(t):t||0;var i=tm.event.Event("prepare");this.fire(i);var n=this.scenes[t],s=tm.using(n.className),r=n.arguments,r={}.$extend(r,e),a=s.call(null,r);a.nextLabel||(a.nextLabel=n.nextLabel),a.nextArguments||(a.nextArguments=n.nextArguments),this.app.pushScene(a),this.sceneIndex=t,this.currentScene=a;var i=tm.event.Event("goto");return i.scene=a,this.fire(i),this},gotoNext:function(t){var e=this.scenes[this.sceneIndex],i=null;return e.nextLabel?i=this.labelToIndex(e.nextLabel):this.sceneIndex+1<this.scenes.length&&(i=this.sceneIndex+1),null!==i?this.gotoScene(i,t):this.fire(tm.event.Event("finish")),this},getCurrentIndex:function(){return this.sceneIndex},getCurrentLabel:function(){return this.scenes[this.sceneIndex].label},labelToIndex:function(t){var e=this.scenes.filter(function(e){return e.label==t})[0];return this.scenes.indexOf(e)},indexToLabel:function(t){return this.scenes[t].label},onnext:function(t){var e=t.prevScene.nextLabel,i=t.prevScene.nextArguments;e?this.gotoScene(e,i):this.gotoNext(i)}})}(),function(){tm.define("tm.game.NumericalInputScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),this.fromJSON({children:{inputLabel:{type:"tm.display.Label",fillStyle:"white",text:"",fontSize:64,x:320,y:120},buttonGroup:{type:"tm.display.CanvasElement"}}}),[1,2,3,4,5,6,7,8,9,"C",0,"OK"].each(function(t,e){var i=this._createButton(t.toString()).addChildTo(this.buttonGroup),n=e%3,s=e/3|0;i.x=190*n+130,i.y=177*s+280},this);var e=this,i=this.buttonGroup.children;i.each(function(t){t.setInteractive(!0).setBoundingType("circle"),t.radius=72.5,t.onpointingstart=function(){if("OK"==this.label.text){var t=tm.event.Event("decided");t.value=Number(e.inputLabel.text),e.fire(t)}else if("C"==this.label.text){var t=tm.event.Event("push");e.inputLabel.text="",e.flare("clear")}else e.inputLabel.text+=this.label.text,e.flare("push",{select:this.label.text})}})},_createButton:function(t){var e=tm.display.CanvasElement();return e.fromJSON({children:{bg:{type:"tm.display.CircleShape",init:[145,145,{fillStyle:"transparent",strokeStyle:"white"}]},label:{type:"tm.display.Label",text:t,fontSize:64,fillStyle:"white"}}}),e}})}(),function(){tm.define("tm.game.CountScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),t=t.$safe({width:640,height:960,bgColor:"#444",count:3,autopop:!0,fontSize:180}),t=t||{},this.fromJSON({children:{bg:{type:"tm.display.Shape",width:t.width,height:t.height,bgColor:t.bgColor,originX:0,originY:0},label:{type:"tm.display.Label",fillStyle:"white",fontSize:t.fontSize,x:SCREEN_CENTER_X,y:SCREEN_CENTER_Y}}}),t.count instanceof Array?this.countList=t.count.reverse():this.countList=Array.range(1,t.count+1),this.counter=this.countList.length,this.autopop=t.autopop,this._updateCount()},_updateCount:function(){var t=(this.counter<=0,--this.counter);this.label.text=this.countList[t],this.label.scale.set(1,1),this.label.tweener.clear().to({scaleX:1,scaleY:1,alpha:1},250).wait(500).to({scaleX:1.5,scaleY:1.5,alpha:0},250).call(function(){this.counter<=0?(this.flare("finish"),this.autopop&&this.app.popScene()):this._updateCount()},this)}})}(),tm.three=tm.three||{},function(){tm.global.THREE&&(tm.three.ThreeApp=tm.createClass({superClass:tm.app.BaseApp,canvas:null,background:null,_scenes:null,_sceneIndex:0,init:function(t){t instanceof HTMLCanvasElement?this.element=t:"string"==typeof t?this.element=document.querySelector(t):(this.element=document.createElement("canvas"),document.body.appendChild(this.element)),this.superInit(this.element),this.renderer=new THREE.WebGLRenderer({canvas:this.element,clearColor:2236962,clearAlpha:1}),this.renderer.setSize(this.element.width,this.element.height),this._scenes=[tm.three.Scene()]},resize:function(t,e){return this.width=t,this.height=e,this.renderer.setSize(this.width,this.height),this},resizeWindow:function(){return this.width=innerWidth,this.height=innerHeight,this.renderer.setSize(this.width,this.height),this},fitWindow:function(t){var e=function(){t=void 0===t?!0:t;var e=this.element,i=e.style;i.position="absolute",i.left="0px",i.top="0px";var n=e.width/window.innerWidth,s=e.height/window.innerHeight,r=e.height/e.width;n>s?(i.width=innerWidth+"px",i.height=innerWidth*r+"px"):(i.width=innerHeight/r+"px",i.height=innerHeight+"px")}.bind(this);e(),t&&window.addEventListener("resize",e,!1),this.mouse._mousemove=this.mouse._mousemoveScale,this.touch._touchmove=this.touch._touchmoveScale},_draw:function(){for(var t=0,e=this._scenes.length;e>t;++t)this.renderer.render(this.currentScene,this.currentScene.camera)}}),tm.three.ThreeApp.prototype.accessor("width",{get:function(){return this.element.width},set:function(t){this.element.width=t}}),tm.three.ThreeApp.prototype.accessor("height",{get:function(){return this.element.height},set:function(t){this.element.height=t}}))}(),function(){tm.global.THREE&&(tm.three.Element=tm.createClass({superClass:THREE.Object3D,init:function(){THREE.Object3D.call(this),tm.event.EventDispatcher.prototype.init.call(this)},update:function(){},_update:function(t){if(0!=this.awake){this.update(t);var e=tm.event.Event("enterframe");if(e.app=t,this.dispatchEvent(e),this.children.length>0)for(var i=this.children.slice(),n=0,s=i.length;s>n;++n){var r=i[n];r._update&&r._update(t)}}}}),tm.three.Element.prototype.$safe(tm.event.EventDispatcher.prototype))}(),function(){tm.global.THREE&&(tm.three.MeshElement=tm.createClass({superClass:THREE.Mesh,init:function(t,e){e=e||new THREE.MeshNormalMaterial,THREE.Mesh.call(this,t,e),tm.three.Element.prototype.init.call(this)}}),tm.three.MeshElement.prototype.$safe(tm.three.Element.prototype),tm.three.CubeElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e,i){t=t||100,e=e||100,i=i||100;var n=new THREE.CubeGeometry(t,e,i),s=new THREE.MeshNormalMaterial;this.superInit(n,s)}}),tm.three.SphereElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e,i){t=t||45,e=e||16,i=i||12;var n=new THREE.SphereGeometry(t,e,i),s=new THREE.MeshNormalMaterial;this.superInit(n,s)}}),tm.three.PlaneElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e){var i=new THREE.PlaneGeometry(t,e),n=new THREE.MeshNormalMaterial;this.superInit(i,n)}}),tm.three.FloorElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e){t=t||1e3,e=e||1e3;var i=new THREE.PlaneGeometry(t,e),n=new THREE.MeshBasicMaterial;this.superInit(i,n),this.rotation.x=-Math.PI/2,this._render()},_render:function(){var t=tm.graphics.Canvas();t.resize(128,128),t.clearColor("#444"),t.setFillStyle("white"),t.fillRect(0,0,64,64),t.fillRect(64,64,64,64);var e=new THREE.Texture(t.element);e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(10,10),e.needsUpdate=!0,this.material.map=e}}),tm.three.TextElement=tm.createClass({superClass:tm.three.MeshElement,init:function(t,e){var i=new THREE.TextGeometry(t,e),n=new THREE.MeshNormalMaterial;this.superInit(i,n)}}),tm.three.CanvasTexture=tm.createClass({superClass:THREE.Texture,canvas:null,init:function(){this.canvas=tm.graphics.Canvas(),THREE.Texture.call(this,this.canvas.element),this.needsUpdate=!0}}))}(),function(){tm.global.THREE&&(tm.three.Scene=tm.createClass({superClass:THREE.Scene,init:function(t,e){t=t||60,e=e||640/480,THREE.Scene.call(this),tm.three.Element.prototype.init.call(this),this.camera=new THREE.PerspectiveCamera(t,e,1,1e4),this.camera.position.y=100,this.camera.position.z=500,this.projector=new THREE.Projector},intersect:function(t){t=t||this.children;var e=this.app.pointing.x,i=this.app.pointing.y;e=e/this.app.width*2-1,i=2*-(i/this.app.height)+1;var n=new THREE.Vector3(e,i,.5);this.projector.unprojectVector(n,this.camera);var s=new THREE.Raycaster(this.camera.position,n.sub(this.camera.position).normalize());return s.intersectObjects(t)}}),tm.three.Scene.prototype.$safe(tm.three.Element.prototype))}(),tm.sound=tm.sound||{},function(){tm.sound.globalVolume=1}(),function(){if(tm.sound.Sound=tm.createClass({superClass:tm.event.EventDispatcher,element:null,loaded:!1,isPlay:!1,init:function(t){this.superInit(),this.element=new Audio,this.element.src=t,this.element.load(),this.element.setAttribute("preload","auto");var e=this;this.element.addEventListener("canplaythrough",function(){e.loaded=!0,e.fire(tm.event.Event("load"))}),this.element.addEventListener("ended",function(){e.isPlay=!1}),this.element.addEventListener("error",function(){console.warn(this.src+"の読み込みに失敗しました")}),this.element.volume=1,tm.isMobile&&(this.loaded=!0)},play:function(){return this.element.play(),this.isPlay=!0,this},stop:function(){return this.element.pause(),tm.isMobile||(this.element.currentTime=0),this.isPlay=!1,this},pause:function(){return this.element.pause(),this},clone:function(){return tm.sound.Sound(this.element.src)}}),tm.sound.Sound.prototype.accessor("volume",{get:function(){return this.element.volume},set:function(t){this.element.volume=t}}),void 0!==(new Audio).loop)tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(t){this.element.loop=t}});else{var t=function(){this.play()};tm.sound.Sound.prototype.accessor("loop",{get:function(){return this.element.loop},set:function(e){1!=this.element.loop&&1==e?this.element.addEventListener("ended",t,!1):1==this.element.loop&&0==e&&this.element.removeEventListener("ended",t,!1),this.element.loop=e}})}tm.sound.Sound.SUPPORT_EXT=function(){var t="",e=new Audio;return"maybe"==e.canPlayType("audio/wav")?t="wav":"maybe"==e.canPlayType("audio/mp3")?t="mp3":"maybe"==e.canPlayType("audio/ogg")&&(t="ogg"),t}()}(),tm.sound=tm.sound||{},function(){var t=null;tm.sound.WebAudio=tm.createClass({superClass:tm.event.EventDispatcher,loaded:!1,context:null,panner:null,volume:.8,playing:!1,_pannerEnabled:!0,init:function(e){this.superInit(),this.context=t;var i=typeof e;"string"===i?(this.loaded=!1,this._load(e)):"object"===i?(this._setup(),this.buffer=e,this.loaded=!0,this.dispatchEvent(tm.event.Event("load"))):(this._setup(),this.loaded=!1)},play:function(t){if(1!=this.playing){this.playing=!0,void 0===t&&(t=0),this.source.start(this.context.currentTime+t);var e=this,t=this.source.buffer.duration/this.source.playbackRate.value*1e3;return window.setTimeout(function(){var t=tm.event.Event("ended");e.fire(t)},t),this}},stop:function(t){if(0!=this.playing&&(this.playing=!1,void 0===t&&(t=0),0!=this.source.playbackState)){this.source.stop(this.context.currentTime+t);var e=this.buffer,i=this.volume,n=this.loop;return this.source=this.context.createBufferSource(),this.source.connect(this.gainNode),this.buffer=e,this.volume=i,this.loop=n,this}},pause:function(){return this.source.disconnect(),this},resume:function(){return this.source.connect(this.gainNode),this},clone:function(){var t=tm.sound.WebAudio(this.buffer);return t.volume=this.volume,t},setPosition:function(t,e,i){return this.panner.setPosition(t,e||0,i||0),this},setVelocity:function(t,e,i){return this.panner.setVelocity(t,e||0,i||0),this},setOrientation:function(t,e,i){return this.panner.setOrientation(t,e||0,i||0),this},setBuffer:function(t){return this.buffer=t,this},setLoop:function(t){return this.loop=t,this},setVolume:function(t){return this.volume=t,this},setPlaybackRate:function(t){return this.playbackRate=t,this},_load:function(e){if(!this.context)return void console.warn("本環境はWebAudio未対応です。("+e+")");var i=this;tm.util.Ajax.load({type:"GET",url:e,responseType:"arraybuffer",success:function(n){i.context.decodeAudioData(n,function(t){i._setup(),i.buffer=t,i.loaded=!0,i.dispatchEvent(tm.event.Event("load"))},function(){console.warn("音声ファイルのデコードに失敗しました。("+e+")"),i._setup(),i.buffer=t.createBuffer(1,1,22050),i.loaded=!0,i.dispatchEvent(tm.event.Event("load"))})}})},_setup:function(){this.source=this.context.createBufferSource(),this.gainNode=this.context.createGain(),this.analyser=this.context.createAnalyser(),this.source.connect(this.gainNode),this.gainNode.connect(this.analyser),this.analyser.connect(this.context.destination),"Firefox"===tm.BROWSER&&(this.pannerEnabled=!1)},tone:function(t,e){t=void 0!==t?t:200,e=void 0!==e?e:1;for(var i=1,n=44100,s=2,r=this.context.createBuffer(i,e*n,n),a=r.getChannelData(0),o=0;o<a.length;o++){var h=o/r.sampleRate,l=t*h*Math.PI;a[o]=Math.sin(l)*s}return this.buffer=r,this}}),tm.sound.WebAudio.prototype.accessor("buffer",{get:function(){
return this.source.buffer},set:function(t){this.source.buffer=t}}),tm.sound.WebAudio.prototype.accessor("loop",{get:function(){return this.source.loop},set:function(t){this.source.loop=t}}),tm.sound.WebAudio.prototype.accessor("volume",{get:function(){return this.gainNode.gain.value},set:function(t){this.gainNode.gain.value=t}}),tm.sound.WebAudio.prototype.accessor("playbackRate",{get:function(){return this.source.playbackRate.value},set:function(t){this.source.playbackRate.value=t}}),tm.sound.WebAudio.prototype.accessor("pannerEnabled",{get:function(){return this._pannerEnabled},set:function(t){this.gainNode.disconnect(),this.panner.disconnect(),t?(this.gainNode.connect(this.panner),this.panner.connect(this.analyser)):this.gainNode.connect(this.analyser),this._pannerEnabled=t}}),tm.sound.WebAudio.prototype.accessor("loopStart",{get:function(){return this.source.loopStart},set:function(t){this.source.loopStart=t}}),tm.sound.WebAudio.prototype.accessor("loopEnd",{get:function(){return this.source.loopEnd},set:function(t){this.source.loopEnd=t}}),tm.sound.WebAudio.isAvailable=tm.global.AudioContext||tm.global.webkitAudioContext||tm.global.mozAudioContext?!0:!1,tm.sound.WebAudio.createContext=function(){tm.global.AudioContext?t=new AudioContext:tm.global.webkitAudioContext?t=new webkitAudioContext:tm.global.mozAudioContext&&(t=new mozAudioContext),tm.sound.WebAudio.context=t},tm.sound.WebAudio.unlock=function(){var e=t.createBuffer(1,1,22050),i=t.createBufferSource();i.buffer=e,i.connect(t.destination),i.start(0)},tm.sound.WebAudio.createContext()}(),function(){tm.sound.SoundManager={volume:.8,musicVolume:.8,muteFlag:!1,currentMusic:null,play:function(t,e,i,n){var s=tm.asset.Manager.get(t);if(null==s)return void console.warn("not found "+t);var r=s.clone();return r.volume=this.getVolume(),r.play(),r},stop:function(){},pause:function(){},fade:function(){},setVolume:function(t){this.volume=t},getVolume:function(){return this.isMute()?0:this.volume},mute:function(){return this.muteFlag=this.muteFlag===!0?!1:!0,this.currentMusic&&(this.currentMusic.volume=this.getVolumeMusic()),this},isMute:function(){return this.muteFlag},playMusic:function(t,e,i){this.currentMusic&&this.stopMusic(e);var n=tm.asset.Manager.get(t);if(null==n)return void console.warn("not found "+t);var s=n.clone();if(s.setLoop(!0),s.volume=this.getVolumeMusic(),s.play(),e>0){var r=32,a=0,o=e/r,h=this.getVolumeMusic();s.volume=0;var l=setInterval(function(){a+=1;var t=a/r;return s.volume=t*h,t>=1?(clearInterval(l),!1):!0},o)}else s.volume=this.getVolumeMusic();return this.currentMusic=s,this.currentMusic},stopMusic:function(t){if(this.currentMusic){var e=this.currentMusic;if(t>0){var i=32,n=0,s=t/i,r=this.getVolumeMusic();e.volume=0;var a=setInterval(function(){n+=1;var t=n/i;return e.volume=r*(1-t),t>=1?(e.stop(),clearInterval(a),!1):!0},s)}else this.currentMusic.stop()}},pauseMusic:function(){this.currentMusic&&this.currentMusic.pause()},resumeMusic:function(){this.currentMusic&&this.currentMusic.resume()},setVolumeMusic:function(t){return this.musicVolume=t,this.currentMusic&&(this.currentMusic.volume=t),this},getVolumeMusic:function(t){return this.isMute()?0:this.musicVolume}}}(),tm.social=tm.social||{},function(){tm.social.Twitter=tm.social.Twitter||{},tm.social.Twitter.API_URL="http://api.twitter.com/1";var t="http://twitter.com/intent";tm.social.Twitter.createURL=function(e){var i=[];for(var n in e)if("type"!=n){var s=encodeURIComponent(e[n]),r=n+"="+s;i.push(r)}var a="{baseURL}/{type}?{param}".format({baseURL:t,type:e.type,param:i.join("&")});return a}}(),function(){var t="http://api.twitter.com/1/{type}/{kind}.json";tm.social.Twitter.api=function(e,i,n,s){var r=t.format({type:e,kind:i}),a=tm.util.QueryString.stringify(n);tm.util.Ajax.loadJSONP(r+"?"+a,s)}}(),function(){var t="http://search.twitter.com/search.json";tm.social.Twitter.search=function(e,i){var n=t,s=tm.util.QueryString.stringify(e);tm.util.Ajax.loadJSONP(n+"?"+s,i)}}(),function(){tm.social.Twitter.getFollowers=function(t,e){tm.social.Twitter.api("statuses","followers",t,e)}}(),tm.social=tm.social||{},function(){tm.social.Nineleap=tm.social.Nineleap||{};var t="http://9leap.net/games/{id}/result?score={score}&result={result}";tm.social.Nineleap.DEBUG_GAME_ID="0",tm.social.Nineleap.createURL=function(e,i,n){return t.format({id:e,score:i,result:n})},tm.social.Nineleap.postRanking=function(t,e){if("r.jsgames.jp"==location.hostname){var i=location.pathname.match(/^\/games\/(\d+)/)[1];location.replace(this.createURL(i,t,e))}else console.warn("9leap に投稿されていません!")},tm.social.Nineleap.gotoLogin=function(){window.location.replace("http://9leap.net/api/login")},tm.social.Nineleap.isOn9leap=function(){return"r.jsgames.jp"===window.location.hostname},tm.social.Nineleap.getGameId=function(){return tm.social.Nineleap.isOn9leap()?window.location.pathname.match(/^\/games\/(\d+)/)[1]:tm.social.Nineleap.DEBUG_GAME_ID},tm.social.Nineleap.getMyData=function(t){tm.util.Ajax.loadJSONP(tm.social.Nineleap.createMyDataURL(),t)},tm.social.Nineleap.postMyData=function(t,e){tm.util.Ajax.load({type:"POST",url:tm.social.Nineleap.createMemoryURL("user_memory.json"),dataType:"json",data:"json="+JSON.stringify(t),contentType:"application/x-www-form-urlencoded;charset=UTF-8",async:!1,beforeSend:function(t){t.withCredentials=!0},success:e,error:function(t){console.error(t)}})},tm.social.Nineleap.createMemoryURL=function(){for(var t=["http://9leap.net/api/memory/",tm.social.Nineleap.getGameId()+"/"],e=0,i=arguments.length;i>e;e++)t.push(arguments[e]);return t.join("")},tm.social.Nineleap.createMyDataURL=function(){return tm.social.Nineleap.createMemoryURL("user_memory.json")},tm.social.Nineleap.createUserDataURL=function(t){return tm.social.Nineleap.createMemoryURL("u/",t+".json")},tm.social.Nineleap.createRecentDataURL=function(t){return t=t||30,tm.social.Nineleap.createMemoryURL("recent_memories.json","?max="+t)},tm.social.Nineleap.createFriendDataURL=function(t){return t=t||30,tm.social.Nineleap.createMemoryURL("friends_memories.json","?max="+t)},tm.social.Nineleap.createRankingDataURL=function(t){return t=t||30,tm.social.Nineleap.createMemoryURL("ranking_memories.json","?max="+t)}}(),tm.google=tm.google||{},function(){tm.google.Chart=tm.google.Chart||{};var t="https://chart.googleapis.com/chart?chst={type}&chld={data}",e="https://chart.googleapis.com/chart?chs={size}&cht={type}&chl={text}&chco={color}";tm.google.Chart.createDynamicIcons=function(e,i){return t.format({type:e,data:i})},tm.google.Chart.createQRCode=function(t,i,n){return i=encodeURIComponent(i),e.format({type:"qr",size:t,text:i})},tm.google.Chart.createTeX=function(){}}(),function(){tm.app.Element.prototype.getter("interaction",function(){console.assert(!1,"interaction は Object2d に統合されました. obj.setInteractive(true); とすればタッチ判定が有効になります.")});var t={display:["Sprite","Shape","CircleShape","TriangleShape","RectangleShape","RoundRectangleShape","StarShape","PolygonShape","HeartShape","TextShape","CanvasRenderer","BoundingRectRenderer","Label","MapSprite","CanvasElement","CanvasApp","AnimationSprite","SpriteSheet"],ui:["LabelButton","IconButton","GlossyButton","FlatButton","LoadingScene"]};for(var e in t){var i=t[e];i.each(function(t){tm.app[t]=tm[e][t]})}tm.asset.AssetManager=tm.asset.Manager,tm.util.getter("Script",function(){console.warn("`tm.util.Script` は `tm.asset.Script` になりました!")}),tm.ui.LoadingScene=function(t){return console.warn("`tm.ui.LoadingScene` は `tm.game.LoadingScene` になりました!"),tm.game.LoadingScene(t)},tm.scene=tm.scene||{},tm.scene.ManagerScene=tm.game.ManagerScene,tm.scene.LoadingScene=tm.game.LoadingScene,tm.scene.TitleScene=tm.game.TitleScene,tm.scene.ResultScene=tm.game.ResultScene,tm.scene.NumericalInputScene=tm.game.NumericalInputScene,tm.getter("scene",function(){return console.warn("tm.scene は tm.game に変更されました"),tm.game})}();var bulletml={};bulletml.GLOBAL=this,function(){function t(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i].label==e)return t[i]}bulletml.Node=function(){},bulletml.Node.prototype.scan=function(t){t(this);for(var e in this)if(this.hasOwnProperty(e)){var i=this[e];i instanceof bulletml.Node&&i.scan(t)}},bulletml.Root=function(t){if(bulletml.Node.call(this),this.type="none",this.root=this,this.actions=[],this.bullets=[],this.fires=[],void 0!==t){for(var e in t)t.hasOwnProperty(e)&&(t[e].label=e,t[e]instanceof bulletml.Action?this.actions.push(t[e]):t[e]instanceof bulletml.Bullet?this.bullets.push(t[e]):t[e]instanceof bulletml.Fire&&this.fires.push(t[e]));for(var i=0,n=this.actions.length;n>i;i++)this.actions[i].setRoot(this);for(var i=0,n=this.bullets.length;n>i;i++)this.bullets[i].setRoot(this);for(var i=0,n=this.fires.length;n>i;i++)this.fires[i].setRoot(this)}},bulletml.Root.prototype=Object.create(bulletml.Node.prototype),bulletml.Root.prototype.findAction=function(e){return t(this.actions,e)},bulletml.Root.prototype.getTopActionLabels=function(){for(var t=[],e=0,i=this.actions.length;i>e;e++){var n=this.actions[e];n.label&&0===n.label.indexOf("top")&&(t[t.length]=n.label)}return t},bulletml.Root.prototype.findActionOrThrow=function(t){var e;if(e=this.findAction(t))return e;throw new Error("action labeled '"+t+"' is undefined.")},bulletml.Root.prototype.findBullet=function(e){return t(this.bullets,e)},bulletml.Root.prototype.findBulletOrThrow=function(t){var e;if(e=this.findBullet(t))return e;throw new Error("bullet labeled '"+t+"' is undefined.")},bulletml.Root.prototype.findFire=function(e){return t(this.fires,e)},bulletml.Root.prototype.findFireOrThrow=function(t){var e;if(e=this.findFire(t))return e;throw new Error("fire labeled '"+t+"' is undefined.")},bulletml.Bullet=function(){bulletml.Node.call(this),this.label=null,this.root=null,this.direction=new bulletml.Direction(0),this.speed=new bulletml.Speed(1),this.actions=[],this.option={},this._localScope={}},bulletml.Bullet.prototype=Object.create(bulletml.Node.prototype),bulletml.Bullet.prototype.clone=function(t){var e=new bulletml.Bullet;return e.label=this.label,e.root=this.root,e.actions=this.actions,e.direction=new bulletml.Direction(t._evalParam(this.direction.value)),e.direction.type=this.direction.type,e.speed=new bulletml.Speed(t._evalParam(this.speed.value)),e.speed.type=this.speed.type,e.option=this.option,e._localScope=t._localScope,e},bulletml.Bullet.prototype.setRoot=function(t){this.root=t;for(var e=0,i=this.actions.length;i>e;e++)this.actions[e].setRoot(t)},bulletml.BulletRef=function(t){bulletml.Node.call(this),this.root=null,this.label=t,this.params=[]},bulletml.BulletRef.prototype=Object.create(bulletml.Node.prototype),bulletml.BulletRef.prototype.clone=function(t){var e=t._localScope;t._localScope=t._newScope(this.params);var i=this.root.findBulletOrThrow(this.label).clone(t);return t._localScope=e,i},bulletml.BulletRef.prototype.setRoot=function(t){this.root=t},bulletml.Command=function(){bulletml.Node.call(this),this.commandName=""},bulletml.Command.prototype=Object.create(bulletml.Node.prototype),bulletml.Command.prototype.setRoot=function(t){this.root=t},bulletml.Action=function(){bulletml.Command.call(this),this.commandName="action",this.label=null,this.root=null,this.commands=[],this.params=[]},bulletml.Action.prototype=Object.create(bulletml.Command.prototype),bulletml.Action.prototype.setRoot=function(t){this.root=t;for(var e=0,i=this.commands.length;i>e;e++)this.commands[e].setRoot(t)},bulletml.Action.prototype.clone=function(){var t=new bulletml.Action;return t.label=this.label,t.root=this.root,t.commands=this.commands,t},bulletml.ActionRef=function(t){bulletml.Command.call(this),this.commandName="actionRef",this.label=t,this.root=null,this.params=[]},bulletml.ActionRef.prototype=Object.create(bulletml.Command.prototype),bulletml.ActionRef.prototype.clone=function(){var t=new bulletml.Action;return t.root=this.root,t.commands.push(this),t},bulletml.Fire=function(){bulletml.Command.call(this),this.commandName="fire",this.label=null,this.root=null,this.direction=null,this.speed=null,this.bullet=null,this.option=new bulletml.FireOption},bulletml.Fire.prototype=Object.create(bulletml.Command.prototype),bulletml.Fire.prototype.setRoot=function(t){this.root=t,this.bullet&&this.bullet.setRoot(t)},bulletml.FireRef=function(t){bulletml.Command.call(this),this.commandName="fireRef",this.label=t,this.params=[]},bulletml.FireRef.prototype=Object.create(bulletml.Command.prototype),bulletml.ChangeDirection=function(){bulletml.Command.call(this),this.commandName="changeDirection",this.direction=new bulletml.Direction,this.term=0},bulletml.ChangeDirection.prototype=Object.create(bulletml.Command.prototype),bulletml.ChangeSpeed=function(){bulletml.Command.call(this),this.commandName="changeSpeed",this.speed=new bulletml.Speed,this.term=0},bulletml.ChangeSpeed.prototype=Object.create(bulletml.Command.prototype),bulletml.Accel=function(){bulletml.Command.call(this),this.commandName="accel",this.horizontal=new bulletml.Horizontal,this.vertical=new bulletml.Vertical,this.term=0},bulletml.Accel.prototype=Object.create(bulletml.Command.prototype),bulletml.Wait=function(t){bulletml.Command.call(this),this.commandName="wait",this.value=t||0},bulletml.Wait.prototype=Object.create(bulletml.Command.prototype),bulletml.Vanish=function(){bulletml.Command.call(this),this.commandName="vanish"},bulletml.Vanish.prototype=Object.create(bulletml.Command.prototype),bulletml.Repeat=function(){bulletml.Command.call(this),this.commandName="repeat",this.times=0,this.action=null,this.params=[]},bulletml.Repeat.prototype=Object.create(bulletml.Command.prototype),bulletml.Repeat.prototype.setRoot=function(t){this.root=t,this.action&&this.action.setRoot(t)},bulletml.Bind=function(t,e){bulletml.Command.call(this),this.commandName="bind",this.variable=t,this.expression=e},bulletml.Bind.prototype=Object.create(bulletml.Command.prototype),bulletml.Notify=function(t,e){bulletml.Command.call(this),this.commandName="notify",this.eventName=t,this.params=e||null},bulletml.Notify.prototype=Object.create(bulletml.Command.prototype),bulletml.DummyCommand=new bulletml.Command,bulletml.Direction=function(t){bulletml.Node.call(this),this.type="aim",this.value=t||0},bulletml.Direction.prototype=Object.create(bulletml.Node.prototype),bulletml.Speed=function(t){bulletml.Node.call(this),this.type="absolute",this.value=void 0===t?1:t},bulletml.Speed.prototype=Object.create(bulletml.Node.prototype),bulletml.Horizontal=function(t){bulletml.Node.call(this),this.type="absolute",this.value=t||0},bulletml.Horizontal.prototype=Object.create(bulletml.Node.prototype),bulletml.Vertical=function(t){bulletml.Node.call(this),this.type="absolute",this.value=t||0},bulletml.Vertical.prototype=Object.create(bulletml.Node.prototype),bulletml.FireOption=function(t){bulletml.Node.call(this),t=t||{},this.offsetX=t.offsetX||0,this.offsetY=t.offsetY||0,this.autonomy=!0,void 0!==t.autonomy&&(this.autonomy=!!t.autonomy)},bulletml.FireOption.prototype=Object.create(bulletml.Node.prototype),bulletml.OffsetX=function(t){bulletml.Node.call(this),this.value=t||0},bulletml.OffsetX.prototype=Object.create(bulletml.Node.prototype),bulletml.OffsetY=function(t){bulletml.Node.call(this),this.value=t||0},bulletml.OffsetY.prototype=Object.create(bulletml.Node.prototype),bulletml.Autonomy=function(t){bulletml.Node.call(this),this.value=!!t},bulletml.Autonomy.prototype=Object.create(bulletml.Node.prototype)}(),function(){bulletml.Walker=function(t){this._root=t,this._stack=[],this._cursor=-1,this._action=null,this._localScope={}},bulletml.Walker.prototype.next=function(){if(this._cursor+=1,null!==this._action){var t=this._action.commands[this._cursor];if(void 0!==t){if(t instanceof bulletml.Action)return this._pushStack(),this._action=t,this._localScope=this._cloneScope(),this.next();if(t instanceof bulletml.ActionRef)return this._pushStack(),this._action=this._root.findActionOrThrow(t.label),this._localScope=this._newScope(t.params),this.next();if(t instanceof bulletml.Repeat)return this._localScope.loopCounter=0,this._localScope.loopEnd=0|this._evalParam(t.times),this._pushStack(),this._action=t.action.clone(),this._localScope=this._cloneScope(),this.next();if(t instanceof bulletml.Fire){var e=new bulletml.Fire;return e.bullet=t.bullet.clone(this),null!==t.direction&&(e.direction=new bulletml.Direction(this._evalParam(t.direction.value)),e.direction.type=t.direction.type),null!==t.speed&&(e.speed=new bulletml.Speed(this._evalParam(t.speed.value)),e.speed.type=t.speed.type),e.option=new bulletml.FireOption,e.option.offsetX=this._evalParam(t.option.offsetX),e.option.offsetY=this._evalParam(t.option.offsetY),e.option.autonomy=t.option.autonomy,e}if(t instanceof bulletml.FireRef)return this._pushStack(),this._action=new bulletml.Action,this._action.commands=[this._root.findFireOrThrow(t.label)],this._localScope=this._newScope(t.params),this.next();if(t instanceof bulletml.ChangeDirection){var i=new bulletml.ChangeDirection;return i.direction.type=t.direction.type,i.direction.value=this._evalParam(t.direction.value),i.term=this._evalParam(t.term),i}if(t instanceof bulletml.ChangeSpeed){var n=new bulletml.ChangeSpeed;return n.speed.type=t.speed.type,n.speed.value=this._evalParam(t.speed.value),n.term=this._evalParam(t.term),n}if(t instanceof bulletml.Accel){var s=new bulletml.Accel;return s.horizontal.type=t.horizontal.type,s.horizontal.value=this._evalParam(t.horizontal.value),s.vertical.type=t.vertical.type,s.vertical.value=this._evalParam(t.vertical.value),s.term=this._evalParam(t.term),s}return t instanceof bulletml.Wait?new bulletml.Wait(this._evalParam(t.value)):t instanceof bulletml.Vanish?t:t instanceof bulletml.Bind?(this._localScope["$"+t.variable]=this._evalParam(t.expression),bulletml.DummyCommand):t instanceof bulletml.Notify?t:null}return this._popStack(),null===this._action?null:(t=this._action.commands[this._cursor],t&&"repeat"==t.commandName?(this._localScope.loopCounter++,this._localScope.loopCounter<this._localScope.loopEnd?(this._pushStack(),this._action=t.action.clone(),this._localScope=this._cloneScope(),this.next()):this.next()):this.next())}return null},bulletml.Walker.prototype._pushStack=function(){this._stack.push({action:this._action,cursor:this._cursor,scope:this._localScope}),this._cursor=-1},bulletml.Walker.prototype._popStack=function(){var t=this._stack.pop();t?(this._cursor=t.cursor,this._action=t.action,this._localScope=t.scope):(this._cursor=-1,this._action=null,this._localScope={})},bulletml.Walker.prototype._evalParam=function(t){var e;if("boolean"==typeof t)return t?1:0;if("number"==typeof t)return t;if(!isNaN(e=Number(t)))return e;if(e=this._localScope[t])return e;if(e=bulletml.Walker.globalScope[t])return e;if("$rand"===t)return Math.random();var i={};for(var n in bulletml.Walker.globalScope)bulletml.Walker.globalScope.hasOwnProperty(n)&&(i[n]=bulletml.Walker.globalScope[n]);for(var n in this._localScope)this._localScope.hasOwnProperty(n)&&(i[n]=this._localScope[n]);i.$rand=Math.random();var s=this._stack[this._stack.length-1];s&&(i.$loop={index:s.scope.loopCounter,count:s.scope.loopCounter+1,first:0===s.scope.loopCounter,last:s.scope.loopCounter+1>=s.scope.loopEnd});var r=new Function("return "+t.split("$").join("this.$")),a=r.apply(i);return a},bulletml.Walker.prototype._newScope=function(t){var e={};if(t)for(var i=0,n=t.length;n>i;i++)e["$"+(i+1)]=this._evalParam(t[i]);else for(var s in this._localScope)this._localScope.hasOwnProperty(s)&&(e[s]=this._localScope[s]);return e},bulletml.Walker.prototype._cloneScope=function(){var t={};for(var e in this._localScope)this._localScope.hasOwnProperty(e)&&(t[e]=this._localScope[e]);return t},bulletml.Root.prototype.getWalker=function(t){var e=new bulletml.Walker(this),i=this.findAction(t);return i&&(e._action=i),e},bulletml.Bullet.prototype.getWalker=function(){var t=new bulletml.Walker(this.root),e=new bulletml.Action;return e.root=this.root,e.commands=this.actions,t._action=e,t._localScope=this._localScope,t},bulletml.Walker.globalScope={}}(),function(){function t(t){var i=new bulletml.Root,s=t.getElementsByTagName("bulletml")[0];if(s){x(s,"type",function(t){i.type=t});var a=s.getElementsByTagName("action");if(a)for(var o=0,h=a.length;h>o;o++)if(a[o].parentNode===s){var l=e(i,a[o]);l&&(i.actions[i.actions.length]=l)}var u=s.getElementsByTagName("bullet");if(u)for(var o=0,h=u.length;h>o;o++)if(u[o].parentNode===s){var c=n(i,u[o]);c&&(i.bullets[i.bullets.length]=c)}var m=s.getElementsByTagName("fire");if(m)for(var o=0,h=m.length;h>o;o++)if(m[o].parentNode===s){var p=r(i,m[o]);p&&(i.fires[i.fires.length]=p)}return i}}function e(t,n){var s=new bulletml.Action;return x(n,"label",function(t){s.label=t}),v(n,".",function(n){switch(n.tagName.toLowerCase()){case"action":s.commands[s.commands.length]=e(t,n);break;case"actionref":s.commands[s.commands.length]=i(t,n);break;case"fire":s.commands[s.commands.length]=r(t,n);break;case"fireref":s.commands[s.commands.length]=a(t,n);break;case"changedirection":s.commands[s.commands.length]=o(t,n);break;case"changespeed":s.commands[s.commands.length]=h(t,n);break;case"accel":s.commands[s.commands.length]=l(t,n);break;case"wait":s.commands[s.commands.length]=u(t,n);break;case"vanish":s.commands[s.commands.length]=c(t,n);break;case"repeat":s.commands[s.commands.length]=m(t,n)}}),s.root=t,s}function i(t,e){var i=new bulletml.ActionRef(x(e,"label"));return v(e,/param$/,function(t){i.params[i.params.length]=S(t)}),i.root=t,i}function n(t,n){var s=new bulletml.Bullet;return x(n,"label",function(t){s.label=t}),b(n,"direction",function(t){s.direction=p(t)}),b(n,"speed",function(t){s.speed=d(t)}),v(n,/(action)|(actionRef)$/,function(n){"action"==n.tagName.toLowerCase()?s.actions[s.actions.length]=e(t,n):"actionref"==n.tagName.toLowerCase()&&(s.actions[s.actions.length]=i(t,n))}),s.root=t,s}function s(t,e){var i=new bulletml.BulletRef(x(e,"label"));return v(e,/param$/,function(t){i.params[i.params.length]=S(t)}),i.root=t,i}function r(t,e){var i=new bulletml.Fire;if(x(e,"label",function(t){i.label=t}),b(e,"direction",function(t){i.direction=p(t)}),b(e,"speed",function(t){i.speed=d(t)}),b(e,"bullet",function(e){i.bullet=n(t,e)}),b(e,"bulletref",function(e){i.bullet=s(t,e)}),!i.bullet)throw new Error("fire has no bullet or bulletRef.");return i.root=t,i}function a(t,e){var i=new bulletml.FireRef(x(e,"label"));return v(e,/param$/,function(t){i.params[i.params.length]=S(t)}),i.root=t,i}function o(t,e){var i=new bulletml.ChangeDirection;return i.root=t,b(e,"direction",function(t){i.direction=p(t)}),b(e,"term",function(t){i.term=S(t)}),i}function h(t,e){var i=new bulletml.ChangeSpeed;return i.root=t,b(e,"speed",function(t){i.speed=d(t)}),b(e,"term",function(t){i.term=S(t)}),i}function l(t,e){var i=new bulletml.Accel;return i.root=t,b(e,"horizontal",function(t){i.horizontal=f(t)}),b(e,"vertical",function(t){i.vertical=g(t)}),b(e,"term",function(t){i.term=S(t)}),i}function u(t,e){var i=new bulletml.Wait;return i.root=t,i.value=S(e),i}function c(t,e){var i=new bulletml.Vanish;return i.root=t,i}function m(t,n){var s=new bulletml.Repeat;return b(n,"action",function(i){s.action=e(t,i)}),b(n,"actionRef",function(e){s.action=i(t,e)}),b(n,"times",function(t){s.times=S(t)}),s.root=t,s}function p(t){return y(new bulletml.Direction,t)}function d(t){return y(new bulletml.Speed,t)}function f(t){return y(new bulletml.Horizontal,t)}function g(t){return y(new bulletml.Vertical,t)}function y(t,e){return x(e,"type",function(e){t.type=e}),S(e,function(e){t.value=e}),t}function b(t,e,i,n){e=e.toLowerCase();for(var s=t.childNodes,r=0,a=s.length;a>r;r++)if(s[r].tagName&&s[r].tagName.toLowerCase()==e)return i&&i(s[r]),s[r];return n&&n(),null}function v(t,e,i){for(var n=t.childNodes,s=0,r=n.length;r>s;s++)n[s].tagName&&n[s].tagName.toLowerCase().match(e)&&i(n[s])}function x(t,e,i,n){var s=t.attributes,r=s[e];return r?(i&&i(r.value),r.value):(n&&n(),"")}function S(t,e){var i=t.textContent.trim();return void 0!==i?(e&&e(i),i):""}bulletml.buildXML=function(e){var i;if("string"==typeof e){var n=new DOMParser;i=t(n.parseFromString(e,"application/xml"))}else{if(!e.getElementsByTagName("bulletml"))throw new Error("cannot build "+e);i=t(e)}return i}}(),function(){bulletml.dsl=function(t){t=t||"";for(var e in bulletml.dsl)bulletml.dsl.hasOwnProperty(e)&&(bulletml.GLOBAL[t+e]=bulletml.dsl[e])},bulletml.dsl.action=function(t){if(arguments.length>0)for(var e=0,i=arguments.length;i>e;e++)arguments[e]instanceof Function&&(arguments[e]=arguments[e]());if(t instanceof Array)for(var e=0,i=t.length;i>e;e++)t[e]instanceof Function&&(t[e]=t[e]());var n=new bulletml.Action;if(t instanceof Array){if(t.some(function(t){return!(t instanceof bulletml.Command)}))throw new Error("argument type error.");n.commands=t}else for(var e=0,i=arguments.length;i>e;e++){if(!(arguments[e]instanceof bulletml.Command))throw new Error("argument type error.");n.commands[e]=arguments[e]}return n},bulletml.dsl.actionRef=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("label is required.");var s=new bulletml.ActionRef(t);if(e instanceof Array)s.params=e;else for(var i=1;i<arguments.length;i++)s.params.push(arguments[i]);return s},bulletml.dsl.bullet=function(t,e,i,n){for(var s=0,r=arguments.length;r>s;s++)arguments[s]instanceof Function&&(arguments[s]=arguments[s]());for(var a=new bulletml.Bullet,s=0;s<arguments.length;s++)arguments[s]instanceof bulletml.Direction?a.direction=arguments[s]:arguments[s]instanceof bulletml.Speed?a.speed=arguments[s]:arguments[s]instanceof bulletml.Action?a.actions.push(arguments[s]):arguments[s]instanceof bulletml.ActionRef?a.actions.push(arguments[s]):arguments[s]instanceof Array?a.actions.push(bulletml.dsl.action(arguments[s])):arguments[s]instanceof Object?a.option=arguments[s]:"string"==typeof arguments[s]&&(a.label=arguments[s]);return a},bulletml.dsl.bulletRef=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("label is required.");var s=new bulletml.BulletRef(t);if(e instanceof Array)s.params=e;else for(var i=1;i<arguments.length;i++)s.params.push(arguments[i]);return s},bulletml.dsl.fire=function(t,e,i,n){for(var s=0,r=arguments.length;r>s;s++)arguments[s]instanceof Function&&(arguments[s]=arguments[s]());for(var a=new bulletml.Fire,s=0;s<arguments.length;s++)arguments[s]instanceof bulletml.Direction?a.direction=arguments[s]:arguments[s]instanceof bulletml.Speed?a.speed=arguments[s]:arguments[s]instanceof bulletml.Bullet?a.bullet=arguments[s]:arguments[s]instanceof bulletml.BulletRef?a.bullet=arguments[s]:arguments[s]instanceof bulletml.FireOption?a.option=arguments[s]:arguments[s]instanceof bulletml.OffsetX?a.option.offsetX=arguments[s].value:arguments[s]instanceof bulletml.OffsetY?a.option.offsetY=arguments[s].value:arguments[s]instanceof bulletml.Autonomy&&(a.option.autonomy=arguments[s].value);if(void 0===a.bullet)throw new Error("bullet (or bulletRef) is required.");return a},bulletml.dsl.fireRef=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("label is required.");var s=new bulletml.FireRef(t);if(e instanceof Array)s.params=e;else for(var i=1;i<arguments.length;i++)s.params.push(arguments[i]);return s},bulletml.dsl.changeDirection=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("direction is required.");if(void 0===e)throw new Error("term is required.");var s=new bulletml.ChangeDirection;return t instanceof bulletml.Direction?s.direction=t:s.direction=new bulletml.Direction(t),s.term=e,s},bulletml.dsl.changeSpeed=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("speed is required.");if(void 0===e)throw new Error("term is required.");var s=new bulletml.ChangeSpeed;return t instanceof bulletml.Speed?s.speed=t:s.speed=new bulletml.Speed(t),s.term=e,s},bulletml.dsl.accel=function(t,e,i){for(var n=0,s=arguments.length;s>n;n++)arguments[n]instanceof Function&&(arguments[n]=arguments[n]());for(var r=new bulletml.Accel,n=0;n<arguments.length;n++)arguments[n]instanceof bulletml.Horizontal?r.horizontal=t:arguments[n]instanceof bulletml.Vertical?r.vertical=e:r.term=arguments[n];if(void 0===r.horizontal&&void 0===r.vertical)throw new Error("horizontal or vertical is required.");if(void 0===r.term)throw new Error("term is required.");return r},bulletml.dsl.wait=function(t){for(var e=0,i=arguments.length;i>e;e++)arguments[e]instanceof Function&&(arguments[e]=arguments[e]());if(void 0===t)throw new Error("value is required.");return new bulletml.Wait(t)},bulletml.dsl.vanish=function(){return new bulletml.Vanish},bulletml.dsl.repeat=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("times is required.");if(void 0===e)throw new Error("action is required.");var s=new bulletml.Repeat;if(s.times=t,e instanceof bulletml.Action||e instanceof bulletml.ActionRef)s.action=e;else if(e instanceof Array)s.action=bulletml.dsl.action(e);else{for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);s.action=bulletml.dsl.action(r)}return s},bulletml.dsl.bindVar=function(t,e){return new bulletml.Bind(t,e)},bulletml.dsl.notify=function(t,e){return new bulletml.Notify(t,e)},bulletml.dsl.direction=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Direction(t);return void 0!==e&&(s.type=e),s},bulletml.dsl.speed=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Speed(t);return e&&(s.type=e),s},bulletml.dsl.horizontal=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Horizontal(t);return e&&(s.type=e),s},bulletml.dsl.vertical=function(t,e){for(var i=0,n=arguments.length;n>i;i++)arguments[i]instanceof Function&&(arguments[i]=arguments[i]());if(void 0===t)throw new Error("value is required.");var s=new bulletml.Vertical(t);return e&&(s.type=e),s},bulletml.dsl.fireOption=function(t){return new bulletml.FireOption(t)},bulletml.dsl.offsetX=function(t){return new bulletml.OffsetX(t)},bulletml.dsl.offsetY=function(t){return new bulletml.OffsetY(t)},bulletml.dsl.autonomy=function(t){return new bulletml.Autonomy(t)}}(),function(){bulletml.json=bulletml.json||{}}(),function(){bulletml.runner=bulletml.runner||{},bulletml.runner.RunnerFactory=function(t){this.root=t},bulletml.runner.RunnerFactory.prototype.create=function(t){for(var e in bulletml.runner.DEFAULT_CONFIG)bulletml.runner.DEFAULT_CONFIG.hasOwnProperty(e)&&void 0===t[e]&&(t[e]=bulletml.runner.DEFAULT_CONFIG[e]);var i=this.root.getTopActionLabels();if(1===i.length)return new bulletml.runner.SubRunner(t,this.root.getWalker(i[0]));for(var n=new bulletml.runner.ParentRunner,s=0,r=i.length;r>s;s++)n.addSubRunner(new bulletml.runner.SubRunner(t,this.root.getWalker(i[s])));return n},bulletml.Root.prototype.createRunner=function(t,e){var i=new bulletml.runner.RunnerFactory(this).create(t);return e&&e(i),i},bulletml.runner.DEFAULT_CONFIG={rank:0,target:null,createNewBullet:function(t,e){}},bulletml.runner.Runner=function(){this.x=0,this.y=0},bulletml.runner.Runner.prototype={constructor:bulletml.runner.Runner,update:function(){},onVanish:function(){},onNotify:function(t,e){}},bulletml.runner.ParentRunner=function(){bulletml.runner.Runner.call(this),this.completed=!1,this.completedChildCount=0,this.subRunners=[]},bulletml.runner.ParentRunner.prototype=Object.create(bulletml.runner.Runner.prototype),
bulletml.runner.ParentRunner.prototype.addSubRunner=function(t){t.parentRunner=this,this.subRunners.push(t)},bulletml.runner.ParentRunner.prototype.update=function(){for(var t=this.subRunners.length;t--;)this.subRunners[t].x=this.x,this.subRunners[t].y=this.y,this.subRunners[t].update();this.completedChildCount===this.subRunners.length&&(this.completed=!0)},bulletml.runner.SimpleSubRunner=function(t){bulletml.runner.Runner.call(this),this.config=t,this.direction=0,this.speed=0,this.deltaX=null,this.deltaY=null},bulletml.runner.SimpleSubRunner.prototype=Object.create(bulletml.runner.Runner.prototype),bulletml.runner.SimpleSubRunner.prototype.update=function(){null===this.deltaX&&(this.deltaX=Math.cos(this.direction)*this.speed),null===this.deltaY&&(this.deltaY=Math.sin(this.direction)*this.speed),this.x+=this.deltaX,this.y+=this.deltaY},bulletml.runner.SubRunner=function(t,e){bulletml.runner.SimpleSubRunner.call(this,t),this.walker=e,this.waitTo=-1,this.lastDirection=0,this.lastSpeed=0,this.speedH=0,this.speedV=0,this.dirIncr=0,this.dirFin=0,this.chDirEnd=-1,this.spdIncr=0,this.spdFin=0,this.chSpdEnd=-1,this.aclIncrH=0,this.aclFinH=0,this.aclIncrV=0,this.aclFinV=0,this.aclEnd=-1,this.age=-1,this.stop=!1,this.parentRunner=null},bulletml.runner.SubRunner.prototype=Object.create(bulletml.runner.SimpleSubRunner.prototype),bulletml.runner.SubRunner.prototype.update=function(){if(!this.stop){this.age+=1;this.config;if(this.age<this.chDirEnd?this.direction+=this.dirIncr:this.age===this.chDirEnd&&(this.direction=this.dirFin),this.age<this.chSpdEnd?this.speed+=this.spdIncr:this.age===this.chSpdEnd&&(this.speed=this.spdFin),this.age<this.aclEnd?(this.speedH+=this.aclIncrH,this.speedV+=this.aclIncrV):this.age===this.aclEnd&&(this.speedH=this.aclFinH,this.speedV=this.aclFinV),this.x+=Math.cos(this.direction)*this.speed,this.y+=Math.sin(this.direction)*this.speed,this.x+=this.speedH,this.y+=this.speedV,!(this.age<this.waitTo||this.completed)){for(var t;t=this.walker.next();)switch(t.commandName){case"fire":this.fire(t);break;case"wait":return void(this.waitTo=this.age+t.value);case"changeDirection":this.changeDirection(t);break;case"changeSpeed":this.changeSpeed(t);break;case"accel":this.accel(t);break;case"vanish":this.onVanish();break;case"notify":this.notify(t)}this.completed=!0,null!==this.parentRunner&&(this.parentRunner.completedChildCount+=1)}}},bulletml.runner.SubRunner.prototype.fire=function(t){var i;i=0===t.bullet.actions.length?new bulletml.runner.SimpleSubRunner(this.config):new bulletml.runner.SubRunner(this.config,t.bullet.getWalker());var n={x:this.x+t.option.offsetX,y:this.y+t.option.offsetY},s=t.direction||t.bullet.direction,r=s.value*Math.PI/180;switch(s.type){case"aim":var a=this.config.target;a?(a instanceof Function&&(a=a()),t.option.autonomy?i.direction=e(n,a)+r:i.direction=e(this,a)+r):i.direction=r-Math.PI/2;break;case"absolute":i.direction=r-Math.PI/2;break;case"relative":i.direction=this.direction+r;break;case"sequence":default:i.direction=this.lastDirection+r}this.lastDirection=i.direction;var o=t.speed||t.bullet.speed,h=o.value;switch(o.type){case"relative":i.speed=this.speed+h;break;case"sequence":i.speed=this.lastSpeed+h;break;case"absolute":default:i.speed=h}this.lastSpeed=i.speed,i.x=n.x,i.y=n.y;var l={};for(var u in t.bullet.option)l[u]=t.bullet.option[u];l.label=t.bullet.label,this.config.createNewBullet(i,l)},bulletml.runner.SubRunner.prototype.changeDirection=function(i){var n=i.direction.value*Math.PI/180,s=i.term;switch(i.direction.type){case"aim":var r=this.config.target;r instanceof Function&&(r=r()),this.dirFin=e(this,r)+n,this.dirIncr=t(this.dirFin-this.direction)/s;break;case"absolute":this.dirFin=n-Math.PI/2,this.dirIncr=t(this.dirFin-this.direction)/s;break;case"relative":this.dirFin=this.direction+n,this.dirIncr=t(this.dirFin-this.direction)/s;break;case"sequence":this.dirIncr=n,this.dirFin=this.direction+this.dirIncr*(s-1)}this.chDirEnd=this.age+s},bulletml.runner.SubRunner.prototype.changeSpeed=function(t){var e=t.speed.value,i=t.term;switch(t.speed.type){case"absolute":this.spdFin=e,this.spdIncr=(this.spdFin-this.speed)/i;break;case"relative":this.spdFin=e+this.speed,this.spdIncr=(this.spdFin-this.speed)/i;break;case"sequence":this.spdIncr=e,this.spdFin=this.speed+this.spdIncr*i}this.chSpdEnd=this.age+i},bulletml.runner.SubRunner.prototype.accel=function(t){var e=t.term;if(this.aclEnd=this.age+e,t.horizontal){var i=t.horizontal.value;switch(t.horizontal.type){case"absolute":case"sequence":this.aclIncrH=(i-this.speedH)/e,this.aclFinH=i;break;case"relative":this.aclIncrH=i,this.aclFinH=(i-this.speedH)*e}}else this.aclIncrH=0,this.aclFinH=this.speedH;if(t.vertical){var n=t.vertical.value;switch(t.vertical.type){case"absolute":case"sequence":this.aclIncrV=(n-this.speedV)/e,this.aclFinV=n;break;case"relative":this.aclIncrV=n,this.aclFinV=(n-this.speedV)*e}}else this.aclIncrV=0,this.aclFinV=this.speedV},bulletml.runner.SubRunner.prototype.notify=function(t){this.onNotify(t.eventName,t.params)};var t=function(t){for(;t<=-Math.PI;)t+=2*Math.PI;for(;Math.PI<t;)t-=2*Math.PI;return t},e=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}}(),function(){bulletml.output=bulletml.output||{},bulletml.output.json=bulletml.output.json||{},bulletml.Root.prototype.toJSON=function(){return{className:"Root",actions:this.actions,bullets:this.bullets,fires:this.fires}},bulletml.Bullet.prototype.toJSON=function(){return{className:"Bullet",label:this.label,direction:this.direction,speed:this.speed,actions:this.actions,option:this.options}},bulletml.BulletRef.prototype.toJSON=function(){return{className:"BulletRef",label:this.label,params:this.params}},bulletml.Action.prototype.toJSON=function(){return{className:"Action",label:this.label,commands:this.commands}},bulletml.ActionRef.prototype.toJSON=function(){return{className:"ActionRef",label:this.label,params:this.params}},bulletml.Fire.prototype.toJSON=function(){return{className:"Fire",label:this.label,direction:this.direction,speed:this.speed,bullet:this.bullet,option:this.option}},bulletml.FireRef.prototype.toJSON=function(){return{className:"FireRef",label:this.label,params:this.params}},bulletml.ChangeDirection.prototype.toJSON=function(){return{className:"ChangeDirection",direction:this.direction,term:this.term}},bulletml.ChangeSpeed.prototype.toJSON=function(){return{className:"ChangeSpeed",speed:this.speed,term:this.term}},bulletml.Accel.prototype.toJSON=function(){return{className:"Accel",horizontal:this.horizontal,vertical:this.vertical,term:this.term}},bulletml.Wait.prototype.toJSON=function(){return{className:"Wait",value:this.value}},bulletml.Vanish.prototype.toJSON=function(){return{className:"Vanish"}},bulletml.Repeat.prototype.toJSON=function(){return{className:"Repeat",times:this.times,action:this.action}},bulletml.Bind.prototype.toJSON=function(){return{className:"Bind",variable:this.variable,expression:this.expression}},bulletml.Notify.prototype.toJSON=function(){return{className:"Notify",eventName:this.eventName,params:this.params}},bulletml.Direction.prototype.toJSON=function(){return{className:"Direction",type:this.type,value:this.value}},bulletml.Speed.prototype.toJSON=function(){return{className:"Speed",type:this.type,value:this.value}},bulletml.Horizontal.prototype.toJSON=function(){return{className:"Horizontal",type:this.type,value:this.value}},bulletml.Vertical.prototype.toJSON=function(){return{className:"Vertical",type:this.type,value:this.value}},bulletml.FireOption.prototype.toJSON=function(){return{className:"FireOption",offsetX:this.offsetX,offsetY:this.offsetY,autonomy:this.autonomy}},bulletml.OffsetX.prototype.toJSON=function(){return{className:"OffsetX",value:this.value}},bulletml.OffsetY.prototype.toJSON=function(){return{className:"OffsetY",value:this.value}},bulletml.Autonomy.prototype.toJSON=function(){return{className:"Autonomy",value:this.value}}}(),tm.bulletml=tm.bulletml||{},function(){tm.define("tm.bulletml.Bullet",{superClass:"tm.display.CanvasElement",init:function(t){this.superInit(),this.runner=t,this.setPosition(this.runner.x,this.runner.y),this.runner.onVanish=function(){bullet.remove()},this.on("enterframe",function(){this.runner.update(),this.setPosition(this.runner.x,this.runner.y)}.bind(this))}}),tm.app.Object2D.prototype.startDanmaku=function(t,e){e=(e||{}).$safe(bulletml.runner.DEFAULT_CONFIG);var i=t.createRunner(e);i.x=this.x,i.y=this.y;var n=function(){i.x=this.x,i.y=this.y,i.update(),this.setPosition(i.x,i.y)};n.isDanmaku=!0,this.on("enterframe",n)},tm.app.Object2D.prototype.stopDanmaku=function(){if(this.hasEventListener("enterframe"))for(var t=this._listeners.enterframe.clone(),e=0;e<t.length;e++)t[e].isDanmaku&&this.off("enterframe",t[e])}}(),tm.display.Sprite.prototype.setFrameTrimming=function(t,e,i,n){return this.frameTrimX=t||0,this.frameTrimY=e||0,this.frameTrimW=i||this.image.width-this.frameTrimX,this.frameTrimH=n||this.image.height-this.frameTrimY,this},tm.display.Sprite.prototype.setFrameIndex=function(t,e,i){var n=this.frameTrimX||0,s=this.frameTrimY||0,r=this.frameTrimW||this.image.width-n,a=this.frameTrimH||this.image.height-s,o=e||this.width,h=i||this.height,l=~~(r/o),u=~~(a/h),c=l*u;t%=c;var m=t%l,p=~~(t/l);return this.srcRect.x=n+m*o,this.srcRect.y=s+p*h,this.srcRect.width=o,this.srcRect.height=h,this._frameIndex=t,this},tm.display.AnimationSprite.prototype.currentAnimationName="",tm.display.AnimationSprite.prototype.gotoAndPlay=function(t){return t=void 0!==t?t:"default",this.currentAnimationName=t,this.paused=!1,this.currentAnimation=this.ss.animations[t],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},tm.display.AnimationSprite.prototype.gotoAndStop=function(t){return t=void 0!==t?t:"default",this.currentAnimationName=t,this.paused=!0,this.currentAnimation=this.ss.animations[t],this.currentFrame=0,this.currentFrameIndex=0,this._normalizeFrame(),this},tm.display.AnimationSprite.prototype._normalizeFrame=function(){var t=this.currentAnimation;if(t)if(this.currentFrameIndex<t.frames.length)this.currentFrame=t.frames[this.currentFrameIndex];else{var e=tm.event.Event("animationend");e.animationName=this.currentAnimationName,this.dispatchEvent(e),t.next?this.gotoAndPlay(t.next):(this.currentFrameIndex=t.frames.length-1,this.currentFrame=t.frames[this.currentFrameIndex],this.paused=!0)}},tm.asset.SpriteSheet.prototype._calcFrames=function(t){var e=this.frames=[],i=t.trimX||0,n=t.trimY||0,s=t.trimW||this.image.width-i,r=t.trimH||this.image.height-n,a=t.width,o=t.height,h=~~(s/a),l=~~(r/o);t.count||(t.count=h*l);for(var u=0,c=t.count;c>u;++u){var m=u%h,p=u/h|0,d={x:i+m*a,y:n+p*o,width:a,height:o};e.push(d)}},tm.display.Label.setParam=function(t){return this.fontFamily=t.fontFamily||this.fontFamily,this.align=t.align||this.align,this.baseline=t.baseline||this.baseline,this.fontSize=t.fontSize||this.fontSize,this.fontWeight=t.fontWeight||this.fontWeight,this.fillStyle=t.fillStyle||this.fillStyle,this},tm.display=tm.display||{},function(){tm.display.OutlineLabel=tm.createClass({superClass:tm.display.CanvasElement,labels:null,_outlineWidth:1,init:function(t,e){this.superInit(),this.outlineColor="black",this.labels=[];for(var i=0,n=-1;2>n;n++)for(var s=-1;2>s;s++)this.labels[i]=tm.display.Label(t,e),this.labels[i].setPosition(n*this.outlineWidth,s*this.outlineWidth),0==n&&0==s?this.labels[i].fillStyle="white":(this.labels[i].fillStyle="black",this.labels[i].addChildTo(this)),i++;this.labels[4].addChildTo(this)},setAlign:function(t){return this.align=t,this},setBaseline:function(t){return this.baseline=t,this},setFontSize:function(t){return this.fontSize=t,this},setFontFamily:function(t){return this.fontFamily=t,this},setFontWeight:function(t){return this.fontWeight=t,this},setBlendMode:function(t){return this.blendMode=t,this},setFillStyle:function(t){return this.fillStyle=t,this},setFillStyleOutline:function(t){return this.fillStyleOutline=t,this},setOutlineWidth:function(t){return this.outlineWidth=t,this},setParam:function(t){return this.fontFamily=t.fontFamily||this.fontFamily,this.align=t.align||this.align,this.baseline=t.baseline||this.baseline,this.fontSize=t.fontSize||this.fontSize,this.fontWeight=t.fontWeight||this.fontWeight,this.fillStyle=t.fillStyle||this.fillStyle,this.fillStyleOutline=t.fillStyleOutline||this.fillStyleOutline,this.outlineWidth=t.outlineWidth||this.outlineWidth,this}}),tm.display.OutlineLabel.prototype.accessor("text",{get:function(){return this.labels[0].text},set:function(t){if(null==t||void 0==t)for(var e=0;9>e;e++)this.labels[e].text="";else for(var e=0;9>e;e++)this.labels[e].text=t}}),tm.display.OutlineLabel.prototype.accessor("fontSize",{get:function(){return this.labels[0].fontSize},set:function(t){for(var e=0;9>e;e++)this.labels[e].fontSize=t}}),tm.display.OutlineLabel.prototype.accessor("fontFamily",{get:function(){return this.labels[0].fontFamily},set:function(t){for(var e=0;9>e;e++)this.labels[e].fontFamily=t}}),tm.display.OutlineLabel.prototype.accessor("fontWeight",{get:function(){return this.labels[0].fontWeight},set:function(t){for(var e=0;9>e;e++)this.labels[e].fontWeight=t}}),tm.display.OutlineLabel.prototype.accessor("lineHeight",{get:function(){return this.labels[0].lineHeight},set:function(t){for(var e=0;9>e;e++)this.labels[e].lineHeight=t}}),tm.display.OutlineLabel.prototype.accessor("fillStyle",{get:function(){return this.labels[4].fillStyle},set:function(t){this.labels[4].fillStyle=t}}),tm.display.OutlineLabel.prototype.accessor("fillStyleOutline",{get:function(){return this.labels[0].fillStyle},set:function(t){for(var e=0;9>e;e++)4!=e&&(this.labels[e].fillStyle=t)}}),tm.display.OutlineLabel.prototype.accessor("align",{get:function(){return this.labels[0].align},set:function(t){for(var e=0;9>e;e++)this.labels[e].align=t}}),tm.display.OutlineLabel.prototype.accessor("baseline",{get:function(){return this.labels[0].baseline},set:function(t){for(var e=0;9>e;e++)this.labels[e].baseline=t}}),tm.display.OutlineLabel.prototype.accessor("blendMode",{get:function(){return this.labels[4].blendMode},set:function(t){for(var e=0;9>e;e++)this.labels[e].blendMode=t}}),tm.display.OutlineLabel.prototype.accessor("alpha",{get:function(){return this.labels[4].alpha},set:function(t){for(var e=0;9>e;e++)this.labels[e].alpha=t}}),tm.display.OutlineLabel.prototype.accessor("visible",{get:function(){return this.labels[0].visible},set:function(t){for(var e=0;9>e;e++)this.labels[e].visible=t}}),tm.display.OutlineLabel.prototype.accessor("outlineWidth",{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth=t;for(var e=0,i=-1;2>i;i++)for(var n=-1;2>n;n++)this.labels[e].setPosition(i*this._outlineWidth,n*this._outlineWidth),e++}}),tm.display.OutlineLabel.prototype.accessor("shadowBlur",{get:function(){return this.labels[4].shadowBlur},set:function(t){for(var e=0;9>e;e++)this.labels[e].shadowBlur=t}}),tm.display.OutlineLabel.prototype.accessor("shadowColor",{get:function(){return this.labels[4].shadowColor},set:function(t){for(var e=0;9>e;e++)this.labels[e].shadowColor=t}}),tm.display.Label.prototype.setParam=function(t){return this.fontFamily=t.fontFamily||this.fontFamily,this.align=t.align||this.align,this.baseline=t.baseline||this.baseline,this.fontSize=t.fontSize||this.fontSize,this.fontWeight=t.fontWeight||this.fontWeight,this.fillStyle=t.fillStyle||this.fillStyle,this}}(),tm.extension=tm.extension||{},tm.define("tm.extension.SoundSet",{elements:null,bgm:null,bgmIsPlay:!1,volumeBGM:5,volumeSE:5,init:function(){this.elements=[]},readAsset:function(){for(var t in tm.asset.Manager.assets){var e=tm.asset.Manager.get(t);e instanceof tm.sound.WebAudio&&this.add(t)}},add:function(t,e){if(void 0===t)return null;e=e||null;var i=tm.Extension.SoundElement(t);return i.media?(this.elements.push(i),!0):!1},find:function(t){for(var e=0;e<this.elements.length;e++)if(this.elements[e].name==t)return this.elements[e];return null},playBGM:function(t){this.bgm&&(this.bgm.stop(),this.bgmIsPlay=!1);var e=this.find(t);return e?(e.play(!0),e.setVolume(this.volumeBGM),this.bgm=e,this.bgmIsPlay=!0):this.add(t)&&this.playBGM(t),this},stopBGM:function(){return this.bgm&&(this.bgmIsPlay&&(this.bgm.stop(),this.bgmIsPlay=!1),this.bgm=null),this},pauseBGM:function(){return this.bgm&&this.bgmIsPlay&&(this.bgm.pause(),this.bgmIsPlay=!1),this},resumeBGM:function(){return this.bgm&&(this.bgmIsPlay||(this.bgm.volume=this.volumeBGM,this.bgm.resume(),this.bgmIsPlay=!0)),this},setVolumeBGM:function(t){return this.volumeBGM=t,this.bgm&&(this.bgm.pause(),this.bgm.setVolume(this.volumeBGM),this.bgm.resume()),this},playSE:function(t){var e=this.find(t);return e?(e.setVolume(this.volumeSE),e.playClone()):this.add(t)&&this.playSE(t),this},setVolumeSE:function(t){return this.volumeSE=t,this}}),tm.define("tm.Extension.SoundElement",{name:null,url:null,media:null,volume:10,status:null,message:null,init:function(t){this.name=t,this.media=tm.asset.AssetManager.get(t),this.media||console.warn("asset not found. "+t)},play:function(t){return this.media?(this.media.loop=t,this.media.play(),this):this},playClone:function(){return this.media?(this.media.loop=!1,this.media.clone().play(),this):this},resume:function(){return this.media?(this.media.resume(),this):this},pause:function(){return this.media?void this.media.pause():this},stop:function(){return this.media?(this.media.stop(),this):this},setVolume:function(t){return this.media?(void 0===t&&(t=1),this.volume=t,this.media.volume=.1*this.volume,this):this}}),tm.define("tm.input.TouchesEx",{touchID:0,touchList:null,single:!1,scene:null,init:function(t){this.scene=t,this.touchList=[];var e=this;t.addEventListener("touchstart",function(t){e.single?(e.touchList[0]={id:0,pointing:t.pointing,time:0},t.ID=0,this.ontouchesstart(t)):(e.touchList.push({id:e.touchID,pointing:t.pointing,time:0}),t.ID=e.touchID,this.ontouchesstart(t),e.touchID++)}),t.addEventListener("touchmove",function(t){if(e.single)e.touchList[0]={id:0,pointing:t.pointing},t.ID=0,this.ontouchesmove(t);else{for(var i=99999999,n=9999,s=0,r=e.touchList.length;r>s;s++){var a=t.pointing.x-e.touchList[s].pointing.x,o=t.pointing.y-e.touchList[s].pointing.y,h=a*a+o*o;i>h&&(n=s,i=h)}e.touchList[n].pointing=t.pointing,t.ID=e.touchList[n].id,this.ontouchesmove(t)}}),t.addEventListener("touchend",function(t){if(e.single)t.ID=0,this.ontouchesend(t),e.touchList=[];else{for(var i=99999999,n=9999,s=0,r=e.touchList.length;r>s;s++){var a=t.pointing.x-e.touchList[s].pointing.x,o=t.pointing.y-e.touchList[s].pointing.y,h=a*a+o*o;i>h&&(n=s,i=h)}e.touchList[n].pointing=t.pointing,t.ID=e.touchList[n].id,this.ontouchesend(t),e.touchList.splice(n,1),0==e.touchList.length&&(e.touchID=0)}})},numTouches:function(){return this.touchList.length},reset:function(){this.touchID=0,this.touchList=[]}}),MersenneTwister._mulUint32=function(t,e){var i=t>>>16,n=65535&t,s=e>>>16,r=65535&e;return(i*r+n*s<<16)+n*r>>>0},MersenneTwister._toNumber=function(t){return"number"!=typeof t||isNaN(t)?0:Math.ceil(t)},MersenneTwister.prototype.setSeed=function(t){var e=this._mt;if("number"==typeof t){e[0]=t>>>0;for(var i=1;i<e.length;i++){var n=e[i-1]^e[i-1]>>>30;e[i]=MersenneTwister._mulUint32(1812433253,n)+i}this._index=e.length}else{if(!(t instanceof Array))throw new TypeError("MersenneTwister: illegal seed.");var i=1,s=0;this.setSeed(19650218);for(var r=Math.max(e.length,t.length);r>0;r--){var n=e[i-1]^e[i-1]>>>30;n=MersenneTwister._mulUint32(n,1664525),e[i]=(e[i]^n)+(t[s]>>>0)+s,++i>=e.length&&(e[0]=e[e.length-1],i=1),++s>=t.length&&(s=0)}for(var r=e.length-1;r>0;r--){var n=e[i-1]^e[i-1]>>>30;n=MersenneTwister._mulUint32(n,1566083941),e[i]=(e[i]^n)-i,++i>=e.length&&(e[0]=e[e.length-1],i=1)}e[0]=2147483648}},MersenneTwister.prototype._nextInt=function(){var t,e=this._mt;if(this._index>=e.length){var i=0,n=e.length,s=397;do t=2147483648&e[i]|2147483647&e[i+1],e[i]=e[i+s]^t>>>1^(1&t?2567483615:0);while(++i<n-s);do t=2147483648&e[i]|2147483647&e[i+1],e[i]=e[i+s-n]^t>>>1^(1&t?2567483615:0);while(++i<n-1);t=2147483648&e[n-1]|2147483647&e[0],e[n-1]=e[s-1]^t>>>1^(1&t?2567483615:0),this._index=0}return t=e[this._index++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0},MersenneTwister.prototype.nextInt=function(){var t,e;switch(arguments.length){case 0:return this._nextInt();case 1:t=0,e=MersenneTwister._toNumber(arguments[0]);break;default:t=MersenneTwister._toNumber(arguments[0]),e=MersenneTwister._toNumber(arguments[1])-t}if(!(e>0&&4294967296>e))return this._nextInt()+t;if((e&~e+1)==e)return(e-1&this._nextInt())+t;var i;do i=this._nextInt();while(e>4294967296-(i-(i%=e)));return i+t},MersenneTwister.prototype.next=function(){var t=this._nextInt()>>>5,e=this._nextInt()>>>6;return(67108864*t+e)/9007199254740992};var mt=new MersenneTwister(0),fontLoadEnd=!1;DEBUG=!0,MUTEKI=!1,VIEW_COLLISION=!1,SC_W=480,SC_H=480,GS_W=320,GS_H=480,GS_OFFSET=80,DIFF_EASY=0,DIFF_NORMAL=1,DIFF_HARD=2,DIFF_HELL=3,LAYER_SYSTEM=10,LAYER_FOREGROUND=9,LAYER_EFFECT_UPPER=8,LAYER_PLAYER=8,LAYER_OBJECT_UPPER=6,LAYER_BULLET=5,LAYER_SHOT=4,LAYER_OBJECT=3,LAYER_OBJECT_LOWER=2,LAYER_EFFECT_LOWER=1,LAYER_BACKGROUND=0,ENEMY_SMALL=0,ENEMY_MIDDLE=1,ENEMY_LARGE=2,ENEMY_MBOSS=3,ENEMY_BOSS=4,ENEMY_ITEM=9,EXPLODE_SMALL=0,EXPLODE_MIDDLE=1,EXPLODE_LARGE=2,EXPLODE_GROUND=3,EXPLODE_MBOSS=4,EXPLODE_BOSS=5;var toRad=3.14159/180,toDeg=180/3.14159,sec=function(t){return~~(60*t)},rand=function(t,e){return mt.nextInt(t,e)},distance=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},distanceSq=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n};app={},tm.main(function(){app=pb3.PlanetBuster3("#world"),app.run()}),function(){pb3={core:null},pb3.PlanetBuster3=tm.createClass({superClass:tm.app.CanvasApp,score:0,highScore:0,highScoreStage:0,difficulty:0,highScore:0,score:0,extendNumber:0,extendScore:null,bgm:null,bgmIsPlay:!1,volumeBGM:1,volumeSE:1,init:function(t){this.superInit(t),this.extendScore=[],this.extendScore.push(1e5),this.extendScore.push(2e5),this.extendScore.push(3e5),pb3.core=this,this.resize(SC_W,SC_H).fitWindow(),this.fps=60,this.background="rgba(0, 0, 0, 1.0)",this.keyboard=tm.input.Keyboard(window),this.sounds=tm.extension.SoundSet();var e=pb3.LoadingScene({assets:pb3.assets.main,width:SC_W,height:SC_H,bgColor:"rgba(0, 0, 0, 1)",nextScene:function(){return this._onLoadAssets(),pb3.TitleScene()}.bind(this)});this.replaceScene(e)},exitApp:function(){this.stop(),tm.social.Nineleap.postRanking(this.highScore,"")},_onLoadAssets:function(){this.sounds.readAsset(),["tex1","tex2","boss1"].forEach(function(t){var e=tm.asset.AssetManager.get(t),i=tm.graphics.Canvas();i.resize(e.width,e.height),i.drawTexture(e,0,0);var n=i.getBitmap();n.filter({calc:function(t,e,i,n,s){s.setPixelIndex(e,t[0],0,0)}});var s=tm.graphics.Canvas();s.resize(e.width,e.height),s.drawBitmap(n,0,0),tm.asset.AssetManager.set(t+"Red",s);var i=tm.graphics.Canvas();i.resize(e.width,e.height),i.drawTexture(e,0,0);var n=i.getBitmap();n.filter({calc:function(t,e,i,n,s){var r=0==t[0]?0:128,a=0==t[1]?0:128,o=0==t[2]?0:128;s.setPixelIndex(e,r,a,o)}});var s=tm.graphics.Canvas();s.resize(e.width,e.height),s.drawBitmap(n,0,0),tm.asset.AssetManager.set(t+"White",s);var i=tm.graphics.Canvas();i.resize(e.width,e.height),i.drawTexture(e,0,0);var n=i.getBitmap();n.filter({calc:function(t,e,i,n,s){s.setPixelIndex(e,0,0,t[2])}});var s=tm.graphics.Canvas();s.resize(e.width,e.height),s.drawBitmap(n,0,0),tm.asset.AssetManager.set(t+"Blue",s)})},playBGM:function(t){return this.sounds.playBGM(t),this},stopBGM:function(){return this.sounds.stopBGM(),this},pauseBGM:function(){return this.sounds.pauseBGM(),this},resumeBGM:function(){return this.sounds.resumeBGM(),this},playSE:function(t){return this.sounds.playSE(t),this},setVolumeBGM:function(t){return this.sounds.setVolumeBGM(t),this},setVolumeSE:function(t){return this.sounds.setVolumeSE(t),this}}),pb3.PlanetBuster3.prototype.accessor("volumeBGM",{get:function(){return this.sounds.volumeBGM},set:function(t){this.setVolumeBGM(t)}}),pb3.PlanetBuster3.prototype.accessor("volumeSE",{get:function(){return this.sounds.volumeSE},set:function(t){this.setVolumeSE(t)}})}(),function(){pb3.assets=pb3.assets||[],pb3.assets.main={bit:"assets/images/bit1.png",gunship:"assets/images/gunship1.png",shot1:"assets/images/shot1.png",shot2:"assets/images/shot2.png",tex1:"assets/images/tex1.png",tex2:"assets/images/tex2.png",boss1:"assets/images/tex_boss1.png",bullet1:"assets/images/bullet1.png",bullet2:"assets/images/bullet2.png",effect:"assets/images/effect.png",cloud:"assets/images/cloud.png",powerup:"assets/sounds/ta_ta_suraido01.mp3",explodeSmall:"assets/sounds/sen_ge_taihou03.mp3",explodeLarge:"assets/sounds/sen_ge_hasai01.mp3",explodePlayer:"assets/sounds/ta_ta_zuban_d01.mp3",warning:"assets/sounds/bgm_warning.mp3",Orbitron:"font/Orbitron-Regular.ttf","Ubuntu Mono":"font/UbuntuMono-Bold.ttf"},pb3.assets.stage1={stage1:"assets/sounds/expsy.mp3",map1:"assets/maps/map1.tmx",map1g:"assets/maps/map1.png"}}(),function(){tm.define("pb3.Ground",{superClass:"tm.display.CanvasElement",layer:LAYER_BACKGROUND,parentScene:null,belt:!1,direction:0,speed:1,init:function(){this.superInit(),this.mapBase=tm.app.Object2D().setPosition(0,0).addChildTo(this)},update:function(){var t=(this.direction+90)*toRad,e=Math.cos(t)*this.speed,i=Math.sin(t)*this.speed;this.mapBase.x+=e,this.mapBase.y+=i},addLayer:function(t){},setDirection:function(t){return this.direction=t,this},setSpeed:function(t){return this.speed=t,this},setPosition:function(t,e){return this.mapBase.x=t,this.mapBase.y=e,this}}),pb3.Ground.prototype.accessor("x",{get:function(){return this.mapBase.x},set:function(t){this.mapBase.x=t}}),pb3.Ground.prototype.accessor("y",{get:function(){return this.mapBase.y},set:function(t){this.mapBase.x=t}})}(),function(){tm.define("pb3.PlayerDisp",{superClass:"tm.display.Sprite",init:function(){this.superInit("gunship",48,48),this.setFrameIndex(4),this.setScale(.5),core=tm.display.Shape({width:16,height:16}).addChildTo(this),core.canvas.setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"hsla(200, 60%, 70%, 1.0)"},{offset:.5,color:"hsla(240, 60%, 70%, 1.0)"},{offset:1,color:"hsla(240, 60%, 50%, 0.0)"}]).toStyle()).fillRect(0,0,16,16),core.tweener.clear(),core.tweener.scale(1,100,"easeInOutQuad").scale(.5,150,"easeInOutQuad").setLoop(!0)}}),tm.define("pb3.Result",{superClass:"tm.app.Object2D",layer:LAYER_FOREGROUND,parentScene:null,player:null,phase:1,finish:!1,clearBonus:0,ratioBonus:0,labelParam:{fontFamily:"Orbitron",align:"center",baseline:"middle",fontWeight:800,outlineWidth:2},init:function(t,e,i,n,s){this.superInit(),this.originX=this.originY=0;var r=tm.display.Shape({width:.8*SC_W,height:.6*SC_H}).addChildTo(this).setPosition(.5*SC_W,.5*SC_H);if(r.renderRectangle({fillStyle:"rgba(0,0,128,0.5)",strokeStyle:"rgba(128,128,128,0.5)"}),r.alpha=1,r.tweener.fadeIn(1e3),this.msg=[],0!=t)var a=this.msg[0]=tm.display.OutlineLabel("STAGE "+t+" CLEAR!",30).addChildTo(this).setPosition(.5*SC_W,.3*SC_H).setParam(this.labelParam);else var a=this.msg[0]=tm.display.OutlineLabel("ALL CLEAR!",30).addChildTo(this).setPosition(.5*SC_W,.3*SC_H).setParam(this.labelParam);this.clearBonus=n;var a=this.msg[1]=tm.display.OutlineLabel("CLEAR BONUS: "+n,25).addChildTo(this).setPosition(.5*SC_W,.4*SC_H).setParam(this.labelParam);a.alpha=0;var o=~~(i/e*1e3)/10,a=this.msg[2]=tm.display.OutlineLabel("KILL RATIO: "+o+"%",25).addChildTo(this).setPosition(.5*SC_W,.5*SC_H).setParam(this.labelParam);if(a.alpha=0,this.ratioBonus=0,100==o?this.ratioBonus=1e5:o>=90?this.ratioBonus=5e4:o>=80&&(this.ratioBonus=3e4),this.ratioBonus>0){var a=this.msg[3]=tm.display.OutlineLabel("RATIO BONUS: "+this.ratioBonus,25).addChildTo(this).setPosition(.5*SC_W,.6*SC_H).setParam(this.labelParam);a.alpha=0}this.time=1},update:function(){this.time%30==0&&this.phase<this.msg.length&&(this.msg[this.phase].tweener.fadeIn(100),this.phase++,this.phase==this.msg.length&&(this.finish=!0),1==this.phase&&(this.parentScene.score+=this.clearBonus),3==this.phase&&(this.parentScene.score+=this.ratioBonus)),this.time++}}),tm.define("pb3.BossGauge",{superClass:"tm.display.CanvasElement",layer:LAYER_FOREGROUND,parentScene:null,player:null,target:null,init:function(t,e,i){this.superInit(),this.blendMode="lighter",this.x=t||0,this.y=e||0,this.width=i||GS_W-32,this.height=16},setTarget:function(t){this.target=t},update:function(){},draw:function(t){if(this.target){t.lineWidth=16,t.globalCompositeOperation="source-over",t.fillStyle="rgba(64, 64, 64, 0.8)",t.fillRect(0,0,this.width,this.height);var e=this.width/this.target.defMax*this.target.def;this.width-20;t.fillStyle="rgba(255, 64, 64, 0.8)",t.fillRect(16,0,SC_W-32,16),t.fillStyle="rgba(64, 255, 64, 1.0)",t.fillRect(16,0,e,16)}}})}(),function(){var t={0:{x:1,y:0},45:{x:.7,y:-.7},90:{x:0,y:-1},135:{x:-.7,y:-.7},180:{x:-1,y:0},225:{x:-.7,y:.7},270:{x:0,y:1},315:{x:.7,y:.7}};tm.define("pb3.Player",{superClass:"tm.display.Sprite",layer:LAYER_PLAYER,width:2,height:2,control:!0,shotON:!1,mouseON:!1,isCollision:!1,timeMuteki:0,speed:10,type:0,power:0,powerMax:5,shotPower:10,shotInterval:6,rollcount:50,pitchcount:50,parentScene:null,indecies:[0,1,2,3,4,4,4,5,6,7,8],init:function(){return this.superInit("gunship",48,48),this.setFrameIndex(4),this.core=tm.display.Shape({width:16,height:16}).addChildTo(this),this.core.canvas.setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"hsla(200, 60%, 70%, 1.0)"},{offset:.5,color:"hsla(240, 60%, 70%, 1.0)"},{offset:1,color:"hsla(240, 60%, 50%, 0.0)"}]).toStyle()).fillRect(0,0,16,16),this.core.tweener.clear(),this.core.tweener.scale(1,100,"easeInOutQuad").scale(.5,150,"easeInOutQuad").setLoop(!0),this.bits=[],this.bits[0]=pb3.PlayerBit(0).addChildTo(this),this.bits[1]=pb3.PlayerBit(1).addChildTo(this),this.bits[2]=pb3.PlayerBit(2).addChildTo(this),this.bits[3]=pb3.PlayerBit(3).addChildTo(this),this.openBit(0),this.boundingType="circle",this.radius=2,this.checkHierarchy=!0,this.time=0,this.changeInterval=0,this},update:function(){if(this.control){var e=app.pointing;if(e.getPointing()){var i=this.parentScene.pointer;this.x+=(i.x-this.x)/this.speed,this.y+=(i.y-this.y)/this.speed,this.mouseON=!0,this.shotON=!0}else this.mouseON=!1,this.shotON=!1;var n=app.keyboard,s=n.getKeyAngle();if(null!==s){var r=t[s];this.x+=r.x*this.speed*.4,this.y+=r.y*this.speed*.4}this.mouseON||(this.shotON=app.keyboard.getKey("Z")),app.keyboard.getKey("X")&&this.time>this.changeInterval&&(this.type=(this.type+1)%3,this.openBit(this.type),this.changeInterval=this.time+30),this.x=Math.clamp(this.x,16,GS_W-16),this.y=Math.clamp(this.y,16,GS_H-16),this.shotON&&this.time%this.shotInterval==0&&this.enterShot()}var a=~~this.x,o=~~this.bx;o>a&&(this.rollcount-=2,this.rollcount<0&&(this.rollcount=0)),a>o&&(this.rollcount+=2,this.rollcount>100&&(this.rollcount=100));var h=Math.abs(o-a);2>h&&(this.rollcount<50?this.rollcount+=2:this.rollcount-=2,this.rollcount<0&&(this.rollcount=0),this.rollcount>100&&(this.rollcount=100)),this.setFrameIndex(this.indecies[Math.clamp(~~(this.rollcount/10),0,9)]),this.bx=this.x,this.by=this.y,this.time++,this.timeMuteki--},damage:function(){this.timeMuteki>0||MUTEKI||(pb3.Effect.ExplodePlayer().setPosition(this.x,this.y).addChildTo(this.parentScene),app.playSE("explodePlayer"),this.parentScene.stageMiss++,this.parentScene.life--,this.parentScene.dispLife.dec(),this.parentScene.life>-1?(this.startup(),this.parentScene.eraseBullet(),this.parentScene.eraseBulletTime=60):(this.setPosition(.5*GS_W,3*GS_H),this.control=!1))},getItem:function(t,e){switch(t){case 0:this.type==e&&this.power<this.powerMax&&this.power++,this.type=e,this.openBit(e),app.playSE("powerup",1);break;case 1:app.playSE("powerup",1);break;case 2:}},enterShot:function(){var t=this.shotPower;pb3.ShotBullet(0,t,0).addChildTo(this.parentScene).setPosition(this.x,this.y-16),pb3.ShotBullet(0,t,0).addChildTo(this.parentScene).setPosition(this.x+16,this.y-8),pb3.ShotBullet(0,t,0).addChildTo(this.parentScene).setPosition(this.x-16,this.y-8);
},openBit:function(t){var e=0;switch(t){case 0:this.bits[0].tweener.clear().to({x:5,y:-32,rotation:2,alpha:1},300).call(function(){this.tweener.clear().moveBy(-40,0,500,"easeInOutSine").moveBy(40,0,500,"easeInOutSine").setLoop(!0)}.bind(this.bits[0])),this.bits[1].tweener.clear().to({x:-5,y:-32,rotation:-2,alpha:1},300).call(function(){this.tweener.clear().moveBy(40,0,500,"easeInOutSine").moveBy(-40,0,500,"easeInOutSine").setLoop(!0)}.bind(this.bits[1])),this.bits[2].tweener.clear().to({x:20,y:-24,rotation:2,alpha:1},300).call(function(){this.tweener.clear().moveBy(-50,0,500,"easeInOutSine").moveBy(50,0,500,"easeInOutSine").setLoop(!0)}.bind(this.bits[2])),this.bits[3].tweener.clear().to({x:-20,y:-24,rotation:-2,alpha:1},300).call(function(){this.tweener.clear().moveBy(50,0,500,"easeInOutSine").moveBy(-50,0,500,"easeInOutSine").setLoop(!0)}.bind(this.bits[3])),e=0;break;case 1:this.bits[0].tweener.clear().to({x:48,y:0,rotation:0,alpha:1},300).setLoop(!1),this.bits[1].tweener.clear().to({x:-48,y:0,rotation:0,alpha:1},300).setLoop(!1),this.bits[2].tweener.clear().to({x:12,y:40,rotation:0,alpha:1},300).setLoop(!1),this.bits[3].tweener.clear().to({x:-12,y:40,rotation:0,alpha:1},300).setLoop(!1),e=80;break;case 2:this.bits[0].tweener.clear().to({x:36,y:16,rotation:5,alpha:1},300).setLoop(!1),this.bits[1].tweener.clear().to({x:-36,y:16,rotation:-5,alpha:1},300).setLoop(!1),this.bits[2].tweener.clear().to({x:60,y:24,rotation:10,alpha:1},300).setLoop(!1),this.bits[3].tweener.clear().to({x:-60,y:24,rotation:-10,alpha:1},300).setLoop(!1),e=200;break;default:this.bits[0].tweener.clear().to({x:0,y:0,alpha:0},300),this.bits[1].tweener.clear().to({x:0,y:0,alpha:0},300),this.bits[2].tweener.clear().to({x:0,y:0,alpha:0},300),this.bits[3].tweener.clear().to({x:0,y:0,alpha:0},300),e=60}this.core.canvas.setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"hsla({0}, 60%, 70%, 1.0)".format(e)},{offset:.5,color:"hsla({0}, 60%, 70%, 1.0)".format(e+40)},{offset:1,color:"hsla({0}, 60%, 50%, 0.0)".format(e+40)}]).toStyle()).fillRect(0,0,16,16)},startup:function(){this.x=GS_W/2,this.y=GS_H+128,this.tweener.clear().wait(2e3).to({x:GS_W/2,y:GS_H-128},2e3,"easeOutQuint").call(function(){this.shotON=!0,this.control=!0,this.isCollision=!0,this.timeMuteki=180}.bind(this)),this.shotON=!1,this.control=!1,this.isCollision=!1,this.parentScene.timeVanish=300},stageStartup:function(){this.x=GS_W/2,this.y=GS_H+128,this.tweener.clear().to({x:GS_W/2,y:GS_H/2+32},1e3,"easeOutCubic").to({x:GS_W/2,y:GS_H-64},1e3).call(function(){this.shotON=!0,this.control=!0,this.isCollision=!0,this.timeMuteki=180}.bind(this)),this.shotON=!1,this.control=!1,this.isCollision=!1}}),tm.define("pb3.PlayerBit",{superClass:"tm.display.Sprite",id:0,active:!1,init:function(t){this.superInit("bit",32,32),this.setScale(.8),this.parentScene=app.currentScene,this.index=0,this.id=t,this.alpha=1,this.beforeX=0,this.beforeY=0,this.time=0},update:function(){this.time%2==0&&(this.id%2==0?(this.index--,this.index<0&&(this.index=8)):this.index=(this.index+1)%9,this.setFrameIndex(this.index));var t=app.player;if(t.shotON&&this.time%t.shotInterval==0){var e=this.x+t.x,i=this.y+t.y;pb3.ShotBullet(this.rotation,t.shotPower).addChildTo(t.parentScene).setPosition(e,i-4)}1==t.type&&(this.rotation=Math.clamp(t.rollcount-50,-25,25),-4<this.rotation&&this.rotation<4&&(this.rotation=0)),this.time++}}),tm.define("pb3.PlayerPointer",{superClass:"tm.display.Shape",layer:LAYER_OBJECT_LOWER,init:function(){this.superInit({width:32,height:32}),this.canvas.lineWidth=3,this.canvas.globalCompositeOperation="lighter",this.canvas.strokeStyle="rgb(255, 255, 255)",this.canvas.strokeArc(16,16,8,2*Math.PI,0,!0)},update:function(){var t=app.pointing;app.player.control&&t.getPointing()?(~~this.x==~~app.player.x&&~~this.y==~~app.player.y?this.alpha=0:this.alpha=.5,this.x+=t.position.x-t.prevPosition.x,this.y+=t.position.y-t.prevPosition.y,this.x=Math.clamp(this.x,16,GS_W-16),this.y=Math.clamp(this.y,16,GS_H-16)):(this.x=app.player.x,this.y=app.player.y,this.alpha=0)}}),tm.define("pb3.Item",{superClass:"tm.display.Sprite",layer:LAYER_PLAYER,id:0,type:0,active:!1,init:function(t){this.superInit("tex1",32,32),this.parentScene=app.currentScene,this.id=t,this.setFrameTrimming(0,97,96,32),this.setFrameIndex(t),this.setScale(2),0==t&&(this.core=tm.display.Shape({width:32,height:32}).addChildTo(this),this.core.canvas.setFillStyle(tm.graphics.RadialGradient(16,16,0,16,16,16).addColorStopList([{offset:0,color:"rgba(255, 0, 0, 1)"},{offset:.8,color:"rgba(255, 0, 0, 0.5)"},{offset:1,color:"rgba(0, 0, 0, 0)"}]).toStyle()).fillRect(0,0,32,32),this.core.tweener.clear(),this.core.tweener.scale(.5,500,"easeInOutSine").scale(.3,500,"easeInOutSine").setLoop(!0),this.core.setScale(.5)),this.boundingType="rect",this.phase=0,this.count=0,this.time=1},update:function(){if(0==this.id&&this.time%150==0){this.type=(this.type+1)%3;var t,e;0==this.type&&(t="rgba(255, 0, 0, 1)",e="rgba(255, 0, 0, 0.5)"),1==this.type&&(t="rgba(0, 255, 0, 1)",e="rgba(0, 255, 0, 0.5)"),2==this.type&&(t="rgba(0, 0, 255, 1)",e="rgba(0, 0, 255, 0.5)"),this.core.canvas.setFillStyle(tm.graphics.RadialGradient(16,16,0,16,16,16).addColorStopList([{offset:0,color:t},{offset:.8,color:e},{offset:1,color:"rgba(0, 0, 0, 0)"}]).toStyle()).fillRect(0,0,32,32)}var i=app.player;if(this.isHitElement(i)&&(i.getItem(this.id,this.type),this.remove()),0==this.phase)this.y++,this.y>SC_H-32&&this.phase++;else if(1==this.phase){var n=rand(.2*SC_W,.8*SC_W),s=rand(.2*SC_H,.9*SC_W);this.tweener.clear().move(n,s,3e3,"easeInOutSine").call(function(){this.count++,this.count<3?this.phase=1:this.phase=3}.bind(this)),this.phase++}else 3==this.phase&&(this.y+=2);this.time++}})}(),function(){pb3.checkLayers=[LAYER_OBJECT_UPPER,LAYER_OBJECT,LAYER_OBJECT_LOWER],tm.define("pb3.Bullet",{superClass:"tm.bulletml.Bullet",layer:LAYER_BULLET,parentScene:null,player:null,param:null,id:-1,isVanish:!1,isVanishEffect:!0,rollAngle:5,rolling:!0,init:function(t,e,i){this.superInit(t),this.boundingType="circle",this.radius=2,this.param=e,this.id=i||-1;var n=1,s=1,r=0;switch(e.type){case"RS":n=1,s=.6,r=0;break;case"BS":n=1,s=.6,r=1;break;case"RM":n=1,s=.8,r=0;break;case"BM":n=1,s=.8,r=1;break;case"RL":n=1,s=1,r=0;break;case"BL":n=1,s=1,r=1;break;case"RES":n=2,s=.6,r=0;break;case"BES":n=2,s=.6,r=16;break;case"REM":n=2,s=1,r=0;break;case"BEM":n=2,s=1,r=16;break;case"THIN":n=2,s=1,r=24,this.rolling=!1,this.rotation=this.runner.direction*toDeg-90}tm.display.Sprite("bullet"+n,24,24).addChildTo(this).setFrameIndex(r).setScale(s),this.on("enterframe",function(){this.rolling&&(this.rotation+=this.rollAngle),app.player.isCollision&&this.isHitElement(app.player)&&(app.player.damage(),this.isVanish=!0),(this.x<-32||this.x>GS_W+32||this.y<-32||this.y>GS_H+32)&&(this.isVanish=!0,this.isVanishEffect=!1),this.isVanish&&this.remove()}.bind(this)),this.on("removed",function(){this.isVanishEffect&&pb3.Effect.BulletVanish(this).addChildTo(app.currentScene),this.removeChildren()}.bind(this)),this.beforeX=this.x,this.beforeY=this.y}}),tm.define("pb3.ShotBullet",{superClass:"tm.display.Sprite",layer:LAYER_SHOT,parentScene:null,player:null,speed:15,power:1,defaultSpeed:15,defaultPower:1,init:function(t,e,i){0==i?(this.superInit("shot1",16,16),this.setScale(2)):(this.superInit("shot2",16,32),this.scaleX=1.5),this.rotation=t||0,this.speed=this.defaultSpeed,this.power=e||this.defaultPower,this.alpha=.8,this.blendMode="lighter",t-=90,this.vx=Math.cos(t*toRad)*this.speed,this.vy=Math.sin(t*toRad)*this.speed,this.boundingType="circle",0==i?this.radius=6:this.radius=12,this.beforeX=this.x,this.beforeY=this.y},update:function(){this.x+=this.vx,this.y+=this.vy,(this.x<-20||this.x>GS_W+20||this.y<-20||this.y>GS_H+20)&&this.remove();for(var t=0;3>t;t++){var e=this.parentScene.layers[pb3.checkLayers[t]];e.children.each(function(t){return t!==app.player&&this.parent&&t.isCollision&&t.isHitElement(this)?(t.damage(this.power),this.vanish(),void this.remove()):void 0}.bind(this))}},vanish:function(){pb3.Effect.ShotImpact().addChildTo(this.parentScene).setPosition(this.x,this.y),pb3.Effect.enterDebrisSmall(this.parentScene,this.x,this.y,1),this.removeChildren()}})}(),function(){pb3.bulletPattern=pb3.bulletPattern||[];var t=bulletml.dsl;$diff=1,$rank=0;var e=function(e){return t.bullet(e,{type:"RS"})},i=function(e){return t.bullet(e,{type:"RM"})},n=function(e){return t.bullet(e,{type:"BM"})},s=function(e){return t.bullet(e,{type:"THIN"})},r=function(e){return e=void 0===e?1:e,t.wait(~~(e-$rank))},a=function(e){return e=void 0===e?1:e,t.speed(.1*$rank*e+e)},o=function(i,n,s){return t.fire(t.direction(0),t.speed(i)||a,e,t.offsetX(n),t.offsetY(s))},h=function(i,n,s,r){return t.fire(t.direction(0),t.speed(i)||a,n||e,t.offsetX(s),t.offsetY(r))};pb3.bulletPattern.nop=new bulletml.Root({top:t.action([t.wait(1e4)])}),pb3.bulletPattern["basic-aim1"]=new bulletml.Root({top:t.action([t.wait(60),t.repeat(999,[o(3),t.wait("$rand * 60")])])}),pb3.bulletPattern["basic-aim2"]=new bulletml.Root({top:t.action([t.wait(60),t.repeat(999,[o(3),t.wait("$rand * 60")])])});var l=function(i,n,s,r,a,o,h,l){return t.action([t.fire(t.direction(n),r,a||e,o,h,l),t.bindVar("way","Math.max(2, "+i+")"),t.repeat("$way-1",[t.fire(t.direction("(("+s+")-("+n+"))/($way-1)","sequence"),r,a||e,o,h,l)])])},u=function(i,n,s,r,a,o,h){return t.action([t.fire(t.direction(n,"absolute"),r,a||e,o,h),t.bindVar("way","Math.max(2, "+i+")"),t.repeat("$way-1",[t.fire(t.direction("(("+s+")-("+n+"))/($way-1)","sequence"),r,a||RNS,o,h)])])};pb3.bulletPattern.Hornet1=new bulletml.Root({top:t.action([t.wait(60),t.repeat(999,[h(3,s),t.wait("$rand * 150")])])}),pb3.bulletPattern.Hornet2=new bulletml.Root({top:t.action([t.wait(60),t.repeat(3,[o(3),t.wait("$rand * 150")])])}),pb3.bulletPattern.Hornet3=new bulletml.Root({top:t.action([t.wait(60),t.repeat(999,[h(3,s),t.wait("$rand * 150")])])}),pb3.bulletPattern.MudDauber=new bulletml.Root({top0:t.action([t.wait(90),t.repeat(999,[t.repeat(3,[l(4,-30,30,a(2),i,t.offsetX(-32)),l(4,-30,30,a(2),i,t.offsetX(32)),r(10)]),r(60),t.repeat(3,[l(5,-30,30,a(2),n,t.offsetX(-32)),l(5,-30,30,a(2),n,t.offsetX(32)),r(10)]),r(120)])])}),pb3.bulletPattern.MournBlade=new bulletml.Root({top0:t.action([t.wait(90),t.repeat(999,[t.repeat(3,[u(3,190,170,a(2),i),r(10)]),r(120)])])}),pb3.bulletPattern.BigWing=new bulletml.Root({top0:t.action([t.wait(90),t.repeat(999,[t.repeat(3,[u(3,200,160,a(2),i),r(20)]),r(120)])]),top1:t.action([t.wait(90),t.repeat(999,[t.repeat(3,[t.fire(t.direction(180,"absolute"),a(3),n,t.offsetX(-32)),t.fire(t.direction(180,"absolute"),a(3),n,t.offsetX(32)),r(20)]),r(60)])])}),pb3.bulletPattern.Fragarach=new bulletml.Root({top:t.action([t.wait(20),t.repeat(999,[o(3),t.wait("$rand*90")])])}),pb3.bulletPattern.Brionac=new bulletml.Root({top:t.action([t.wait(90),t.repeat(999,[t.repeat(3,[u(3,190,170,a(2),i),r(10)]),r(120)])])}),pb3.bulletPattern.ToyBox=new bulletml.Root({top:t.action([t.wait(60),t.repeat(999,[o(3,0,-42),t.wait("$rand*90")])])})}(),pb3.Effect=[],function(){tm.define("pb3.Effect.EffectBase",{superClass:"tm.display.Sprite",layer:LAYER_EFFECT_UPPER,interval:2,startIndex:0,maxIndex:8,index:0,delay:0,loop:!1,isRemove:!1,velocityX:0,velocityY:0,velocityD:0,groundX:0,groundY:0,ifGround:!1,time:0,init:function(t,e,i,n,s,r,a){this.superInit(t,e,i),this.interval=n||4,this.startIndex=s||0,this.maxIndex=r||8,this.delay=a||0,this.delay<0&&(this.delay*=-1),this.time=-this.delay,this.index=this.startIndex,this.setFrameIndex(this.index),this.parentScene=app.currentScene,this.on("enterframe",this.defaultEnterFrame)},defaultEnterFrame:function(){if(this.time<0)return this.visible=!1,void this.time++;if(0==this.time&&(this.visible=!0),this.isGround){var t=this.groundX-this.parentScene.ground.x,e=this.groundY-this.parentScene.ground.y;this.x-=t,this.y-=e,this.groundX=this.parentScene.ground.x,this.groundY=this.parentScene.ground.y}this.time%this.interval==0&&(this.setFrameIndex(this.index),this.index++,this.index>this.maxIndex&&(this.loop?this.index=this.startIndex:this.isRemove=!0)),(this.x<-32||this.x>GS_W+32||this.y<-32||this.y>GS_H+32)&&(this.isRemove=!0),this.addVelocity(),this.time++,this.isRemove&&(this.removeChildren(),this.remove())},addVelocity:function(){this.x+=this.velocityX,this.y+=this.velocityY,this.velocityX*=this.velocityD,this.velocityY*=this.velocityD},setVelocity:function(t,e,i){return this.velocityX=t,this.velocityY=e,this.velocityD=i,this},setLoop:function(t){return this.loop=t,this}}),tm.define("pb3.Effect.Explode",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(t){this.superInit("effect",64,64,2,0,17,t)}}),tm.define("pb3.Effect.ExplodeSmall",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(t){this.setFrameTrimming(256,256,128,32),this.superInit("effect",16,16,4,8,15,t)}}),tm.define("pb3.Effect.ExplodeSmall2",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(t){this.setFrameTrimming(256,256,128,32),this.superInit("effect",16,16,4,0,7,t)}}),tm.define("pb3.Effect.ExplodeLarge",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(t){this.setFrameTrimming(0,192,192,96),this.superInit("effect",48,48,4,0,7,t)}}),tm.define("pb3.Effect.ExplodeGround",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_LOWER,isGround:!0,init:function(t){this.setFrameTrimming(256,192,256,48),this.superInit("effect",32,48,4,0,7,t),this.groundX=this.parentScene.ground.x,this.groundY=this.parentScene.ground.y}}),tm.define("pb3.Effect.Debri",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(t,e){t=t||0,t=Math.clamp(t,0,3),0==t?(this.setFrameTrimming(192,128,64,48),this.superInit("effect",8,8,2,0,8,e)):(t--,this.setFrameTrimming(384,128,128,48),this.superInit("effect",16,16,4,8*t,8*(t+1)-1,e))}}),tm.define("pb3.Effect.ExplodePlayer",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(t){this.setFrameTrimming(0,288,384,48),this.superInit("effect",48,48,4,0,7,t)}}),tm.define("pb3.Effect.ShotImpact",{superClass:"pb3.Effect.EffectBase",layer:LAYER_EFFECT_UPPER,init:function(){this.setFrameTrimming(256,240,128,16),this.superInit("effect",16,16,2,0,7)}}),tm.define("pb3.Effect.Particle",{superClass:"tm.display.Shape",layer:LAYER_EFFECT_UPPER,alpha:1,alphaDecayRate:.85,size:0,image:null,isEffect:!0,isUpper:!0,init:function(t,e,i,n){t=t||32,n=n||0,this.superInit({width:t,height:t}),void 0===e&&(e=1),void 0===i&&(i=.9),this.size=t,this.alpha=e,this.alphaDecayRate=i,this.blendMode="lighter";var s=this.canvas;s.setFillStyle(tm.graphics.RadialGradient(t/2,t/2,0,t/2,t/2,t/2).addColorStopList([{offset:0,color:"hsla({0}, 60%, 50%, 1.0)".format(n)},{offset:.5,color:"hsla({0}, 60%, 50%, 0.5)".format(n)},{offset:1,color:"hsla({0}, 60%, 50%, 0.0)".format(n)}]).toStyle()).fillRect(0,0,t,t),this.on("enterframe",function(){return this.alpha*=this.alphaDecayRate,this.alpha<.01?void this.remove():void(1<this.alpha&&(this.alpha=1))}.bind(this))}}),tm.define("pb3.Effect.BulletVanish",{superClass:"tm.display.Shape",layer:LAYER_EFFECT_UPPER,alpha:1,alphaDecayRate:.9,size:0,image:null,isEffect:!0,isUpper:!0,deltaX:0,deltaY:0,deltaA:1,init:function(t){var e=t.size||16,i=t.param.type||"RL";this.superInit({width:e,height:e}),this.size=e,this.blendMode="lighter",this.deltaX=t.runner.deltaX,this.deltaY=t.runner.deltaY,this.deltaA=.9,this.setPosition(t.x,t.y);var n=0;switch(i){case"RS":case"RL":case"RE":n=320;break;case"BS":case"BL":case"BE":n=240}var s=this.canvas;s.setFillStyle(tm.graphics.RadialGradient(e/2,e/2,0,e/2,e/2,e/2).addColorStopList([{offset:0,color:"hsla({0}, 60%, 50%, 0.0)".format(n)},{offset:.9,color:"hsla({0}, 60%, 50%, 1.0)".format(n)},{offset:1,color:"hsla({0}, 60%, 50%, 0.0)".format(n)}]).toStyle()).fillRect(0,0,e,e),this.on("enterframe",function(){this.x+=this.deltaX,this.y+=this.deltaY,this.deltaX*=this.deltaA,this.deltaY*=this.deltaA}.bind(this)),this.tweener.clear().to({scaleX:3,scaleY:3,alpha:0},800,"easeOutQuad").call(function(){this.remove()}.bind(this))}}),tm.define("pb3.Effect.ShockWave",{superClass:"tm.display.Shape",layer:LAYER_EFFECT_UPPER,init:function(t,e){t=t||64,this.superInit({width:t,height:t}),void 0===e&&(e=.9),this.width=this.height=this.size=t,this.alphaDecayRate=e,this.blendMode="lighter";var i=this.canvas;i.setFillStyle(tm.graphics.RadialGradient(t/2,t/2,0,t/2,t/2,t/2).addColorStopList([{offset:0,color:"hsla(0, 100%, 100%, 0.0)"},{offset:.8,color:"hsla(0, 100%, 100%, 1.0)"},{offset:1,color:"hsla(0, 100%, 100%, 0.0)"}]).toStyle()).fillRect(0,0,t,t)},update:function(){return this.alpha<.01?void this.remove():void(1<this.alpha&&(this.alpha=1))}})}(),function(){pb3.Effect.enterExplode=function(t,e,i,n,s,r){n=n||0,s=s||0,r=r||0,pb3.Effect.Explode(r).addChildTo(t).setPosition(e,i).setVelocity(n,s,0);for(var a=rand(5,10),o=0;a>o;o++){var h=rand(0,359)*toRad,l=rand(5,10),u=Math.cos(h)*l,c=Math.sin(h)*l,m=r+rand(0,10),p=0;o>a-2&&(p=rand(1,3)),pb3.Effect.Debri(p,m).addChildTo(t).setPosition(e,i).setVelocity(u,c,.9)}},pb3.Effect.enterExplodeSmall=function(t,e,i,n,s,r){n=n||0,s=s||0,r=r||0,pb3.Effect.Explode(r).addChildTo(t).setPosition(e,i).setVelocity(n,s,0);for(var a=rand(3,10),o=0;a>o;o++){var h=rand(0,359)*toRad,l=rand(5,10),u=Math.cos(h)*l,c=Math.sin(h)*l,m=r+rand(0,10),p=0;o>a-2&&(p=rand(1,3)),pb3.Effect.Debri(p,m).addChildTo(t).setPosition(e,i).setVelocity(u,c,.9)}},pb3.Effect.enterExplodeLarge=function(t,e,i,n,s,r){n=n||0,s=s||0,r=r||0,pb3.Effect.ExplodeLarge(r).addChildTo(t).setPosition(e,i).setVelocity(n,s,0);for(var a=rand(10,20),o=0;a>o;o++){var h=rand(0,359)*toRad,l=rand(5,10),u=Math.cos(h)*l,c=Math.sin(h)*l,m=r+rand(0,10),p=rand(0,3);pb3.Effect.Debri(p,m).addChildTo(t).setPosition(e,i).setVelocity(u,c,.9)}},pb3.Effect.enterExplodeGround=function(t,e,i,n,s,r){n=n||0,s=s||0,r=r||0,pb3.Effect.ExplodeGround(r).addChildTo(t).setPosition(e,i).setVelocity(n,s,0).setScale(2);for(var a=rand(5,10),o=0;a>o;o++){var h=rand(0,359)*toRad,l=rand(5,10),u=Math.cos(h)*l,c=Math.sin(h)*l,m=r+rand(0,10),p=rand(0,3);pb3.Effect.Debri(p,m).addChildTo(t).setPosition(e,i).setVelocity(u,c,.9)}},pb3.Effect.enterDebrisSmall=function(t,e,i,n,s){n=n||5,s=s||0;for(var r=0;n>r;r++){var a=rand(0,359)*toRad,o=rand(5,10),h=Math.cos(a)*o,l=Math.sin(a)*o,u=s+rand(0,10),c=0;pb3.Effect.Debri(c,u).addChildTo(t).setPosition(e,i).setVelocity(h,l,.9)}}}(),function(){tm.define("pb3.Enemy",{superClass:"tm.display.CanvasElement",layer:LAYER_OBJECT,parentScene:null,parentEnemy:null,isCollision:!0,isDead:!1,isSelfCrash:!1,isMuteki:!1,isBoss:!1,isOnScreen:!1,isGround:!1,isEnemy:!0,isAttack:!0,name:null,def:0,defMax:0,bulletPattern:null,nowBulletPattern:null,id:-1,enterParam:null,body:null,texName:null,texIndex:0,texWidth:32,texHeight:32,data:null,beforeX:0,beforeY:0,groundX:0,groundY:0,init:function(t,e,i,n,s){this.superInit(),this.setPosition(e,i),this.id=n||-1,this.enterParam=s,this.name=t;var r=this.data=pb3.enemyData[t];if(!r)return!1;if(this.bulletPattern=r.bulletPattern,this.def=this.defMax=r.def,this.width=r.width||32,this.height=r.height||32,this.layer=r.layer||LAYER_OBJECT,this.point=r.point||0,this.setup=r.setup||this.setup,this.algorithm=r.algorithm||this.algorithm,this.dead=r.dead||this.defaultDead,this.changeColor=r.changeColor||this.changeColor,r.texName)this.texName=r.texName,this.texIndex=r.texIndex,this.texWidth=r.texWidth,this.texHeight=r.texHeight,this.body=tm.display.Sprite(r.texName,r.texWidth,r.texHeight).addChildTo(this),this.texTrimX=r.texTrimX||0,this.texTrimY=r.texTrimX||0,this.texTrimWidth=r.texTrimWidth||this.body.image.width,this.texTrimHeight=r.texTrimHeight||this.body.image.height,this.body.setFrameTrimming(this.texTrimX,this.texTrimY,this.texTrimWidth,this.texTrimHeight),this.body.setFrameIndex(this.texIndex);else{var a=this;this.texName=null,this.texWidth=this.width,this.texHeight=this.height,this.body=tm.display.Shape({width:this.width,height:this.height}).addChildTo(this),this.body.renderRectangle({fillStyle:"rgba(255,255,0,1.0)",strokeStyle:"rgba(255,255,0,1.0)"}),this.body.update=function(){this.rotation=-a.rotation}}if(VIEW_COLLISION&&(this.col=tm.display.Shape({width:this.width,height:this.height}).addChildTo(this),this.col.renderRectangle({fillStyle:"rgba(255,255,0,0.5)",strokeStyle:"rgba(255,255,0,0.5)"}),this.col.update=function(){this.rotation=-a.rotation}),DEBUG){var o=this.defDisp=tm.display.OutlineLabel("[0/0]",20).addChildTo(this).setParam({fontFamily:"'UbuntuMono'",align:"center",baseline:"middle",fontWeight:300,outlineWidth:2}),a=this;o.update=function(){this.rotation=-a.rotation,this.text="["+a.def+"/"+a.defMax+"]"}}this.isCollision=r.isCollision||this.isCollision,this.isDead=r.isDead||this.isDead,this.isSelfCrash=r.isSelfCrash||this.isSelfCrash,this.isMuteki=r.isMuteki||this.isMuteki,this.isBoss=r.isBoss||this.isBoss,this.isOnScreen=r.isOnScreen||this.isOnScreen,this.isGround=r.isGround||this.isGround,this.isEnemy=r.isEnemy||this.isEnemy,this.isAttack=r.isAttack||this.isAttack,this.parentScene=app.currentScene,this.setup(s),this.groundX=this.parentScene.ground.x,this.groundY=this.parentScene.ground.y,this.bulletPattern instanceof Array?this.nowBulletPattern=this.bulletPattern[0]:this.nowBulletPattern=this.bulletPattern;var h={rank:this.parentScene.rank,target:app.player,createNewBullet:function(t,e){this.isAttack&&pb3.Bullet(t,e,this.id).addChildTo(this.parentScene)}.bind(this)};this.startDanmaku(pb3.bulletPattern[this.nowBulletPattern],h),this.boundingType="rect",this.on("removed",this.release),this.time=0},setup:function(t){},update:function(){if(!this.isDead){if(this.isGround){var t=this.groundX-this.parentScene.ground.x,e=this.groundY-this.parentScene.ground.y;this.x-=t,this.y-=e,this.groundX=this.parentScene.ground.x,this.groundY=this.parentScene.ground.y}this.algorithm(),this.isOnScreen?(this.x<-100||this.x>GS_W+100||this.y<-100||this.y>GS_H+100)&&(this.remove(),this.isCollision=!1):0<this.x&&this.x<GS_W&&0<this.y&&this.y<GS_H&&(this.isOnScreen=!0);var i=app.player;this.isCollision&&!this.isGround&&i.isCollision&&this.isHitElement(i)&&i.damage(),this.parentEnemy&&this.parentEnemy.isDead&&(this.isSelfCrash=!0,this.dead()),this.def<.2*this.defMax&&this.nearDeath(),this.isGround&&!this.isBoss&&(distanceSq(this,app.player)<4096?this.isAttack=!1:this.isAttack=!0),this.beforeX=this.x,this.beforeY=this.y,this.time++}},algorithm:function(){},damage:function(t,e){return this.isMuteki||this.isDead?void 0:(this.def-=t,e&&(this.def=-1),this.def<1?(this.data.type==ENEMY_BOSS?(this.deadBoss(),this.parentScene.stageClear=!0):this.dead(),this.parentScene.enemyKill++,this.parentEnemy&&this.parentEnemy.deadChild(this),this.isSelfCrash||(app.score+=this.data.point),!0):(this.changeColor("White"),this.body.tweener.clear().wait(1).call(function(){this.changeColor()}.bind(this)),!1))},nearDeath:function(){if(this.time%30==0?this.changeColor("Red"):this.time%30==5&&this.changeColor(),this.time%35==0){var t=this.width/2,e=this.height/2,i=this.x+rand(-t,t),n=this.y+rand(-e,e),s=this.x-this.beforeX,r=this.y-this.beforeY;pb3.Effect.enterExplode(this.parentScene,i,n,s,r)}},changeColor:function(t){this.texName&&(void 0===t?t="":"Red"!=t&&"White"!=t&&(t="Red"),this.body.setImage(this.texName+t,this.texWidth,this.texHeight),this.body.setFrameIndex(this.texIndex))},defaultDead:function(){this.isCollision=!1,this.isDead=!0,this.tweener.clear(),this.stopDanmaku();var t=this.x-this.beforeX,e=this.y-this.beforeY;if(this.data.explodeType==EXPLODE_SMALL&&(pb3.Effect.enterExplode(this.parentScene,this.x,this.y,t,e),app.playSE("explodeSmall")),this.data.explodeType==EXPLODE_MIDDLE||this.data.explodeType==EXPLODE_LARGE){for(var i=rand(20,30)*this.data.explodeType,n=0;i>n;n++){var s=this.x+rand(-this.width,this.width),r=this.y+rand(-this.height,this.height),a=rand(0,30);pb3.Effect.enterExplode(this.parentScene,s,r,t,e,a)}app.playSE("explodeLarge")}this.data.explodeType==EXPLODE_GROUND&&(pb3.Effect.enterExplodeGround(this.parentScene,this.x,this.y,t,e),app.playSE("explodeSmall")),this.data.type==ENEMY_MIDDLE?this.parentScene.eraseBullet(this):this.data.type==ENEMY_LARGE&&(this.parentScene.eraseBullet(),this.parentScene.timeVanish=60),this.remove()},deadBoss:function(){this.isCollision=!1,this.isDead=!0,this.tweener.clear(),this.stopDanmaku(),this.on("enterframe",function(){this.alpha*=.9,this.alpha<.02&&this.remove()}.bind(this));for(var t=this.x-this.beforeX,e=this.y-this.beforeY,i=0;10>i;i++){var n=rand(0,this.width)-this.width/2,s=rand(0,this.height)-this.height/2;pb3.Effect.enterExplodeSmall(this.parentScene,n,s,t,e)}app.playSE("explodeLarge"),this.parentScene.eraseBullet(),this.remove()},setParentEnemy:function(t){this.parentEnemy=t},deadChild:function(t){},lookAt:function(t){t=t||app.player;var e=this.x-t.x,i=this.y-t.y,n=Math.atan2(i,e),s=~~(n*toDeg);this.rotation=s+90},moveTo:function(t,e,i){t=t||app.player,e=e||5;var n=this.x-t.x,s=this.y-t.y,r=Math.atan2(s,n),a=~~(r*toDeg);(i||void 0===i)&&(this.rotation=a+90),this.vx=Math.cos(r+Math.PI)*e,this.vy=Math.sin(r+Math.PI)*e,this.x+=this.vx,this.y+=this.vy},release:function(){this.removeChildren()}})}(),function(){pb3.enemyData=pb3.enemyData||[],pb3.enemyData.Hornet={bulletPattern:"Hornet",width:16,height:16,def:30,point:300,layer:LAYER_OBJECT,type:ENEMY_SMALL,explodeType:EXPLODE_SMALL,texName:"tex1",texWidth:32,texHeight:32,texIndex:0,setup:function(t){switch(this.phase=0,this.roter=tm.display.Sprite("tex1",32,32).addChildTo(this),this.roter.setFrameIndex(32),this.roter.index=32,this.pattern=t,this.bulletPattern="Hornet"+t,t){case 1:this.tweener.moveBy(0,300,2e3,"easeOutQuart").wait(1e3).moveBy(0,-300,2e3).call(function(){this.remove()}.bind(this));break;case 2:this.moveTo(app.player,5,!0);break;case 3:this.tweener.moveBy(0,300,2e3,"easeOutQuart").wait(1e3).call(function(){this.phase++}.bind(this))}},algorithm:function(){this.lookAt(),this.time%2==0&&(this.roter.index=(this.roter.index+1)%4+32,this.roter.setFrameIndex(this.roter.index)),2==this.pattern&&(this.x+=this.vx,this.y+=this.vy),3==this.pattern&&(1==this.phase&&(this.moveTo(app.player,5,!0),this.phase++),2==this.phase&&(this.x+=this.vx,this.y+=this.vy))}},pb3.enemyData.MudDauber={bulletPattern:"MudDauber",width:60,height:26,def:800,point:3e3,layer:LAYER_OBJECT,type:ENEMY_MIDDLE,explodeType:EXPLODE_MIDDLE,texName:"tex1",texWidth:128,texHeight:64,texIndex:6,setup:function(){this.index=this.texIndex,this.phase=0,this.roter=tm.display.Sprite("tex1",114,48).addChildTo(this),this.roter.setFrameTrimming(288,128,228,96),this.roter.setFrameIndex(0),this.roter.index=0,this.x<0?(this.px=1,this.tweener.moveBy(.6*GS_W,0,3e3,"easeOutCubic").call(function(){this.phase++}.bind(this))):(this.px=-1,this.tweener.moveBy(.6*-GS_W,0,3e3,"easeOutCubic").call(function(){this.phase++}.bind(this)))},algorithm:function(){this.time%4==0&&(this.roter.index=(this.roter.index+1)%4+32,this.roter.setFrameIndex(this.roter.index)),this.time%10==0&&(this.index=(this.index+1)%2+6,this.body.setFrameIndex(this.index)),1==this.phase&&(this.y--,this.x+=this.px)}},pb3.enemyData.BigWing={bulletPattern:"BigWing",width:80,height:26,def:1e3,point:3e3,layer:LAYER_OBJECT,type:ENEMY_MIDDLE,explodeType:EXPLODE_MIDDLE,texName:"tex1",texWidth:128,texHeight:48,texIndex:2,setup:function(){this.index=this.texIndex},algorithm:function(){this.time%2==0&&this.y++,this.time%10==0&&(this.index=(this.index+1)%2+2,this.body.setFrameIndex(this.index))}},pb3.enemyData.MournBlade={bulletPattern:"MournBlade",width:128,height:20,def:800,point:3e3,layer:LAYER_OBJECT,type:ENEMY_MIDDLE,explodeType:EXPLODE_MIDDLE,texName:"tex1",texWidth:48,texHeight:104,texIndex:0,texTrimX:0,texTrimY:128,texTrimWidth:96,texTrimHeight:104,setup:function(){this.index=this.texIndex,this.phase=0,this.roter=tm.display.Sprite("tex1",114,48).addChildTo(this),this.roter.setFrameTrimming(96,128,192,104),this.roter.setFrameIndex(0),this.roter.index=0,this.x<0?(this.px=1,this.tweener.moveBy(.6*GS_W,0,3e3,"easeOutCubic").moveBy(1*GS_W,0,5e3,"easeOutCubic")):(this.px=-1,this.tweener.moveBy(.6*-GS_W,0,3e3,"easeOutCubic").moveBy(1*-GS_W,0,5e3,"easeOutCubic"))},algorithm:function(){this.time%4==0&&(this.roter.index=(this.roter.index+1)%4,this.roter.setFrameIndex(this.roter.index)),this.time%10==0&&(this.index=(this.index+1)%2,this.body.setFrameIndex(this.index)),1==this.phase&&(this.y--,this.x+=this.px)}},pb3.enemyData.Fragarach={bulletPattern:"Fragarach",width:48,height:48,def:50,point:500,layer:LAYER_OBJECT,type:ENEMY_SMALL,explodeType:EXPLODE_GROUND,isGround:!0,texName:"tex2",texWidth:48,texHeight:48,texIndex:0,setup:function(t){switch(this.index=this.texIndex,this.phase=0,t){case"c":this.rotation=0;break;case"l":this.rotation=90;break;case"r":this.rotation=270}this.turret=tm.display.Sprite("tex1",32,32).addChildTo(this),this.turret.setFrameTrimming(192,32,32,32),this.turret.setFrameIndex(0)},algorithm:function(){var t=this.x-app.player.x,e=this.y-app.player.y,i=Math.atan2(e,t),n=~~(i*toDeg);this.turret.rotation=n+90,this.time%4==0&&(this.index=(this.index+1)%4,this.body.setFrameIndex(this.index)),this.x+=.2*Math.cos((this.rotation+90)*toRad),this.y+=.2*Math.sin((this.rotation+90)*toRad)}},pb3.enemyData.Brionac={bulletPattern:"Brionac",width:64,height:64,def:800,point:3e3,layer:LAYER_OBJECT,type:ENEMY_MIDDLE,explodeType:EXPLODE_MIDDLE,texName:"tex1",texWidth:48,texHeight:104,texIndex:0,setup:function(){this.index=this.texIndex,this.phase=0,this.setFrameTrimming(0,128,96,104)},algorithm:function(){}},pb3.enemyData.Mistilteinn={bulletPattern:"nop",width:64,height:64,def:800,point:3e3,layer:LAYER_OBJECT,type:ENEMY_MIDDLE,explodeType:EXPLODE_MIDDLE,texName:"tex1",texWidth:48,texHeight:104,texIndex:0,texTrimX:0,texTrimY:128,texTrimWidth:96,texTrimHeight:104,setup:function(){this.index=this.texIndex,this.phase=0,this.setFrameTrimming(0,128,96,104)},algorithm:function(){}},pb3.enemyData.ToyBox={bulletPattern:"ToyBox",width:30,height:90,def:500,point:5e3,layer:LAYER_OBJECT,type:ENEMY_SMALL,explodeType:EXPLODE_LARGE,texName:"tex1",texWidth:64,texHeight:128,texIndex:2,kind:0,setup:function(t){"power"==t&&(this.kind=0),"bomb"==t&&(this.kind=1),"1UP"==t&&(this.kind=2),this.tweener.clear().moveBy(0,.5*GS_H,5e3).wait(8e3).moveBy(0,-GS_H,1e4)},algorithm:function(){},dead:function(){pb3.Item(this.kind).addChildTo(this.parentScene).setPosition(this.x,this.y),this.defaultDead()}}}(),function(){pb3.enemyData=pb3.enemyData||[],pb3.enemyData.ThorHammer={bulletPattern:"ThorHammer",width:98,height:196,def:1e3,point:1e4,layer:LAYER_OBJECT_LOWER,type:ENEMY_MBOSS,explodeType:EXPLODE_MBOSS,texName:"boss1",texWidth:96,texHeight:192,texIndex:0,setup:function(t){this.phase=0},algorithm:function(){}},pb3.enemyData.Golyat={bulletPattern:"Golyat",width:64,height:64,def:1e3,point:1e4,layer:LAYER_OBJECT_LOWER,type:ENEMY_BOSS,explodeType:EXPLODE_MBOSS,texName:"boss1",texWidth:32,texHeight:32,texTrimX:192,texTrimY:0,texTrimWidth:184,texTrimHeight:184,texIndex:0,setup:function(t){this.phase=0,this.isCollision=!1,this.isGround=!0,this.cover=tm.display.Sprite("boss1",32,32).addChildTo(this).setPosition(0,0).setFrameTrimming(382,0,32,32),this.core=tm.display.Sprite("boss1",32,32).addChildTo(this).setPosition(0,0).setFrameTrimming(0,0,32,32),this.tweener.clear().move(.5*SC_W,SC_H*-.5,3e3,"easeOutSine").call(function(){this.phase++}.bind(this))},algorithm:function(){2==this.phase&&(this.isCollision=!0,this.phase++)}},pb3.enemyData.GolyatArm={bulletPattern:"",width:64,height:64,def:500,point:1e4,layer:LAYER_OBJECT_LOWER,type:ENEMY_BOSS,explodeType:EXPLODE_MBOSS,texName:"boss1",texWidth:32,texHeight:32,texTrimX:192,texTrimY:0,texTrimWidth:184,texTrimHeight:184,texIndex:0,setup:function(t){},algorithm:function(){}},pb3.enemyData.GolyatTurret={bulletPattern:"",width:64,height:64,def:500,point:1e4,layer:LAYER_OBJECT_LOWER,type:ENEMY_BOSS,explodeType:EXPLODE_MBOSS,texName:"boss1",texWidth:32,texHeight:32,texTrimX:192,texTrimY:0,texTrimWidth:184,texTrimHeight:184,texIndex:0,setup:function(t){},algorithm:function(){}}}(),function(){pb3.enemyUnit={
"Hornet1-left":[{name:"Hornet",x:.1*GS_W,y:-150,param:1},{name:"Hornet",x:.2*GS_W,y:-120,param:1},{name:"Hornet",x:.3*GS_W,y:-130,param:1},{name:"Hornet",x:.4*GS_W,y:-120,param:1}],"Hornet1-right":[{name:"Hornet",x:.6*GS_W,y:-110,param:1},{name:"Hornet",x:.7*GS_W,y:-120,param:1},{name:"Hornet",x:.8*GS_W,y:-100,param:1},{name:"Hornet",x:.9*GS_W,y:-150,param:1}],"Hornet1-center":[{name:"Hornet",x:.25*GS_W,y:-160,param:1},{name:"Hornet",x:.35*GS_W,y:-120,param:1},{name:"Hornet",x:.4*GS_W,y:-100,param:1},{name:"Hornet",x:.5*GS_W,y:-110,param:1},{name:"Hornet",x:.7*GS_W,y:-130,param:1},{name:"Hornet",x:.85*GS_W,y:-120,param:1}],"Hornet2-left":[{name:"Hornet",x:.1*GS_W,y:-100,param:2},{name:"Hornet",x:.2*GS_W,y:-120,param:2},{name:"Hornet",x:.3*GS_W,y:-130,param:2},{name:"Hornet",x:.4*GS_W,y:-120,param:2}],"Hornet2-right":[{name:"Hornet",x:.6*GS_W,y:-100,param:2},{name:"Hornet",x:.7*GS_W,y:-120,param:2},{name:"Hornet",x:.8*GS_W,y:-130,param:2},{name:"Hornet",x:.9*GS_W,y:-120,param:2}],"Hornet3-left":[{name:"Hornet",x:.1*GS_W,y:-100,param:3},{name:"Hornet",x:.2*GS_W,y:-120,param:3},{name:"Hornet",x:.3*GS_W,y:-130,param:3},{name:"Hornet",x:.4*GS_W,y:-120,param:3}],"Hornet3-right":[{name:"Hornet",x:.6*GS_W,y:-100,param:3},{name:"Hornet",x:.7*GS_W,y:-120,param:3},{name:"Hornet",x:.8*GS_W,y:-130,param:3},{name:"Hornet",x:.9*GS_W,y:-120,param:3}],"Hornet3-center":[{name:"Hornet",x:.25*GS_W,y:-160,param:3},{name:"Hornet",x:.35*GS_W,y:-120,param:3},{name:"Hornet",x:.4*GS_W,y:-100,param:3},{name:"Hornet",x:.5*GS_W,y:-110,param:3},{name:"Hornet",x:.7*GS_W,y:-130,param:3},{name:"Hornet",x:.85*GS_W,y:-120,param:3}],"MudDauber-left":[{name:"MudDauber",x:.2*-GS_W,y:.4*GS_H}],"MudDauber-right":[{name:"MudDauber",x:1.2*GS_W,y:.4*GS_H}],"BigWing-left":[{name:"BigWing",x:.2*GS_W,y:.1*-GS_H}],"BigWing-right":[{name:"BigWing",x:.8*GS_W,y:.1*-GS_H}],"MournBlade-left":[{name:"MournBlade",x:.9*GS_W,y:.2*-GS_H}],"MournBlade-left":[{name:"MournBlade",x:.1*-GS_W,y:.2*-GS_H}],"Fragarach-center":[{name:"Fragarach",x:.3*GS_W,y:.1*-GS_H,param:"c"},{name:"Fragarach",x:.3*GS_W,y:.2*-GS_H,param:"c"},{name:"Fragarach",x:.3*GS_W,y:.3*-GS_H,param:"c"},{name:"Fragarach",x:.3*GS_W,y:.4*-GS_H,param:"c"},{name:"Fragarach",x:.5*GS_W,y:.35*-GS_H,param:"c"},{name:"Fragarach",x:.5*GS_W,y:.25*-GS_H,param:"c"},{name:"Fragarach",x:.5*GS_W,y:.45*-GS_H,param:"c"},{name:"Fragarach",x:.7*GS_W,y:.1*-GS_H,param:"c"},{name:"Fragarach",x:.7*GS_W,y:.2*-GS_H,param:"c"},{name:"Fragarach",x:.7*GS_W,y:.3*-GS_H,param:"c"},{name:"Fragarach",x:.7*GS_W,y:.4*-GS_H,param:"c"}],"Fragarach-left":[{name:"Fragarach",x:.1*-GS_W,y:.1*GS_H,param:"l"},{name:"Fragarach",x:.1*-GS_W,y:.2*GS_H,param:"l"},{name:"Fragarach",x:.2*-GS_W,y:.3*GS_H,param:"l"},{name:"Fragarach",x:.2*-GS_W,y:.4*GS_H,param:"l"}],"Fragarach-right":[{name:"Fragarach",x:1.1*GS_W,y:.1*GS_H,param:"r"},{name:"Fragarach",x:1.1*GS_W,y:.2*GS_H,param:"r"},{name:"Fragarach",x:1.2*GS_W,y:.3*GS_H,param:"r"},{name:"Fragarach",x:1.2*GS_W,y:.4*GS_H,param:"r"}],"ToyBox-p-left":[{name:"ToyBox",x:.2*GS_W,y:.3*-GS_H,param:"power"}],"ToyBox-p-center":[{name:"ToyBox",x:.5*GS_W,y:.3*-GS_H,param:"power"}],"ToyBox-p-right":[{name:"ToyBox",x:.8*GS_W,y:.3*-GS_H,param:"power"}],"ToyBox-b-left":[{name:"ToyBox",x:.2*GS_W,y:.3*-GS_H,param:"bomb"}],"ToyBox-b-center":[{name:"ToyBox",x:.5*GS_W,y:.3*-GS_H,param:"bomb"}],"ToyBox-b-right":[{name:"ToyBox",x:.8*GS_W,y:.3*-GS_H,param:"bomb"}],ThorHammer:[{name:"ThorHammer",x:.5*GS_W,y:1.3*GS_H}]}}(),function(){tm.define("pb3.Stage1",{superClass:"pb3.StageController",init:function(t,e){this.superInit(t,e),this.add(1,function(){this.ground.map.alpha=0,this.ground.tweener.clear().to({scaleX:.2,scaleY:.2,speed:1,alpha:0},1,"easeInOutQuad"),app.playBGM("stage1",!0)}),this.add(60,function(){this.ground.tweener.clear().to({scaleX:1,scaleY:1,speed:2},5e3,"easeInOutCubic"),this.ground.map.tweener.clear().to({alpha:1},2e3,"easeInOutQuad")}),this.add(120,"ToyBox-p-right"),this.add(180,"Hornet1-left"),this.add(60,"Hornet1-right"),this.add(60,"Hornet1-center"),this.add(120,"Hornet1-left"),this.add(1,"Hornet1-right"),this.add(60,"Hornet1-center"),this.add(120,"MudDauber-left"),this.add(60,"MudDauber-right"),this.add(90,"Hornet1-left"),this.add(20,"Hornet1-right"),this.add(120,"Hornet1-center"),this.add(90,"Hornet2-left"),this.add(120,"Hornet2-right"),this.add(120,"Hornet2-center"),this.add(30,"BigWing-left"),this.add(180,"BigWing-right"),this.add(120,"Hornet2-left"),this.add(20,"Hornet2-right"),this.add(120,"Hornet2-center"),this.add(120,"ToyBox-p-right")}}),tm.define("pb3.Stage1Ground",{superClass:"pb3.Ground",init:function(){this.superInit(),this.position.x=GS_W/2,this.position.y=GS_H/2,this.map=tm.display.Sprite("map1g").addChildTo(this.mapBase),this.map2=tm.display.Sprite("map1g").addChildTo(this.mapBase).setPosition(-320,0),this.map3=tm.display.Sprite("map1g").addChildTo(this.mapBase).setPosition(320,0),this.map4=tm.display.Sprite("map1g").addChildTo(this.mapBase).setPosition(-640,0),this.map5=tm.display.Sprite("map1g").addChildTo(this.mapBase).setPosition(640,0),this.map.alpha=0}})}(),function(){tm.define("pb3.StageController",{parentScene:null,player:null,time:0,seq:null,index:0,init:function(t,e){this.parentScene=t,this.seq=[]},add:function(t,e,i){this.index+=t,this.seq[this.index]={value:e,flag:i}},get:function(t){var e=this.seq[t];return void 0===e?null:e},clear:function(){this.seq=[],this.index=0}})}(),tm.define("pb3.GameoverScene",{superClass:tm.app.Scene,result1:"",result2:"",labelParam:{fontFamily:"Orbitron",align:"center",baseline:"middle",fontWeight:500,outlineWidth:2},init:function(t,e,i){this.superInit(),app.background="rgba(0, 0, 0, 0.5)",this.mask=tm.display.RectangleShape({width:.7*SC_W,height:.5*SC_H,fillStyle:"rgba(0,0,0,0.7)",strokeStyle:"rgba(0,0,0,0.7)"}).addChildTo(this).setPosition(.5*SC_W,.5*SC_H),this.result1="SCORE: "+app.score,i?this.result2="(ALL CLEAR!!)":this.result2="Stage:"+t+(e?" boss":""),tm.display.OutlineLabel("GAME OVER",30).addChildTo(this).setPosition(.5*SC_W,.4*SC_H).setParam(this.labelParam),tm.display.OutlineLabel(this.result1,20).addChildTo(this).setPosition(.5*SC_W,.5*SC_H).setParam(this.labelParam),tm.display.OutlineLabel("Press [Z] key or Touch",20).addChildTo(this).setPosition(.5*SC_W,.6*SC_H).setParam(this.labelParam),app.highScore<app.score&&(app.highScore=app.score),this.timer=tm.app.Object2D().addChildTo(this).tweener.wait(1e4).call(function(){this.exit()}.bind(this)),this.time=0},update:function(){app.keyboard;this.time>60&&app.keyboard.getKey("Z")&&this.exit(),this.time++},ontouchstart:function(t){this.exit()},exit:function(){tm.social.Nineleap.postRanking(app.score,this.result1+"("+this.result2+")"),app.replaceScene(pb3.TitleScene())}}),tm.define("pb3.LoadingScene",{superClass:"tm.app.Scene",init:function(t){this.superInit(),this.fromJSON({children:{stage:{type:"tm.display.CanvasElement"}}}),this.stage.fromJSON({children:{bg:{type:"tm.display.Shape",init:[{width:t.width,height:t.height}],originX:0,originY:0},label:{type:"tm.display.Label",text:"Asset read error!!",x:t.width/2,y:t.height/2-20,align:"center",baseline:"middle",fontSize:46,shadowBlur:4,shadowColor:"hsl(190, 100%, 50%)",alpha:0},bar:{type:"tm.ui.Gauge",init:[{width:.4*SC_W,height:10,color:"blue",bgColor:"rgba(20, 20, 20, 1)",borderColor:"transparent",borderWidth:0}],x:.3*SC_W,y:.5*SC_H+20}}});var e=this.stage.bg;e.canvas.clearColor(t.bgColor);for(var i="LOADING",n=[0,31,31,30,20,20,30],s=0,r=0;r<i.length;r++){s+=n[r];var a=t.width/2-84+s,o=t.height/2-20,h=tm.app.Object2D().addChildTo(this.stage).setPosition(a,o);h.tweener.wait(500+150*r).moveBy(0,-30,300,"easeOutSine").moveBy(0,30,600,"easeOutBounce").wait(1e3).moveBy(0,-30,300,"easeOutSine").moveBy(0,30,600,"easeOutBounce").wait(1e3).moveBy(0,-30,300,"easeOutSine").moveBy(0,30,600,"easeOutBounce").wait(1e3).moveBy(0,-30,300,"easeOutSine").moveBy(0,30,600,"easeOutBounce").wait(1e3).moveBy(0,-30,300,"easeOutSine").moveBy(0,30,600,"easeOutBounce");var l=tm.display.Label(i.charAt(r),30).addChildTo(h).setAlign("center").setBaseline("middle").setShadowBlur(4).setShadowColor("hsl(190, 100%, 50%)");l.tweener.to({alpha:.3},1e3,"easeInOutSine").to({alpha:1},1e3,"easeInOutSine").to({alpha:.3},1e3,"easeInOutSine").to({alpha:1},1e3,"easeInOutSine").to({alpha:.3},1e3,"easeInOutSine").to({alpha:1},1e3,"easeInOutSine").to({alpha:.3},1e3,"easeInOutSine").to({alpha:1},1e3,"easeInOutSine").to({alpha:.3},1e3,"easeInOutSine").to({alpha:1},1e3,"easeInOutSine").to({alpha:0},1e3,"easeInOutSine")}this.stage.label.tweener.wait(11e3).fadeIn(10);var u=this.stage.bar;u.animationFlag=!1,u.value=0,u.animationFlag=!0,u.animationTime=100;var c=this.stage;c.alpha=0,c.tweener.clear().fadeIn(100).call(function(){if(t.assets){var e=tm.asset.Loader();e.onload=function(){c.tweener.clear().wait(200).fadeOut(200).call(function(){t.nextScene&&this.app.replaceScene(t.nextScene());var e=tm.event.Event("load");this.fire(e)}.bind(this))}.bind(this),e.onprogress=function(t){u.value=100*t.progress;var e=tm.event.Event("progress");e.progress=t.progress,this.fire(e)}.bind(this),e.load(t.assets)}}.bind(this))}}),function(){tm.define("pb3.MainScene",{superClass:tm.app.Scene,touches:null,touchID:-1,startX:0,startY:0,moveX:0,moveY:0,beforeX:0,beforeY:0,time:0,absTime:0,nowStage:1,maxStage:1,stage:null,enemyID:0,timeVinish:0,boss:!1,stageClear:!1,stageMiss:0,rank:0,enemyCount:0,enemyKill:0,ground:null,life:2,bomb:2,init:function(){this.superInit(),this.background="rgba(0, 0, 0, 1.0)",this.touches=tm.input.TouchesEx(this),this.mask=tm.display.RectangleShape({width:SC_W,height:SC_H,fillStyle:"rgba(0,0,0,0.5)",strokeStyle:"rgba(0,0,0,0.1)"}).addChildTo(this).setPosition(.5*SC_W,.5*SC_H),this.base=tm.app.Object2D().addChildTo(this).setPosition(GS_OFFSET,0),this.layers=[];for(var t=0;t<LAYER_SYSTEM+1;t++)this.layers[t]=tm.app.Object2D().addChildTo(this.base);this.player=pb3.Player().addChildTo(this),this.player.stageStartup(),app.player=this.player,this.pointer=pb3.PlayerPointer().addChildTo(this),app.pointer=this.pointer,this.systemBase=tm.app.Object2D().addChildTo(this).setPosition(0,0),app.score=0;var e=this.scoreLabel=tm.display.OutlineLabel("SCORE:0",20).addChildTo(this.systemBase).setPosition(GS_OFFSET,0).setParam({fontFamily:"Orbitron",align:"left",baseline:"top",fontWeight:700,outlineWidth:2});e.update=function(){this.text="SCORE:"+app.score},this.dispLife=tm.app.Object2D().addChildTo(this.systemBase),this.dispLife.players=[],this.dispLife.life=0,this.dispLife.inc=function(){this.life++,this.players[this.life]=pb3.PlayerDisp().addChildTo(this).setPosition(GS_OFFSET+36*this.life-20,40)},this.dispLife.dec=function(){0!=this.life&&(this.players[this.life].remove(),this.life--)};for(var t=0;t<this.life;t++)this.dispLife.inc();this.bossGauge=pb3.BossGauge().addChildTo(this.systemBase).setPosition(0,-24),this.maskTop=tm.display.RectangleShape({width:SC_W,height:SC_H,fillStyle:"rgba(255,255,255,1.0)",strokeStyle:"rgba(255,255,255,1.0)"}).addChildTo(this).setPosition(.5*SC_W,.5*SC_H),this.maskTop.alpha=0;var i={width:80,height:SC_H,fillStyle:"rgba(0,0,0,1.0)",strokeStyle:"rgba(0,0,0,1.0)"};this.systemMaskL=tm.display.RectangleShape(i).addChildTo(this).setPosition(0,0).setOrigin(0,0),this.systemMaskR=tm.display.RectangleShape(i).addChildTo(this).setPosition(GS_W+80,0).setOrigin(0,0),this.initStage()},update:function(){var t=this.stage.get(this.time);if(t&&("function"==typeof t.value?t.value.call(this):this.enterEnemyUnit(t.value)),this.timeVanish>0&&this.eraseBullet(),this.stageClear&&(this.stageClear=!1,this.systemBase.tweener.clear().moveBy(0,-24,1e3).call(function(){this.bossGauge.setTarget(null)}.bind(this)),tm.app.Object2D().addChildTo(this).tweener.wait(5e3).call(function(){this.enterStageClear()}.bind(this))),app.extendNumber<app.extendScore.length&&app.score>app.extendScore[app.extendNumber]&&(app.extendNumber++,this.dispLife.inc()),-1==this.life){this.life=-99;var e=tm.app.Object2D().addChildTo(this);e.tweener.clear().wait(3e3).call(function(){app.replaceScene(pb3.GameoverScene(this.nowStage,this.boss))}.bind(this))}this.time++,this.absTime++,this.timeVanish--},enterBomb:function(t,e){},enterEnemyUnit:function(t){var e=pb3.enemyUnit[t];if(void 0!==e)for(var i=e.length,n=0;i>n;n++){var s=e[n],r=pb3.Enemy(s.name,s.x,s.y,this.enemyID,s.param).addChildTo(this);r.data.type==ENEMY_BOSS&&(this.bossGauge.setTarget(r),this.systemBase.tweener.clear().moveBy(0,32,1e3)),this.enemyID++,this.enemyCount++}},enterEnemy:function(t,e,i,n){return this.enemyID++,this.enemyCount++,pb3.Enemy(t,e,i,this.enemyID-1,n).addChildTo(this)},eraseBullet:function(t){0!=this.layers[LAYER_BULLET].length&&(t?this.layers[LAYER_BULLET].children.each(function(e){t.id==e.id&&(e.isVanish=!0)}):this.layers[LAYER_BULLET].children.each(function(t){t.isVanish=!0}))},enterWarning:function(){this.boss=!0,app.playBGM("warning",!1);var t=tm.display.OutlineLabel("WARNING!!",60).addChildTo(this).setPosition(-SC_W,.5*SC_H).setParam({fontFamily:"Orbitron",align:"center",baseline:"middle",fontWeight:800,outlineWidth:2});t.fillStyle=tm.graphics.LinearGradient(.5*-SC_W,0,.5*SC_W,64).addColorStopList([{offset:.1,color:"hsla(230, 90%, 50%, 0.5)"},{offset:.5,color:"hsla(230, 80%, 90%, 0.9)"},{offset:.9,color:"hsla(230, 90%, 50%, 0.5)"}]).toStyle(),t.shadowColor="red",t.shadowBlur=10,t.tweener.moveBy(1.5*SC_W,0,700,"easeInOutCubic").fadeOut(700).fadeIn(1).wait(1e3).fadeOut(700).fadeIn(1).wait(1e3).fadeOut(700).fadeIn(1).wait(1e3).moveBy(1.5*SC_W,0,1e3,"easeInOutCubic")},initStage:function(){switch(this.ground&&this.ground.remove(),this.nowStage){case 1:this.stage=pb3.Stage1(this,app.player),this.ground=pb3.Stage1Ground().setPosition(0,-400).addChildTo(this);break;case 2:this.stage=pb3.Stage1(this,app.player);break;case 3:this.stage=pb3.Stage1(this,app.player)}this.time=0,this.timeVanish=0,this.enemyCount=0,this.enemyKill=0,this.stageMiss=0;var t=tm.display.OutlineLabel("STAGE "+this.nowStage,50).addChildTo(this).setPosition(.5*SC_W,.5*SC_H).setParam({fontFamily:"Orbitron",align:"center",baseline:"middle",fontWeight:800,outlineWidth:2});t.alpha=0,t.tweener.wait(500).fadeIn(250).wait(1e3).fadeOut(250).call(function(){this.remove()}.bind(t))},enterStageClear:function(){var t=1e5*this.nowStage,e=pb3.Result(this.nowStage,this.enemyCount,this.enemyKill,t,0==this.stageMiss?!0:!1).addChildTo(this);this.nowStage<this.maxStage?e.tweener.wait(1e4).call(function(){this.nowStage++,this.initStage(),e.remove()}.bind(this)):e.tweener.wait(1e4).call(function(){app.replaceScene(pb3.GameoverScene(this.nowStage,this.boss,!0)),e.remove()}.bind(this))},enterAllStageClear:function(){var t=tm.display.Shape({width:.8*SC_W,height:.8*SC_H}).addChildTo(this).setPosition(.5*SC_W,.5*SC_H);t.renderRectangle({fillStyle:"rgba(0,0,128,0.5)",strokeStyle:"rgba(128,128,128,0.5)"}),t.alpha=0;var e=tm.display.OutlineLabel("ALL CLEAR!",30).addChildTo(t).setPosition(.4*SC_W,.1*SC_H);e.fontFamily="'Orbitron'",e.align="center",e.baseline="middle",e.fontWeight=800,e.outlineWidth=2,t.tweener.fadeIn(1e3).wait(5e3).fadeOut(2e3).call(function(){app.replaceScene(pb3.GameoverScene(this.nowStage,this.boss,!0))}.bind(this))},ontouchesstart:function(t){if(!(this.touchID>0)){this.touchID=t.ID;var e=this.startX=t.pointing.x,i=this.startY=t.pointing.y;this.moveX=0,this.moveY=0,this.beforeX=e,this.beforeY=i}},ontouchesmove:function(t){if(this.touchID==t.ID){var e=t.pointing.x,i=t.pointing.y;Math.abs(e-this.beforeX),Math.abs(e-this.beforeY);this.time%10==0&&(this.beforeX=e,this.beforeY=i)}},ontouchesend:function(t){if(this.touchID==t.ID){this.touchID=-1;t.pointing.x,t.pointing.y}},addChild:function(t){return void 0===t.layer?this.superClass.prototype.addChild.apply(this,arguments):(t.parentScene=this,this.layers[t.layer].addChild(t))}})}(),tm.define("pb3.TitleScene",{superClass:tm.app.Scene,labelBasic:{fontFamily:"'UbuntuMono'",align:"center",baseline:"middle",fontWeight:300,outlineWidth:2},init:function(){this.superInit(),app.background="rgba(0, 0, 0, 1.0)",this.mask=tm.display.RectangleShape({width:SC_W,height:SC_H,fillStyle:"rgba(0,0,0,0.5)",strokeStyle:"rgba(0,0,0,0.1)"}).addChildTo(this).setPosition(.5*SC_W,.5*SC_H);var t=(this.title1=tm.display.OutlineLabel("2D DANMAKU Shooting",25).addChildTo(this).setPosition(.5*SC_W,.4*SC_H).setParam({fontFamily:"'UbuntuMono'",align:"center",baseline:"middle",fontWeight:300,outlineWidth:2}),this.title2=tm.display.OutlineLabel("Planet Buster",40).addChildTo(this).setPosition(.5*SC_W,.5*SC_H).setParam({fontFamily:"'Orbitron'",align:"center",baseline:"middle",fontWeight:800,outlineWidth:2}));t.fillStyle=tm.graphics.LinearGradient(.5*-SC_W,0,.5*SC_W,64).addColorStopList([{offset:.1,color:"hsla(230, 90%, 50%, 0.5)"},{offset:.5,color:"hsla(230, 80%, 90%, 0.9)"},{offset:.9,color:"hsla(230, 90%, 50%, 0.5)"}]).toStyle(),t.shadowColor="blue",t.shadowBlur=10;this.title3=tm.display.OutlineLabel("tmlib label",25).addChildTo(this).setPosition(.5*SC_W,.6*SC_H).setParam({fontFamily:"'UbuntuMono'",align:"center",baseline:"middle",fontWeight:300,outlineWidth:2}),this.clickortouch=tm.display.OutlineLabel("Press[Z]key or touch",20).addChildTo(this).setPosition(.5*SC_W,.8*SC_H).setParam({fontFamily:"'UbuntuMono'",align:"center",baseline:"middle",fontWeight:500,outlineWidth:2}),this.scoreLabel=tm.display.OutlineLabel("HIGHSCORE:"+app.highScore,20).addChildTo(this).setParam({fontFamily:"'Orbitron'",align:"left",baseline:"top",fontWeight:700,outlineWidth:2});this.time=0},gameStart:function(){app.background="rgba(0, 0, 0, 0.8)",app.score=0;var t=pb3.LoadingScene({assets:pb3.assets.stage1,width:SC_W,height:SC_H,bgColor:"rgba(0, 0, 0, 1)",nextScene:function(){return pb3.MainScene()}.bind(this)});app.replaceScene(t)},update:function(){app.keyboard;this.time>30&&app.keyboard.getKey("Z")&&this.gameStart(),this.time++},ontouchend:function(){this.gameStart()}});